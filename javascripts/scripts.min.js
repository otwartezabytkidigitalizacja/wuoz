window.Modernizr = function(a, b, c) {
    function y(a) {
        j.cssText = a;
    }
    function z(a, b) {
        return y(m.join(a + ";") + (b || ""));
    }
    function A(a, b) {
        return typeof a === b;
    }
    function B(a, b) {
        return !!~("" + a).indexOf(b);
    }
    function C(a, b, d) {
        for (var e in a) {
            var f = b[a[e]];
            if (f !== c) return d === !1 ? a[e] : A(f, "function") ? f.bind(d || b) : f;
        }
        return !1;
    }
    var d = "2.6.2", e = {}, f = !0, g = b.documentElement, h = "modernizr", i = b.createElement(h), j = i.style, k, l = {}.toString, m = " -webkit- -moz- -o- -ms- ".split(" "), n = {
        svg: "http://www.w3.org/2000/svg"
    }, o = {}, p = {}, q = {}, r = [], s = r.slice, t, u = function(a, c, d, e) {
        var f, i, j, k, l = b.createElement("div"), m = b.body, n = m || b.createElement("body");
        if (parseInt(d, 10)) while (d--) j = b.createElement("div"), j.id = e ? e[d] : h + (d + 1), 
        l.appendChild(j);
        return f = [ "&#173;", '<style id="s', h, '">', a, "</style>" ].join(""), l.id = h, 
        (m ? l : n).innerHTML += f, n.appendChild(l), m || (n.style.background = "", n.style.overflow = "hidden", 
        k = g.style.overflow, g.style.overflow = "hidden", g.appendChild(n)), i = c(l, a), 
        m ? l.parentNode.removeChild(l) : (n.parentNode.removeChild(n), g.style.overflow = k), 
        !!i;
    }, v = function(b) {
        var c = a.matchMedia || a.msMatchMedia;
        if (c) return c(b).matches;
        var d;
        return u("@media " + b + " { #" + h + " { position: absolute; } }", function(b) {
            d = (a.getComputedStyle ? getComputedStyle(b, null) : b.currentStyle)["position"] == "absolute";
        }), d;
    }, w = {}.hasOwnProperty, x;
    !A(w, "undefined") && !A(w.call, "undefined") ? x = function(a, b) {
        return w.call(a, b);
    } : x = function(a, b) {
        return b in a && A(a.constructor.prototype[b], "undefined");
    }, Function.prototype.bind || (Function.prototype.bind = function(b) {
        var c = this;
        if (typeof c != "function") throw new TypeError();
        var d = s.call(arguments, 1), e = function() {
            if (this instanceof e) {
                var a = function() {};
                a.prototype = c.prototype;
                var f = new a(), g = c.apply(f, d.concat(s.call(arguments)));
                return Object(g) === g ? g : f;
            }
            return c.apply(b, d.concat(s.call(arguments)));
        };
        return e;
    }), o.touch = function() {
        var c;
        return "ontouchstart" in a || a.DocumentTouch && b instanceof DocumentTouch ? c = !0 : u([ "@media (", m.join("touch-enabled),("), h, ")", "{#modernizr{top:9px;position:absolute}}" ].join(""), function(a) {
            c = a.offsetTop === 9;
        }), c;
    }, o.svg = function() {
        return !!b.createElementNS && !!b.createElementNS(n.svg, "svg").createSVGRect;
    }, o.inlinesvg = function() {
        var a = b.createElement("div");
        return a.innerHTML = "<svg/>", (a.firstChild && a.firstChild.namespaceURI) == n.svg;
    }, o.svgclippaths = function() {
        return !!b.createElementNS && /SVGClipPath/.test(l.call(b.createElementNS(n.svg, "clipPath")));
    };
    for (var D in o) x(o, D) && (t = D.toLowerCase(), e[t] = o[D](), r.push((e[t] ? "" : "no-") + t));
    return e.addTest = function(a, b) {
        if (typeof a == "object") for (var d in a) x(a, d) && e.addTest(d, a[d]); else {
            a = a.toLowerCase();
            if (e[a] !== c) return e;
            b = typeof b == "function" ? b() : b, typeof f != "undefined" && f && (g.className += " " + (b ? "" : "no-") + a), 
            e[a] = b;
        }
        return e;
    }, y(""), i = k = null, function(a, b) {
        function k(a, b) {
            var c = a.createElement("p"), d = a.getElementsByTagName("head")[0] || a.documentElement;
            return c.innerHTML = "x<style>" + b + "</style>", d.insertBefore(c.lastChild, d.firstChild);
        }
        function l() {
            var a = r.elements;
            return typeof a == "string" ? a.split(" ") : a;
        }
        function m(a) {
            var b = i[a[g]];
            return b || (b = {}, h++, a[g] = h, i[h] = b), b;
        }
        function n(a, c, f) {
            c || (c = b);
            if (j) return c.createElement(a);
            f || (f = m(c));
            var g;
            return f.cache[a] ? g = f.cache[a].cloneNode() : e.test(a) ? g = (f.cache[a] = f.createElem(a)).cloneNode() : g = f.createElem(a), 
            g.canHaveChildren && !d.test(a) ? f.frag.appendChild(g) : g;
        }
        function o(a, c) {
            a || (a = b);
            if (j) return a.createDocumentFragment();
            c = c || m(a);
            var d = c.frag.cloneNode(), e = 0, f = l(), g = f.length;
            for (;e < g; e++) d.createElement(f[e]);
            return d;
        }
        function p(a, b) {
            b.cache || (b.cache = {}, b.createElem = a.createElement, b.createFrag = a.createDocumentFragment, 
            b.frag = b.createFrag()), a.createElement = function(c) {
                return r.shivMethods ? n(c, a, b) : b.createElem(c);
            }, a.createDocumentFragment = Function("h,f", "return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&(" + l().join().replace(/\w+/g, function(a) {
                return b.createElem(a), b.frag.createElement(a), 'c("' + a + '")';
            }) + ");return n}")(r, b.frag);
        }
        function q(a) {
            a || (a = b);
            var c = m(a);
            return r.shivCSS && !f && !c.hasCSS && (c.hasCSS = !!k(a, "article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")), 
            j || p(a, c), a;
        }
        var c = a.html5 || {}, d = /^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i, e = /^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i, f, g = "_html5shiv", h = 0, i = {}, j;
        (function() {
            try {
                var a = b.createElement("a");
                a.innerHTML = "<xyz></xyz>", f = "hidden" in a, j = a.childNodes.length == 1 || function() {
                    b.createElement("a");
                    var a = b.createDocumentFragment();
                    return typeof a.cloneNode == "undefined" || typeof a.createDocumentFragment == "undefined" || typeof a.createElement == "undefined";
                }();
            } catch (c) {
                f = !0, j = !0;
            }
        })();
        var r = {
            elements: c.elements || "abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",
            shivCSS: c.shivCSS !== !1,
            supportsUnknownElements: j,
            shivMethods: c.shivMethods !== !1,
            type: "default",
            shivDocument: q,
            createElement: n,
            createDocumentFragment: o
        };
        a.html5 = r, q(b);
    }(this, b), e._version = d, e._prefixes = m, e.mq = v, e.testStyles = u, g.className = g.className.replace(/(^|\s)no-js(\s|$)/, "$1$2") + (f ? " js " + r.join(" ") : ""), 
    e;
}(this, this.document), function(a, b, c) {
    function d(a) {
        return "[object Function]" == o.call(a);
    }
    function e(a) {
        return "string" == typeof a;
    }
    function f() {}
    function g(a) {
        return !a || "loaded" == a || "complete" == a || "uninitialized" == a;
    }
    function h() {
        var a = p.shift();
        q = 1, a ? a.t ? m(function() {
            ("c" == a.t ? B.injectCss : B.injectJs)(a.s, 0, a.a, a.x, a.e, 1);
        }, 0) : (a(), h()) : q = 0;
    }
    function i(a, c, d, e, f, i, j) {
        function k(b) {
            if (!o && g(l.readyState) && (u.r = o = 1, !q && h(), l.onload = l.onreadystatechange = null, 
            b)) {
                "img" != a && m(function() {
                    t.removeChild(l);
                }, 50);
                for (var d in y[c]) y[c].hasOwnProperty(d) && y[c][d].onload();
            }
        }
        var j = j || B.errorTimeout, l = b.createElement(a), o = 0, r = 0, u = {
            t: d,
            s: c,
            e: f,
            a: i,
            x: j
        };
        1 === y[c] && (r = 1, y[c] = []), "object" == a ? l.data = c : (l.src = c, l.type = a), 
        l.width = l.height = "0", l.onerror = l.onload = l.onreadystatechange = function() {
            k.call(this, r);
        }, p.splice(e, 0, u), "img" != a && (r || 2 === y[c] ? (t.insertBefore(l, s ? null : n), 
        m(k, j)) : y[c].push(l));
    }
    function j(a, b, c, d, f) {
        return q = 0, b = b || "j", e(a) ? i("c" == b ? v : u, a, b, this.i++, c, d, f) : (p.splice(this.i++, 0, a), 
        1 == p.length && h()), this;
    }
    function k() {
        var a = B;
        return a.loader = {
            load: j,
            i: 0
        }, a;
    }
    var l = b.documentElement, m = a.setTimeout, n = b.getElementsByTagName("script")[0], o = {}.toString, p = [], q = 0, r = "MozAppearance" in l.style, s = r && !!b.createRange().compareNode, t = s ? l : n.parentNode, l = a.opera && "[object Opera]" == o.call(a.opera), l = !!b.attachEvent && !l, u = r ? "object" : l ? "script" : "img", v = l ? "script" : u, w = Array.isArray || function(a) {
        return "[object Array]" == o.call(a);
    }, x = [], y = {}, z = {
        timeout: function(a, b) {
            return b.length && (a.timeout = b[0]), a;
        }
    }, A, B;
    B = function(a) {
        function b(a) {
            var a = a.split("!"), b = x.length, c = a.pop(), d = a.length, c = {
                url: c,
                origUrl: c,
                prefixes: a
            }, e, f, g;
            for (f = 0; f < d; f++) g = a[f].split("="), (e = z[g.shift()]) && (c = e(c, g));
            for (f = 0; f < b; f++) c = x[f](c);
            return c;
        }
        function g(a, e, f, g, h) {
            var i = b(a), j = i.autoCallback;
            i.url.split(".").pop().split("?").shift(), i.bypass || (e && (e = d(e) ? e : e[a] || e[g] || e[a.split("/").pop().split("?")[0]]), 
            i.instead ? i.instead(a, e, f, g, h) : (y[i.url] ? i.noexec = !0 : y[i.url] = 1, 
            f.load(i.url, i.forceCSS || !i.forceJS && "css" == i.url.split(".").pop().split("?").shift() ? "c" : c, i.noexec, i.attrs, i.timeout), 
            (d(e) || d(j)) && f.load(function() {
                k(), e && e(i.origUrl, h, g), j && j(i.origUrl, h, g), y[i.url] = 2;
            })));
        }
        function h(a, b) {
            function c(a, c) {
                if (a) {
                    if (e(a)) c || (j = function() {
                        var a = [].slice.call(arguments);
                        k.apply(this, a), l();
                    }), g(a, j, b, 0, h); else if (Object(a) === a) for (n in m = function() {
                        var b = 0, c;
                        for (c in a) a.hasOwnProperty(c) && b++;
                        return b;
                    }(), a) a.hasOwnProperty(n) && (!c && !--m && (d(j) ? j = function() {
                        var a = [].slice.call(arguments);
                        k.apply(this, a), l();
                    } : j[n] = function(a) {
                        return function() {
                            var b = [].slice.call(arguments);
                            a && a.apply(this, b), l();
                        };
                    }(k[n])), g(a[n], j, b, n, h));
                } else !c && l();
            }
            var h = !!a.test, i = a.load || a.both, j = a.callback || f, k = j, l = a.complete || f, m, n;
            c(h ? a.yep : a.nope, !!i), i && c(i);
        }
        var i, j, l = this.yepnope.loader;
        if (e(a)) g(a, 0, l, 0); else if (w(a)) for (i = 0; i < a.length; i++) j = a[i], 
        e(j) ? g(j, 0, l, 0) : w(j) ? B(j) : Object(j) === j && h(j, l); else Object(a) === a && h(a, l);
    }, B.addPrefix = function(a, b) {
        z[a] = b;
    }, B.addFilter = function(a) {
        x.push(a);
    }, B.errorTimeout = 1e4, null == b.readyState && b.addEventListener && (b.readyState = "loading", 
    b.addEventListener("DOMContentLoaded", A = function() {
        b.removeEventListener("DOMContentLoaded", A, 0), b.readyState = "complete";
    }, 0)), a.yepnope = k(), a.yepnope.executeStack = h, a.yepnope.injectJs = function(a, c, d, e, i, j) {
        var k = b.createElement("script"), l, o, e = e || B.errorTimeout;
        k.src = a;
        for (o in d) k.setAttribute(o, d[o]);
        c = j ? h : c || f, k.onreadystatechange = k.onload = function() {
            !l && g(k.readyState) && (l = 1, c(), k.onload = k.onreadystatechange = null);
        }, m(function() {
            l || (l = 1, c(1));
        }, e), i ? k.onload() : n.parentNode.insertBefore(k, n);
    }, a.yepnope.injectCss = function(a, c, d, e, g, i) {
        var e = b.createElement("link"), j, c = i ? h : c || f;
        e.href = a, e.rel = "stylesheet", e.type = "text/css";
        for (j in d) e.setAttribute(j, d[j]);
        g || (n.parentNode.insertBefore(e, n), m(c, 0));
    };
}(this, document), Modernizr.load = function() {
    yepnope.apply(window, [].slice.call(arguments, 0));
}, Modernizr.addTest("ie8compat", function() {
    return !window.addEventListener && document.documentMode && document.documentMode === 7;
});

!function($) {
    var transparentPNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==";
    var defaults = {
        zoom: .1
    };
    var wheel;
    if (document.onmousewheel !== undefined) {
        wheel = "onmousewheel";
    } else if (document.onwheel !== undefined) {
        wheel = "onwheel";
    }
    $.fn.wheelzoom = function(options) {
        var settings = $.extend({}, defaults, options);
        var maxbgWidth = 6e3;
        if (!this[0] || !wheel || !("backgroundSize" in this[0].style)) {
            return this;
        }
        return this.each(function() {
            var img = this, $img = $(img);
            function loaded() {
                var width = $img.width(), height = $img.height(), bgWidth = width, bgHeight = height, bgPosX = 0, bgPosY = 0, offsetBorderX = parseInt($img.css("border-left-width"), 10), offsetBorderY = parseInt($img.css("border-top-width"), 10), offsetPaddingX = parseInt($img.css("padding-left"), 10), offsetPaddingY = parseInt($img.css("padding-top"), 10);
                function reset() {
                    bgWidth = width;
                    bgHeight = height;
                    bgPosX = bgPosY = 0;
                    updateBgStyle();
                }
                function zoomOnPlus() {
                    console.info("adsadasdas");
                    var offsetParent = $img.offset();
                    var bgCursorX = bgPosX;
                    var bgCursorY = bgPosY;
                    var bgRatioX = bgCursorX / bgWidth;
                    var bgRatioY = bgCursorY / bgHeight;
                    if (bgWidth < maxbgWidth) {
                        bgWidth += bgWidth * .2;
                        bgHeight += bgHeight * .2;
                        console.info("more!");
                    }
                    if (bgWidth <= width || bgHeight <= height) {
                        reset();
                    } else {
                        updateBgStyle();
                    }
                }
                function zoomOnMinus() {
                    console.info("adsadasdas");
                    var offsetParent = $img.offset();
                    var bgCursorX = bgPosX;
                    var bgCursorY = bgPosY;
                    var bgRatioX = bgCursorX / bgWidth;
                    var bgRatioY = bgCursorY / bgHeight;
                    bgWidth -= bgWidth * .2;
                    bgHeight -= bgHeight * .2;
                    console.info("more!");
                    if (bgWidth <= width || bgHeight <= height) {
                        reset();
                    } else {
                        updateBgStyle();
                    }
                }
                function updateBgStyle() {
                    if (bgPosX > 0) {
                        bgPosX = 0;
                    } else if (bgPosX < width - bgWidth) {
                        bgPosX = width - bgWidth;
                    }
                    if (bgPosY > 0) {
                        bgPosY = 0;
                    } else if (bgPosY < height - bgHeight) {
                        bgPosY = height - bgHeight;
                    }
                    img.style.backgroundSize = bgWidth + "px " + bgHeight + "px";
                    img.style.backgroundPosition = bgPosX + offsetPaddingX + "px " + (bgPosY + offsetPaddingY) + "px";
                }
                $img.css({
                    background: "url(" + img.src + ") 0 0 no-repeat",
                    backgroundSize: width + "px " + height + "px",
                    backgroundPosition: offsetPaddingX + "px " + offsetPaddingY + "px"
                }).bind("wheelzoom.reset", reset);
                $img.bind("wheelzoom.zoomin", zoomOnPlus);
                $img.bind("wheelzoom.zoomout", zoomOnMinus);
                img.width = img.width || img.naturalWidth;
                $(img).css("height", img.height || img.naturalHeight);
                img.src = transparentPNG;
                img[wheel] = function(e) {
                    var deltaY = 0;
                    e.preventDefault();
                    if (e.deltaY) {
                        deltaY = e.deltaY;
                    } else if (e.wheelDelta) {
                        deltaY = -e.wheelDelta;
                    }
                    var offsetParent = $img.offset();
                    var offsetX = e.pageX - offsetParent.left - offsetBorderX - offsetPaddingX;
                    var offsetY = e.pageY - offsetParent.top - offsetBorderY - offsetPaddingY;
                    var bgCursorX = offsetX - bgPosX;
                    var bgCursorY = offsetY - bgPosY;
                    var bgRatioX = bgCursorX / bgWidth;
                    var bgRatioY = bgCursorY / bgHeight;
                    if (deltaY < 0) {
                        if (bgWidth < maxbgWidth) {
                            bgWidth += bgWidth * settings.zoom;
                            bgHeight += bgHeight * settings.zoom;
                        }
                    } else {
                        bgWidth -= bgWidth * settings.zoom;
                        bgHeight -= bgHeight * settings.zoom;
                    }
                    bgPosX = offsetX - bgWidth * bgRatioX;
                    bgPosY = offsetY - bgHeight * bgRatioY;
                    if (bgWidth <= width || bgHeight <= height) {
                        reset();
                    } else {
                        updateBgStyle();
                    }
                };
                img.onmousedown = function(e) {
                    var last = e;
                    $img.addClass("dragged");
                    e.preventDefault();
                    function drag(e) {
                        e.preventDefault();
                        bgPosX += e.pageX - last.pageX;
                        bgPosY += e.pageY - last.pageY;
                        last = e;
                        updateBgStyle();
                    }
                    $(document).on("mousemove", drag).one("mouseup", function() {
                        $(document).unbind("mousemove", drag);
                        $img.removeClass("dragged");
                    });
                };
            }
            if (img.complete) {
                loaded();
            } else {
                $img.one("load", loaded);
            }
        });
    };
    $.fn.wheelzoom.defaults = defaults;
}(window.jQuery);

var libFuncName = null;

if (typeof jQuery === "undefined" && typeof Zepto === "undefined" && typeof $ === "function") {
    libFuncName = $;
} else if (typeof jQuery === "function") {
    libFuncName = jQuery;
} else if (typeof Zepto === "function") {
    libFuncName = Zepto;
} else {
    throw new TypeError();
}

(function($, window, document, undefined) {
    "use strict";
    $("head").append('<meta class="foundation-mq-small">');
    $("head").append('<meta class="foundation-mq-medium">');
    $("head").append('<meta class="foundation-mq-large">');
    window.matchMedia = window.matchMedia || function(doc, undefined) {
        "use strict";
        var bool, docElem = doc.documentElement, refNode = docElem.firstElementChild || docElem.firstChild, fakeBody = doc.createElement("body"), div = doc.createElement("div");
        div.id = "mq-test-1";
        div.style.cssText = "position:absolute;top:-100em";
        fakeBody.style.background = "none";
        fakeBody.appendChild(div);
        return function(q) {
            div.innerHTML = '&shy;<style media="' + q + '"> #mq-test-1 { width: 42px; }</style>';
            docElem.insertBefore(fakeBody, refNode);
            bool = div.offsetWidth === 42;
            docElem.removeChild(fakeBody);
            return {
                matches: bool,
                media: q
            };
        };
    }(document);
    if (!Array.prototype.filter) {
        Array.prototype.filter = function(fun) {
            "use strict";
            if (this == null) {
                throw new TypeError();
            }
            var t = Object(this), len = t.length >>> 0;
            if (typeof fun !== "function") {
                return;
            }
            var res = [], thisp = arguments[1];
            for (var i = 0; i < len; i++) {
                if (i in t) {
                    var val = t[i];
                    if (fun && fun.call(thisp, val, i, t)) {
                        res.push(val);
                    }
                }
            }
            return res;
        };
    }
    if (!Function.prototype.bind) {
        Function.prototype.bind = function(oThis) {
            if (typeof this !== "function") {
                throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
            }
            var aArgs = Array.prototype.slice.call(arguments, 1), fToBind = this, fNOP = function() {}, fBound = function() {
                return fToBind.apply(this instanceof fNOP && oThis ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)));
            };
            fNOP.prototype = this.prototype;
            fBound.prototype = new fNOP();
            return fBound;
        };
    }
    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function(searchElement) {
            "use strict";
            if (this == null) {
                throw new TypeError();
            }
            var t = Object(this);
            var len = t.length >>> 0;
            if (len === 0) {
                return -1;
            }
            var n = 0;
            if (arguments.length > 1) {
                n = Number(arguments[1]);
                if (n != n) {
                    n = 0;
                } else if (n != 0 && n != Infinity && n != -Infinity) {
                    n = (n > 0 || -1) * Math.floor(Math.abs(n));
                }
            }
            if (n >= len) {
                return -1;
            }
            var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
            for (;k < len; k++) {
                if (k in t && t[k] === searchElement) {
                    return k;
                }
            }
            return -1;
        };
    }
    $.fn.stop = $.fn.stop || function() {
        return this;
    };
    window.Foundation = {
        name: "Foundation",
        version: "4.3.2",
        cache: {},
        media_queries: {
            small: $(".foundation-mq-small").css("font-family").replace(/\'/g, ""),
            medium: $(".foundation-mq-medium").css("font-family").replace(/\'/g, ""),
            large: $(".foundation-mq-large").css("font-family").replace(/\'/g, "")
        },
        stylesheet: $("<style></style>").appendTo("head")[0].sheet,
        init: function(scope, libraries, method, options, response, nc) {
            var library_arr, args = [ scope, method, options, response ], responses = [], nc = nc || false;
            if (nc) this.nc = nc;
            this.rtl = /rtl/i.test($("html").attr("dir"));
            this.scope = scope || this.scope;
            if (libraries && typeof libraries === "string" && !/reflow/i.test(libraries)) {
                if (/off/i.test(libraries)) return this.off();
                library_arr = libraries.split(" ");
                if (library_arr.length > 0) {
                    for (var i = library_arr.length - 1; i >= 0; i--) {
                        responses.push(this.init_lib(library_arr[i], args));
                    }
                }
            } else {
                if (/reflow/i.test(libraries)) args[1] = "reflow";
                for (var lib in this.libs) {
                    responses.push(this.init_lib(lib, args));
                }
            }
            if (typeof libraries === "function") {
                args.unshift(libraries);
            }
            return this.response_obj(responses, args);
        },
        response_obj: function(response_arr, args) {
            for (var i = 0, len = args.length; i < len; i++) {
                if (typeof args[i] === "function") {
                    return args[i]({
                        errors: response_arr.filter(function(s) {
                            if (typeof s === "string") return s;
                        })
                    });
                }
            }
            return response_arr;
        },
        init_lib: function(lib, args) {
            return this.trap(function() {
                if (this.libs.hasOwnProperty(lib)) {
                    this.patch(this.libs[lib]);
                    return this.libs[lib].init.apply(this.libs[lib], args);
                } else {
                    return function() {};
                }
            }.bind(this), lib);
        },
        trap: function(fun, lib) {
            if (!this.nc) {
                try {
                    return fun();
                } catch (e) {
                    return this.error({
                        name: lib,
                        message: "could not be initialized",
                        more: e.name + " " + e.message
                    });
                }
            }
            return fun();
        },
        patch: function(lib) {
            this.fix_outer(lib);
            lib.scope = this.scope;
            lib.rtl = this.rtl;
        },
        inherit: function(scope, methods) {
            var methods_arr = methods.split(" ");
            for (var i = methods_arr.length - 1; i >= 0; i--) {
                if (this.lib_methods.hasOwnProperty(methods_arr[i])) {
                    this.libs[scope.name][methods_arr[i]] = this.lib_methods[methods_arr[i]];
                }
            }
        },
        random_str: function(length) {
            var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");
            if (!length) {
                length = Math.floor(Math.random() * chars.length);
            }
            var str = "";
            for (var i = 0; i < length; i++) {
                str += chars[Math.floor(Math.random() * chars.length)];
            }
            return str;
        },
        libs: {},
        lib_methods: {
            set_data: function(node, data) {
                var id = [ this.name, +new Date(), Foundation.random_str(5) ].join("-");
                Foundation.cache[id] = data;
                node.attr("data-" + this.name + "-id", id);
                return data;
            },
            get_data: function(node) {
                return Foundation.cache[node.attr("data-" + this.name + "-id")];
            },
            remove_data: function(node) {
                if (node) {
                    delete Foundation.cache[node.attr("data-" + this.name + "-id")];
                    node.attr("data-" + this.name + "-id", "");
                } else {
                    $("[data-" + this.name + "-id]").each(function() {
                        delete Foundation.cache[$(this).attr("data-" + this.name + "-id")];
                        $(this).attr("data-" + this.name + "-id", "");
                    });
                }
            },
            throttle: function(fun, delay) {
                var timer = null;
                return function() {
                    var context = this, args = arguments;
                    clearTimeout(timer);
                    timer = setTimeout(function() {
                        fun.apply(context, args);
                    }, delay);
                };
            },
            data_options: function(el) {
                var opts = {}, ii, p, opts_arr = (el.attr("data-options") || ":").split(";"), opts_len = opts_arr.length;
                function isNumber(o) {
                    return !isNaN(o - 0) && o !== null && o !== "" && o !== false && o !== true;
                }
                function trim(str) {
                    if (typeof str === "string") return $.trim(str);
                    return str;
                }
                for (ii = opts_len - 1; ii >= 0; ii--) {
                    p = opts_arr[ii].split(":");
                    if (/true/i.test(p[1])) p[1] = true;
                    if (/false/i.test(p[1])) p[1] = false;
                    if (isNumber(p[1])) p[1] = parseInt(p[1], 10);
                    if (p.length === 2 && p[0].length > 0) {
                        opts[trim(p[0])] = trim(p[1]);
                    }
                }
                return opts;
            },
            delay: function(fun, delay) {
                return setTimeout(fun, delay);
            },
            scrollTo: function(el, to, duration) {
                if (duration < 0) return;
                var difference = to - $(window).scrollTop();
                var perTick = difference / duration * 10;
                this.scrollToTimerCache = setTimeout(function() {
                    if (!isNaN(parseInt(perTick, 10))) {
                        window.scrollTo(0, $(window).scrollTop() + perTick);
                        this.scrollTo(el, to, duration - 10);
                    }
                }.bind(this), 10);
            },
            scrollLeft: function(el) {
                if (!el.length) return;
                return "scrollLeft" in el[0] ? el[0].scrollLeft : el[0].pageXOffset;
            },
            empty: function(obj) {
                if (obj.length && obj.length > 0) return false;
                if (obj.length && obj.length === 0) return true;
                for (var key in obj) {
                    if (hasOwnProperty.call(obj, key)) return false;
                }
                return true;
            },
            addCustomRule: function(rule, media) {
                if (media === undefined) {
                    Foundation.stylesheet.insertRule(rule, Foundation.stylesheet.cssRules.length);
                } else {
                    var query = Foundation.media_queries[media];
                    if (query !== undefined) {
                        Foundation.stylesheet.insertRule("@media " + Foundation.media_queries[media] + "{ " + rule + " }");
                    }
                }
            }
        },
        fix_outer: function(lib) {
            lib.outerHeight = function(el, bool) {
                if (typeof Zepto === "function") {
                    return el.height();
                }
                if (typeof bool !== "undefined") {
                    return el.outerHeight(bool);
                }
                return el.outerHeight();
            };
            lib.outerWidth = function(el, bool) {
                if (typeof Zepto === "function") {
                    return el.width();
                }
                if (typeof bool !== "undefined") {
                    return el.outerWidth(bool);
                }
                return el.outerWidth();
            };
        },
        error: function(error) {
            return error.name + " " + error.message + "; " + error.more;
        },
        off: function() {
            $(this.scope).off(".fndtn");
            $(window).off(".fndtn");
            return true;
        },
        zj: $
    };
    $.fn.foundation = function() {
        var args = Array.prototype.slice.call(arguments, 0);
        return this.each(function() {
            Foundation.init.apply(Foundation, [ this ].concat(args));
            return this;
        });
    };
})(libFuncName, this, this.document);

(function($, window, document, undefined) {
    "use strict";
    var noop = function() {};
    var Orbit = function(el, settings) {
        if (el.hasClass(settings.slides_container_class)) {
            return this;
        }
        var self = this, container, slides_container = el, number_container, bullets_container, timer_container, idx = 0, animate, timer, locked = false, adjust_height_after = false;
        slides_container.children().first().addClass(settings.active_slide_class);
        self.update_slide_number = function(index) {
            if (settings.slide_number) {
                number_container.find("span:first").text(parseInt(index) + 1);
                number_container.find("span:last").text(slides_container.children().length);
            }
            if (settings.bullets) {
                bullets_container.children().removeClass(settings.bullets_active_class);
                $(bullets_container.children().get(index)).addClass(settings.bullets_active_class);
            }
        };
        self.update_active_link = function(index) {
            var link = $('a[data-orbit-link="' + slides_container.children().eq(index).attr("data-orbit-slide") + '"]');
            link.parents("ul").find("[data-orbit-link]").removeClass(settings.bullets_active_class);
            link.addClass(settings.bullets_active_class);
        };
        self.build_markup = function() {
            slides_container.wrap('<div class="' + settings.container_class + '"></div>');
            container = slides_container.parent();
            slides_container.addClass(settings.slides_container_class);
            if (settings.navigation_arrows) {
                container.append($('<a href="#"><span></span></a>').addClass(settings.prev_class));
                container.append($('<a href="#"><span></span></a>').addClass(settings.next_class));
            }
            if (settings.timer) {
                timer_container = $("<div>").addClass(settings.timer_container_class);
                timer_container.append("<span>");
                timer_container.append($("<div>").addClass(settings.timer_progress_class));
                timer_container.addClass(settings.timer_paused_class);
                container.append(timer_container);
            }
            if (settings.slide_number) {
                number_container = $("<div>").addClass(settings.slide_number_class);
                number_container.append("<span></span> " + settings.slide_number_text + " <span></span>");
                container.append(number_container);
            }
            if (settings.bullets) {
                bullets_container = $("<ol>").addClass(settings.bullets_container_class);
                container.append(bullets_container);
                slides_container.children().each(function(idx, el) {
                    var bullet = $("<li>").attr("data-orbit-slide", idx);
                    bullets_container.append(bullet);
                });
            }
            if (settings.stack_on_small) {
                container.addClass(settings.stack_on_small_class);
            }
            self.update_slide_number(0);
            self.update_active_link(0);
        };
        self._goto = function(next_idx, start_timer) {
            if (next_idx === idx) {
                return false;
            }
            if (typeof timer === "object") {
                timer.restart();
            }
            var slides = slides_container.children();
            var dir = "next";
            locked = true;
            if (next_idx < idx) {
                dir = "prev";
            }
            if (next_idx >= slides.length) {
                next_idx = 0;
            } else if (next_idx < 0) {
                next_idx = slides.length - 1;
            }
            var current = $(slides.get(idx));
            var next = $(slides.get(next_idx));
            current.css("zIndex", 2);
            current.removeClass(settings.active_slide_class);
            next.css("zIndex", 4).addClass(settings.active_slide_class);
            slides_container.trigger("orbit:before-slide-change");
            settings.before_slide_change();
            self.update_active_link(next_idx);
            var callback = function() {
                var unlock = function() {
                    idx = next_idx;
                    locked = false;
                    if (start_timer === true) {
                        timer = self.create_timer();
                        timer.start();
                    }
                    self.update_slide_number(idx);
                    slides_container.trigger("orbit:after-slide-change", [ {
                        slide_number: idx,
                        total_slides: slides.length
                    } ]);
                    settings.after_slide_change(idx, slides.length);
                };
                if (slides_container.height() != next.height() && settings.variable_height) {
                    slides_container.animate({
                        height: next.height()
                    }, 250, "linear", unlock);
                } else {
                    unlock();
                }
            };
            if (slides.length === 1) {
                callback();
                return false;
            }
            var start_animation = function() {
                if (dir === "next") {
                    animate.next(current, next, callback);
                }
                if (dir === "prev") {
                    animate.prev(current, next, callback);
                }
            };
            if (next.height() > slides_container.height() && settings.variable_height) {
                slides_container.animate({
                    height: next.height()
                }, 250, "linear", start_animation);
            } else {
                start_animation();
            }
        };
        self.next = function(e) {
            e.stopImmediatePropagation();
            e.preventDefault();
            self._goto(idx + 1);
        };
        self.prev = function(e) {
            e.stopImmediatePropagation();
            e.preventDefault();
            self._goto(idx - 1);
        };
        self.link_custom = function(e) {
            e.preventDefault();
            var link = $(this).attr("data-orbit-link");
            if (typeof link === "string" && (link = $.trim(link)) != "") {
                var slide = container.find("[data-orbit-slide=" + link + "]");
                if (slide.index() != -1) {
                    self._goto(slide.index());
                }
            }
        };
        self.link_bullet = function(e) {
            var index = $(this).attr("data-orbit-slide");
            if (typeof index === "string" && (index = $.trim(index)) != "") {
                self._goto(parseInt(index));
            }
        };
        self.timer_callback = function() {
            self._goto(idx + 1, true);
        };
        self.compute_dimensions = function() {
            var current = $(slides_container.children().get(idx));
            var h = current.height();
            if (!settings.variable_height) {
                slides_container.children().each(function() {
                    if ($(this).height() > h) {
                        h = $(this).height();
                    }
                });
            }
            slides_container.height(h);
        };
        self.create_timer = function() {
            var t = new Timer(container.find("." + settings.timer_container_class), settings, self.timer_callback);
            return t;
        };
        self.stop_timer = function() {
            if (typeof timer === "object") timer.stop();
        };
        self.toggle_timer = function() {
            var t = container.find("." + settings.timer_container_class);
            if (t.hasClass(settings.timer_paused_class)) {
                if (typeof timer === "undefined") {
                    timer = self.create_timer();
                }
                timer.start();
            } else {
                if (typeof timer === "object") {
                    timer.stop();
                }
            }
        };
        self.init = function() {
            self.build_markup();
            if (settings.timer) {
                timer = self.create_timer();
                timer.start();
            }
            animate = new FadeAnimation(settings, slides_container);
            if (settings.animation === "slide") animate = new SlideAnimation(settings, slides_container);
            container.on("click", "." + settings.next_class, self.next);
            container.on("click", "." + settings.prev_class, self.prev);
            container.on("click", "[data-orbit-slide]", self.link_bullet);
            container.on("click", self.toggle_timer);
            if (settings.swipe) {
                container.on("touchstart.fndtn.orbit", function(e) {
                    if (!e.touches) {
                        e = e.originalEvent;
                    }
                    var data = {
                        start_page_x: e.touches[0].pageX,
                        start_page_y: e.touches[0].pageY,
                        start_time: new Date().getTime(),
                        delta_x: 0,
                        is_scrolling: undefined
                    };
                    container.data("swipe-transition", data);
                    e.stopPropagation();
                }).on("touchmove.fndtn.orbit", function(e) {
                    if (!e.touches) {
                        e = e.originalEvent;
                    }
                    if (e.touches.length > 1 || e.scale && e.scale !== 1) return;
                    var data = container.data("swipe-transition");
                    if (typeof data === "undefined") {
                        data = {};
                    }
                    data.delta_x = e.touches[0].pageX - data.start_page_x;
                    if (typeof data.is_scrolling === "undefined") {
                        data.is_scrolling = !!(data.is_scrolling || Math.abs(data.delta_x) < Math.abs(e.touches[0].pageY - data.start_page_y));
                    }
                    if (!data.is_scrolling && !data.active) {
                        e.preventDefault();
                        var direction = data.delta_x < 0 ? idx + 1 : idx - 1;
                        data.active = true;
                        self._goto(direction);
                    }
                }).on("touchend.fndtn.orbit", function(e) {
                    container.data("swipe-transition", {});
                    e.stopPropagation();
                });
            }
            container.on("mouseenter.fndtn.orbit", function(e) {
                if (settings.timer && settings.pause_on_hover) {
                    self.stop_timer();
                }
            }).on("mouseleave.fndtn.orbit", function(e) {
                if (settings.timer && settings.resume_on_mouseout) {
                    timer.start();
                }
            });
            $(document).on("click", "[data-orbit-link]", self.link_custom);
            $(window).on("resize", self.compute_dimensions);
            $(window).on("load", self.compute_dimensions);
            $(window).on("load", function() {
                container.prev(".preloader").css("display", "none");
            });
            slides_container.trigger("orbit:ready");
        };
        self.init();
    };
    var Timer = function(el, settings, callback) {
        var self = this, duration = settings.timer_speed, progress = el.find("." + settings.timer_progress_class), start, timeout, left = -1;
        this.update_progress = function(w) {
            var new_progress = progress.clone();
            new_progress.attr("style", "");
            new_progress.css("width", w + "%");
            progress.replaceWith(new_progress);
            progress = new_progress;
        };
        this.restart = function() {
            clearTimeout(timeout);
            el.addClass(settings.timer_paused_class);
            left = -1;
            self.update_progress(0);
        };
        this.start = function() {
            if (!el.hasClass(settings.timer_paused_class)) {
                return true;
            }
            left = left === -1 ? duration : left;
            el.removeClass(settings.timer_paused_class);
            start = new Date().getTime();
            progress.animate({
                width: "100%"
            }, left, "linear");
            timeout = setTimeout(function() {
                self.restart();
                callback();
            }, left);
            el.trigger("orbit:timer-started");
        };
        this.stop = function() {
            if (el.hasClass(settings.timer_paused_class)) {
                return true;
            }
            clearTimeout(timeout);
            el.addClass(settings.timer_paused_class);
            var end = new Date().getTime();
            left = left - (end - start);
            var w = 100 - left / duration * 100;
            self.update_progress(w);
            el.trigger("orbit:timer-stopped");
        };
    };
    var SlideAnimation = function(settings, container) {
        var duration = settings.animation_speed;
        var is_rtl = $("html[dir=rtl]").length === 1;
        var margin = is_rtl ? "marginRight" : "marginLeft";
        var animMargin = {};
        animMargin[margin] = "0%";
        this.next = function(current, next, callback) {
            next.animate(animMargin, duration, "linear", function() {
                callback();
            });
            current.animate({
                "margin-left": "-100%"
            }, duration, function() {
                console.info("wtf");
            });
        };
        this.prev = function(current, prev, callback) {
            prev.css(margin, "-100%");
            prev.animate(animMargin, duration, "linear", function() {
                current.css(margin, "100%");
                callback();
            });
            current.animate({
                "margin-left": "100%"
            }, duration, function() {
                console.info("wtf");
            });
        };
    };
    var FadeAnimation = function(settings, container) {
        var duration = settings.animation_speed;
        var is_rtl = $("html[dir=rtl]").length === 1;
        var margin = is_rtl ? "marginRight" : "marginLeft";
        this.next = function(current, next, callback) {
            next.css({
                margin: "0%",
                opacity: "0.01"
            });
            next.animate({
                opacity: "1"
            }, duration, "linear", function() {
                current.css("margin", "100%");
                callback();
            });
        };
        this.prev = function(current, prev, callback) {
            prev.css({
                margin: "0%",
                opacity: "0.01"
            });
            prev.animate({
                opacity: "1"
            }, duration, "linear", function() {
                current.css("margin", "100%");
                callback();
            });
        };
    };
    Foundation.libs = Foundation.libs || {};
    Foundation.libs.orbit = {
        name: "orbit",
        version: "4.3.2",
        settings: {
            animation: "slide",
            timer_speed: 1e4,
            pause_on_hover: true,
            resume_on_mouseout: false,
            animation_speed: 500,
            stack_on_small: false,
            navigation_arrows: true,
            slide_number: true,
            slide_number_text: "of",
            container_class: "orbit-container",
            stack_on_small_class: "orbit-stack-on-small",
            next_class: "orbit-next",
            prev_class: "orbit-prev",
            timer_container_class: "orbit-timer",
            timer_paused_class: "paused",
            timer_progress_class: "orbit-progress",
            slides_container_class: "orbit-slides-container",
            bullets_container_class: "orbit-bullets",
            bullets_active_class: "active",
            slide_number_class: "orbit-slide-number",
            caption_class: "orbit-caption",
            active_slide_class: "active",
            orbit_transition_class: "orbit-transitioning",
            bullets: true,
            timer: true,
            variable_height: false,
            swipe: true,
            before_slide_change: noop,
            after_slide_change: noop
        },
        init: function(scope, method, options) {
            var self = this;
            Foundation.inherit(self, "data_options");
            if (typeof method === "object") {
                $.extend(true, self.settings, method);
            }
            if ($(scope).is("[data-orbit]")) {
                var $el = $(scope);
                var opts = self.data_options($el);
                new Orbit($el, $.extend({}, self.settings, opts));
            }
            $("[data-orbit]", scope).each(function(idx, el) {
                var $el = $(el);
                var opts = self.data_options($el);
                new Orbit($el, $.extend({}, self.settings, opts));
            });
        }
    };
})(Foundation.zj, this, this.document);

(function($, window, document, undefined) {
    "use strict";
    Foundation.libs.interchange = {
        name: "interchange",
        version: "4.2.4",
        cache: {},
        images_loaded: false,
        settings: {
            load_attr: "interchange",
            named_queries: {
                "default": "only screen and (min-width: 1px)",
                small: "only screen and (min-width: 768px)",
                medium: "only screen and (min-width: 1280px)",
                large: "only screen and (min-width: 1440px)",
                landscape: "only screen and (orientation: landscape)",
                portrait: "only screen and (orientation: portrait)",
                retina: "only screen and (-webkit-min-device-pixel-ratio: 2)," + "only screen and (min--moz-device-pixel-ratio: 2)," + "only screen and (-o-min-device-pixel-ratio: 2/1)," + "only screen and (min-device-pixel-ratio: 2)," + "only screen and (min-resolution: 192dpi)," + "only screen and (min-resolution: 2dppx)"
            },
            directives: {
                replace: function(el, path) {
                    if (/IMG/.test(el[0].nodeName)) {
                        var orig_path = el[0].src;
                        if (new RegExp(path, "i").test(orig_path)) return;
                        el[0].src = path;
                        return el.trigger("replace", [ el[0].src, orig_path ]);
                    }
                }
            }
        },
        init: function(scope, method, options) {
            Foundation.inherit(this, "throttle");
            if (typeof method === "object") {
                $.extend(true, this.settings, method);
            }
            this.events();
            this.images();
            if (typeof method !== "string") {
                return this.settings.init;
            } else {
                return this[method].call(this, options);
            }
        },
        events: function() {
            var self = this;
            $(window).on("resize.fndtn.interchange", self.throttle(function() {
                self.resize.call(self);
            }, 50));
        },
        resize: function() {
            var cache = this.cache;
            if (!this.images_loaded) {
                setTimeout($.proxy(this.resize, this), 50);
                return;
            }
            for (var uuid in cache) {
                if (cache.hasOwnProperty(uuid)) {
                    var passed = this.results(uuid, cache[uuid]);
                    if (passed) {
                        this.settings.directives[passed.scenario[1]](passed.el, passed.scenario[0]);
                    }
                }
            }
        },
        results: function(uuid, scenarios) {
            var count = scenarios.length;
            if (count > 0) {
                var el = $('[data-uuid="' + uuid + '"]');
                for (var i = count - 1; i >= 0; i--) {
                    var mq, rule = scenarios[i][2];
                    if (this.settings.named_queries.hasOwnProperty(rule)) {
                        mq = matchMedia(this.settings.named_queries[rule]);
                    } else {
                        mq = matchMedia(rule);
                    }
                    if (mq.matches) {
                        return {
                            el: el,
                            scenario: scenarios[i]
                        };
                    }
                }
            }
            return false;
        },
        images: function(force_update) {
            if (typeof this.cached_images === "undefined" || force_update) {
                return this.update_images();
            }
            return this.cached_images;
        },
        update_images: function() {
            var images = document.getElementsByTagName("img"), count = images.length, loaded_count = 0, data_attr = "data-" + this.settings.load_attr;
            this.cached_images = [];
            this.images_loaded = false;
            for (var i = count - 1; i >= 0; i--) {
                this.loaded($(images[i]), function(image) {
                    loaded_count++;
                    if (image) {
                        var str = image.getAttribute(data_attr) || "";
                        if (str.length > 0) {
                            this.cached_images.push(image);
                        }
                    }
                    if (loaded_count === count) {
                        this.images_loaded = true;
                        this.enhance();
                    }
                }.bind(this));
            }
            return "deferred";
        },
        loaded: function(image, callback) {
            function loaded() {
                callback(image[0]);
            }
            function bindLoad() {
                this.one("load", loaded);
                if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
                    var src = this.attr("src"), param = src.match(/\?/) ? "&" : "?";
                    param += "random=" + new Date().getTime();
                    this.attr("src", src + param);
                }
            }
            if (!image.attr("src")) {
                loaded();
                return;
            }
            if (image[0].complete || image[0].readyState === 4) {
                loaded();
            } else {
                bindLoad.call(image);
            }
        },
        enhance: function() {
            var count = this.images().length;
            for (var i = count - 1; i >= 0; i--) {
                this._object($(this.images()[i]));
            }
            return $(window).trigger("resize");
        },
        parse_params: function(path, directive, mq) {
            return [ this.trim(path), this.convert_directive(directive), this.trim(mq) ];
        },
        convert_directive: function(directive) {
            var trimmed = this.trim(directive);
            if (trimmed.length > 0) {
                return trimmed;
            }
            return "replace";
        },
        _object: function(el) {
            var raw_arr = this.parse_data_attr(el), scenarios = [], count = raw_arr.length;
            if (count > 0) {
                for (var i = count - 1; i >= 0; i--) {
                    var split = raw_arr[i].split(/\((.*?)(\))$/);
                    if (split.length > 1) {
                        var cached_split = split[0].split(","), params = this.parse_params(cached_split[0], cached_split[1], split[1]);
                        scenarios.push(params);
                    }
                }
            }
            return this.store(el, scenarios);
        },
        uuid: function(separator) {
            var delim = separator || "-";
            function S4() {
                return ((1 + Math.random()) * 65536 | 0).toString(16).substring(1);
            }
            return S4() + S4() + delim + S4() + delim + S4() + delim + S4() + delim + S4() + S4() + S4();
        },
        store: function(el, scenarios) {
            var uuid = this.uuid(), current_uuid = el.data("uuid");
            if (current_uuid) return this.cache[current_uuid];
            el.attr("data-uuid", uuid);
            return this.cache[uuid] = scenarios;
        },
        trim: function(str) {
            if (typeof str === "string") {
                return $.trim(str);
            }
            return str;
        },
        parse_data_attr: function(el) {
            var raw = el.data(this.settings.load_attr).split(/\[(.*?)\]/), count = raw.length, output = [];
            for (var i = count - 1; i >= 0; i--) {
                if (raw[i].replace(/[\W\d]+/, "").length > 4) {
                    output.push(raw[i]);
                }
            }
            return output;
        },
        reflow: function() {
            this.images(true);
        }
    };
})(Foundation.zj, this, this.document);

(function($, window, document, undefined) {
    "use strict";
    Foundation.libs.abide = {
        name: "abide",
        version: "4.3.3",
        settings: {
            live_validate: true,
            focus_on_invalid: true,
            timeout: 1e3,
            patterns: {
                alpha: /[a-zA-Z]+/,
                alpha_numeric: /[a-zA-Z0-9]+/,
                integer: /-?\d+/,
                number: /-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?/,
                password: /(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/,
                card: /^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,
                cvv: /^([0-9]){3,4}$/,
                email: /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
                url: /(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?/,
                domain: /^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/,
                datetime: /([0-2][0-9]{3})\-([0-1][0-9])\-([0-3][0-9])T([0-5][0-9])\:([0-5][0-9])\:([0-5][0-9])(Z|([\-\+]([0-1][0-9])\:00))/,
                date: /(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))/,
                time: /(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}/,
                dateISO: /\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/,
                month_day_year: /(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d/,
                color: /^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/
            }
        },
        timer: null,
        init: function(scope, method, options) {
            if (typeof method === "object") {
                $.extend(true, this.settings, method);
            }
            if (typeof method !== "string") {
                if (!this.settings.init) {
                    this.events();
                }
            } else {
                return this[method].call(this, options);
            }
        },
        events: function() {
            var self = this, forms = $("form[data-abide]", this.scope).attr("novalidate", "novalidate");
            forms.on("submit validate", function(e) {
                var is_ajax = /ajax/i.test($(this).attr("data-abide"));
                return self.validate($(this).find("input, textarea, select").get(), e, is_ajax);
            });
            this.settings.init = true;
            if (!this.settings.live_validate) return;
            forms.find("input, textarea, select").on("blur change", function(e) {
                self.validate([ this ], e);
            }).on("keydown", function(e) {
                clearTimeout(self.timer);
                self.timer = setTimeout(function() {
                    self.validate([ this ], e);
                }.bind(this), self.settings.timeout);
            });
        },
        validate: function(els, e, is_ajax) {
            var validations = this.parse_patterns(els), validation_count = validations.length, form = $(els[0]).closest("form"), submit_event = /submit/.test(e.type);
            for (var i = 0; i < validation_count; i++) {
                if (!validations[i] && (submit_event || is_ajax)) {
                    if (this.settings.focus_on_invalid) els[i].focus();
                    form.trigger("invalid");
                    $(els[i]).closest("form").attr("data-invalid", "");
                    return false;
                }
            }
            if (submit_event || is_ajax) {
                form.trigger("valid");
            }
            form.removeAttr("data-invalid");
            if (is_ajax) return false;
            return true;
        },
        parse_patterns: function(els) {
            var count = els.length, el_patterns = [];
            for (var i = count - 1; i >= 0; i--) {
                el_patterns.push(this.pattern(els[i]));
            }
            return this.check_validation_and_apply_styles(el_patterns);
        },
        pattern: function(el) {
            var type = el.getAttribute("type"), required = typeof el.getAttribute("required") === "string";
            if (this.settings.patterns.hasOwnProperty(type)) {
                return [ el, this.settings.patterns[type], required ];
            }
            var pattern = el.getAttribute("pattern") || "";
            if (this.settings.patterns.hasOwnProperty(pattern) && pattern.length > 0) {
                return [ el, this.settings.patterns[pattern], required ];
            } else if (pattern.length > 0) {
                return [ el, new RegExp(pattern), required ];
            }
            pattern = /.*/;
            return [ el, pattern, required ];
        },
        check_validation_and_apply_styles: function(el_patterns) {
            var count = el_patterns.length, validations = [];
            for (var i = count - 1; i >= 0; i--) {
                var el = el_patterns[i][0], required = el_patterns[i][2], value = el.value, is_equal = el.getAttribute("data-equalto"), is_radio = el.type === "radio", valid_length = required ? el.value.length > 0 : true;
                if (is_radio && required) {
                    validations.push(this.valid_radio(el, required));
                } else if (is_equal && required) {
                    validations.push(this.valid_equal(el, required));
                } else {
                    if (el_patterns[i][1].test(value) && valid_length || !required && el.value.length < 1) {
                        $(el).removeAttr("data-invalid").parent().removeClass("error");
                        validations.push(true);
                    } else {
                        $(el).attr("data-invalid", "").parent().addClass("error");
                        validations.push(false);
                    }
                }
            }
            return validations;
        },
        valid_radio: function(el, required) {
            var name = el.getAttribute("name"), group = document.getElementsByName(name), count = group.length, valid = false;
            for (var i = 0; i < count; i++) {
                if (group[i].checked) valid = true;
            }
            for (var i = 0; i < count; i++) {
                if (valid) {
                    $(group[i]).removeAttr("data-invalid").parent().removeClass("error");
                } else {
                    $(group[i]).attr("data-invalid", "").parent().addClass("error");
                }
            }
            return valid;
        },
        valid_equal: function(el, required) {
            var from = document.getElementById(el.getAttribute("data-equalto")).value, to = el.value, valid = from === to;
            if (valid) {
                $(el).removeAttr("data-invalid").parent().removeClass("error");
            } else {
                $(el).attr("data-invalid", "").parent().addClass("error");
            }
            return valid;
        }
    };
})(Foundation.zj, this, this.document);

(function($, window, document, undefined) {
    "use strict";
    Foundation.libs.reveal = {
        name: "reveal",
        version: "4.3.2",
        locked: false,
        settings: {
            animation: "fadeAndPop",
            animationSpeed: 250,
            closeOnBackgroundClick: true,
            closeOnEsc: true,
            dismissModalClass: "close-reveal-modal",
            bgClass: "reveal-modal-bg",
            open: function() {},
            opened: function() {},
            close: function() {},
            closed: function() {},
            bg: $(".reveal-modal-bg"),
            css: {
                open: {
                    opacity: 0,
                    visibility: "visible",
                    display: "block"
                },
                close: {
                    opacity: 1,
                    visibility: "hidden",
                    display: "none"
                }
            }
        },
        init: function(scope, method, options) {
            Foundation.inherit(this, "data_options delay");
            if (typeof method === "object") {
                $.extend(true, this.settings, method);
            } else if (typeof options !== "undefined") {
                $.extend(true, this.settings, options);
            }
            if (typeof method !== "string") {
                this.events();
                return this.settings.init;
            } else {
                return this[method].call(this, options);
            }
        },
        events: function() {
            var self = this;
            $(this.scope).off(".fndtn.reveal").on("click.fndtn.reveal", "[data-reveal-id]", function(e) {
                e.preventDefault();
                if (!self.locked) {
                    var element = $(this), ajax = element.data("reveal-ajax");
                    self.locked = true;
                    if (typeof ajax === "undefined") {
                        self.open.call(self, element);
                    } else {
                        var url = ajax === true ? element.attr("href") : ajax;
                        self.open.call(self, element, {
                            url: url
                        });
                    }
                }
            }).on("click.fndtn.reveal touchend", this.close_targets(), function(e) {
                e.preventDefault();
                if (!self.locked) {
                    var settings = $.extend({}, self.settings, self.data_options($(".reveal-modal.open"))), bgClicked = $(e.target)[0] === $("." + settings.bgClass)[0];
                    if (bgClicked && !settings.closeOnBackgroundClick) {
                        return;
                    }
                    self.locked = true;
                    self.close.call(self, bgClicked ? $(".reveal-modal.open") : $(this).closest(".reveal-modal"));
                }
            });
            if ($(this.scope).hasClass("reveal-modal")) {
                $(this.scope).on("open.fndtn.reveal", this.settings.open).on("opened.fndtn.reveal", this.settings.opened).on("opened.fndtn.reveal", this.open_video).on("close.fndtn.reveal", this.settings.close).on("closed.fndtn.reveal", this.settings.closed).on("closed.fndtn.reveal", this.close_video);
            } else {
                $(this.scope).on("open.fndtn.reveal", ".reveal-modal", this.settings.open).on("opened.fndtn.reveal", ".reveal-modal", this.settings.opened).on("opened.fndtn.reveal", ".reveal-modal", this.open_video).on("close.fndtn.reveal", ".reveal-modal", this.settings.close).on("closed.fndtn.reveal", ".reveal-modal", this.settings.closed).on("closed.fndtn.reveal", ".reveal-modal", this.close_video);
            }
            $("body").bind("keyup.reveal", function(event) {
                var open_modal = $(".reveal-modal.open"), settings = $.extend({}, self.settings, self.data_options(open_modal));
                if (event.which === 27 && settings.closeOnEsc) {
                    open_modal.foundation("reveal", "close");
                }
            });
            return true;
        },
        open: function(target, ajax_settings) {
            if (target) {
                if (typeof target.selector !== "undefined") {
                    var modal = $("#" + target.data("reveal-id"));
                } else {
                    var modal = $(this.scope);
                    ajax_settings = target;
                }
            } else {
                var modal = $(this.scope);
            }
            if (!modal.hasClass("open")) {
                var open_modal = $(".reveal-modal.open");
                if (typeof modal.data("css-top") === "undefined") {
                    modal.data("css-top", parseInt(modal.css("top"), 10)).data("offset", this.cache_offset(modal));
                }
                modal.trigger("open");
                if (open_modal.length < 1) {
                    this.toggle_bg();
                }
                if (typeof ajax_settings === "undefined" || !ajax_settings.url) {
                    this.hide(open_modal, this.settings.css.close);
                    this.show(modal, this.settings.css.open);
                } else {
                    var self = this, old_success = typeof ajax_settings.success !== "undefined" ? ajax_settings.success : null;
                    $.extend(ajax_settings, {
                        success: function(data, textStatus, jqXHR) {
                            if ($.isFunction(old_success)) {
                                old_success(data, textStatus, jqXHR);
                            }
                            modal.html(data);
                            $(modal).foundation("section", "reflow");
                            self.hide(open_modal, self.settings.css.close);
                            self.show(modal, self.settings.css.open);
                        }
                    });
                    $.ajax(ajax_settings);
                }
            }
        },
        close: function(modal) {
            var modal = modal && modal.length ? modal : $(this.scope), open_modals = $(".reveal-modal.open");
            if (open_modals.length > 0) {
                this.locked = true;
                modal.trigger("close");
                this.toggle_bg();
                this.hide(open_modals, this.settings.css.close);
            }
        },
        close_targets: function() {
            var base = "." + this.settings.dismissModalClass;
            if (this.settings.closeOnBackgroundClick) {
                return base + ", ." + this.settings.bgClass;
            }
            return base;
        },
        toggle_bg: function() {
            if ($("." + this.settings.bgClass).length === 0) {
                this.settings.bg = $("<div />", {
                    "class": this.settings.bgClass
                }).appendTo("body");
            }
            if (this.settings.bg.filter(":visible").length > 0) {
                this.hide(this.settings.bg);
            } else {
                this.show(this.settings.bg);
            }
        },
        show: function(el, css) {
            if (css) {
                if (el.parent("body").length === 0) {
                    var placeholder = el.wrap('<div style="display: none;" />').parent();
                    el.on("closed.fndtn.reveal.wrapped", function() {
                        el.detach().appendTo(placeholder);
                        el.unwrap().unbind("closed.fndtn.reveal.wrapped");
                    });
                    el.detach().appendTo("body");
                }
                if (/pop/i.test(this.settings.animation)) {
                    css.top = $(window).scrollTop() - el.data("offset") + "px";
                    var end_css = {
                        top: $(window).scrollTop() + el.data("css-top") + "px",
                        opacity: 1
                    };
                    return this.delay(function() {
                        return el.css(css).animate(end_css, this.settings.animationSpeed, "linear", function() {
                            this.locked = false;
                            el.trigger("opened");
                        }.bind(this)).addClass("open");
                    }.bind(this), this.settings.animationSpeed / 2);
                }
                if (/slide/i.test(this.settings.animation)) {
                    css.top = "0px";
                    var end_css = {
                        top: $("nav.top-bar").height() + "px",
                        opacity: 1
                    };
                    return this.delay(function() {
                        return el.css(css).animate(end_css, this.settings.animationSpeed, "linear", function() {
                            this.locked = false;
                            el.trigger("opened");
                        }.bind(this)).addClass("open");
                    }.bind(this), this.settings.animationSpeed / 2);
                }
                if (/fade/i.test(this.settings.animation)) {
                    var end_css = {
                        opacity: 1
                    };
                    return this.delay(function() {
                        return el.css(css).animate(end_css, this.settings.animationSpeed, "linear", function() {
                            this.locked = false;
                            el.trigger("opened");
                        }.bind(this)).addClass("open");
                    }.bind(this), this.settings.animationSpeed / 2);
                }
                return el.css(css).show().css({
                    opacity: 1
                }).addClass("open").trigger("opened");
            }
            if (/fade/i.test(this.settings.animation)) {
                return el.fadeIn(this.settings.animationSpeed / 2);
            }
            return el.show();
        },
        hide: function(el, css) {
            if (css) {
                if (/pop/i.test(this.settings.animation)) {
                    var end_css = {
                        top: -$(window).scrollTop() - el.data("offset") + "px",
                        opacity: 0
                    };
                    return this.delay(function() {
                        return el.animate(end_css, this.settings.animationSpeed, "linear", function() {
                            this.locked = false;
                            el.css(css).trigger("closed");
                        }.bind(this)).removeClass("open");
                    }.bind(this), this.settings.animationSpeed / 2);
                }
                if (/fade/i.test(this.settings.animation)) {
                    var end_css = {
                        opacity: 0
                    };
                    return this.delay(function() {
                        return el.animate(end_css, this.settings.animationSpeed, "linear", function() {
                            this.locked = false;
                            el.css(css).trigger("closed");
                        }.bind(this)).removeClass("open");
                    }.bind(this), this.settings.animationSpeed / 2);
                }
                return el.hide().css(css).removeClass("open").trigger("closed");
            }
            if (/fade/i.test(this.settings.animation)) {
                return el.fadeOut(this.settings.animationSpeed / 2);
            }
            return el.hide();
        },
        close_video: function(e) {
            var video = $(this).find(".flex-video"), iframe = video.find("iframe");
            if (iframe.length > 0) {
                iframe.attr("data-src", iframe[0].src);
                iframe.attr("src", "about:blank");
                video.hide();
            }
        },
        open_video: function(e) {
            var video = $(this).find(".flex-video"), iframe = video.find("iframe");
            if (iframe.length > 0) {
                var data_src = iframe.attr("data-src");
                if (typeof data_src === "string") {
                    iframe[0].src = iframe.attr("data-src");
                } else {
                    var src = iframe[0].src;
                    iframe[0].src = undefined;
                    iframe[0].src = src;
                }
                video.show();
            }
        },
        cache_offset: function(modal) {
            var offset = modal.show().height() + parseInt(modal.css("top"), 10);
            modal.hide();
            return offset;
        },
        off: function() {
            $(this.scope).off(".fndtn.reveal");
        },
        reflow: function() {}
    };
})(Foundation.zj, this, this.document);

(function($, window, document, undefined) {
    "use strict";
    Foundation.libs.tooltips = {
        name: "tooltips",
        version: "4.3.2",
        settings: {
            selector: ".has-tip",
            additionalInheritableClasses: [],
            tooltipClass: ".tooltip",
            touchCloseText: "tap to close",
            appendTo: "body",
            "disable-for-touch": false,
            tipTemplate: function(selector, content) {
                return '<span data-selector="' + selector + '" class="' + Foundation.libs.tooltips.settings.tooltipClass.substring(1) + '">' + content + '<span class="nub"></span></span>';
            }
        },
        cache: {},
        init: function(scope, method, options) {
            Foundation.inherit(this, "data_options");
            var self = this;
            if (typeof method === "object") {
                $.extend(true, this.settings, method);
            } else if (typeof options !== "undefined") {
                $.extend(true, this.settings, options);
            }
            if (typeof method !== "string") {
                if (Modernizr.touch) {
                    $(this.scope).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip", "[data-tooltip]", function(e) {
                        var settings = $.extend({}, self.settings, self.data_options($(this)));
                        if (!settings["disable-for-touch"]) {
                            e.preventDefault();
                            $(settings.tooltipClass).hide();
                            self.showOrCreateTip($(this));
                        }
                    }).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip", this.settings.tooltipClass, function(e) {
                        e.preventDefault();
                        $(this).fadeOut(150);
                    });
                } else {
                    $(this.scope).on("mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip", "[data-tooltip]", function(e) {
                        var $this = $(this);
                        if (/enter|over/i.test(e.type)) {
                            self.showOrCreateTip($this);
                        } else if (e.type === "mouseout" || e.type === "mouseleave") {
                            self.hide($this);
                        }
                    });
                }
            } else {
                return this[method].call(this, options);
            }
        },
        showOrCreateTip: function($target) {
            var $tip = this.getTip($target);
            if ($tip && $tip.length > 0) {
                return this.show($target);
            }
            return this.create($target);
        },
        getTip: function($target) {
            var selector = this.selector($target), tip = null;
            if (selector) {
                tip = $('span[data-selector="' + selector + '"]' + this.settings.tooltipClass);
            }
            return typeof tip === "object" ? tip : false;
        },
        selector: function($target) {
            var id = $target.attr("id"), dataSelector = $target.attr("data-tooltip") || $target.attr("data-selector");
            if ((id && id.length < 1 || !id) && typeof dataSelector != "string") {
                dataSelector = "tooltip" + Math.random().toString(36).substring(7);
                $target.attr("data-selector", dataSelector);
            }
            return id && id.length > 0 ? id : dataSelector;
        },
        create: function($target) {
            var $tip = $(this.settings.tipTemplate(this.selector($target), $("<div></div>").html($target.attr("title")).html())), classes = this.inheritable_classes($target);
            $tip.addClass(classes).appendTo(this.settings.appendTo);
            if (Modernizr.touch) {
                $tip.append('<span class="tap-to-close">' + this.settings.touchCloseText + "</span>");
            }
            $target.removeAttr("title").attr("title", "");
            this.show($target);
        },
        reposition: function(target, tip, classes) {
            var width, nub, nubHeight, nubWidth, column, objPos;
            tip.css("visibility", "hidden").show();
            width = target.data("width");
            nub = tip.children(".nub");
            nubHeight = this.outerHeight(nub);
            nubWidth = this.outerHeight(nub);
            objPos = function(obj, top, right, bottom, left, width) {
                return obj.css({
                    top: top ? top : "auto",
                    bottom: bottom ? bottom : "auto",
                    left: left ? left : "auto",
                    right: right ? right : "auto",
                    width: width ? width : "auto"
                }).end();
            };
            objPos(tip, target.offset().top + this.outerHeight(target) + 10, "auto", "auto", target.offset().left, width);
            if ($(window).width() < 767) {
                objPos(tip, target.offset().top + this.outerHeight(target) + 10, "auto", "auto", 12.5, $(this.scope).width());
                tip.addClass("tip-override");
                objPos(nub, -nubHeight, "auto", "auto", target.offset().left);
            } else {
                var left = target.offset().left;
                if (Foundation.rtl) {
                    left = target.offset().left + target.offset().width - this.outerWidth(tip);
                }
                objPos(tip, target.offset().top + this.outerHeight(target) + 10, "auto", "auto", left, width);
                tip.removeClass("tip-override");
                if (classes && classes.indexOf("tip-top") > -1) {
                    objPos(tip, target.offset().top - this.outerHeight(tip), "auto", "auto", left, width).removeClass("tip-override");
                } else if (classes && classes.indexOf("tip-left") > -1) {
                    objPos(tip, target.offset().top + this.outerHeight(target) / 2 - nubHeight * 2.5, "auto", "auto", target.offset().left - this.outerWidth(tip) - nubHeight, width).removeClass("tip-override");
                } else if (classes && classes.indexOf("tip-right") > -1) {
                    objPos(tip, target.offset().top + this.outerHeight(target) / 2 - nubHeight * 2.5, "auto", "auto", target.offset().left + this.outerWidth(target) + nubHeight, width).removeClass("tip-override");
                }
            }
            tip.css("visibility", "visible").hide();
        },
        inheritable_classes: function(target) {
            var inheritables = [ "tip-top", "tip-left", "tip-bottom", "tip-right", "noradius" ].concat(this.settings.additionalInheritableClasses), classes = target.attr("class"), filtered = classes ? $.map(classes.split(" "), function(el, i) {
                if ($.inArray(el, inheritables) !== -1) {
                    return el;
                }
            }).join(" ") : "";
            return $.trim(filtered);
        },
        show: function($target) {
            var $tip = this.getTip($target);
            this.reposition($target, $tip, $target.attr("class"));
            $tip.fadeIn(150);
        },
        hide: function($target) {
            var $tip = this.getTip($target);
            $tip.fadeOut(150);
        },
        reload: function() {
            var $self = $(this);
            return $self.data("fndtn-tooltips") ? $self.foundationTooltips("destroy").foundationTooltips("init") : $self.foundationTooltips("init");
        },
        off: function() {
            $(this.scope).off(".fndtn.tooltip");
            $(this.settings.tooltipClass).each(function(i) {
                $("[data-tooltip]").get(i).attr("title", $(this).text());
            }).remove();
        },
        reflow: function() {}
    };
})(Foundation.zj, this, this.document);

!function(t, n) {
    function e(t) {
        return "object" == typeof t;
    }
    function o(t) {
        return "string" == typeof t;
    }
    function i(t) {
        return "number" == typeof t;
    }
    function a(t) {
        return t === n;
    }
    function r() {
        q = google.maps, A || (A = {
            verbose: !1,
            queryLimit: {
                attempt: 5,
                delay: 250,
                random: 250
            },
            classes: function() {
                var n = {};
                return t.each("Map Marker InfoWindow Circle Rectangle OverlayView StreetViewPanorama KmlLayer TrafficLayer BicyclingLayer GroundOverlay StyledMapType ImageMapType".split(" "), function(t, e) {
                    n[e] = q[e];
                }), n;
            }(),
            map: {
                mapTypeId: q.MapTypeId.ROADMAP,
                center: [ 46.578498, 2.457275 ],
                zoom: 2
            },
            overlay: {
                pane: "floatPane",
                content: "",
                offset: {
                    x: 0,
                    y: 0
                }
            },
            geoloc: {
                getCurrentPosition: {
                    maximumAge: 6e4,
                    timeout: 5e3
                }
            }
        });
    }
    function s(t, n) {
        return a(t) ? "gmap3_" + (n ? Z + 1 : ++Z) : t;
    }
    function u(t) {
        var n, e = q.version.split(".");
        for (t = t.split("."), n = 0; n < e.length; n++) e[n] = parseInt(e[n], 10);
        for (n = 0; n < t.length; n++) {
            if (t[n] = parseInt(t[n], 10), !e.hasOwnProperty(n)) return !1;
            if (e[n] < t[n]) return !1;
        }
        return !0;
    }
    function l(n, e, o, i, a) {
        function r(e, i) {
            e && t.each(e, function(t, e) {
                var r = n, s = e;
                R(e) && (r = e[0], s = e[1]), i(o, t, function(t) {
                    s.apply(r, [ a || o, t, u ]);
                });
            });
        }
        var s = e.td || {}, u = {
            id: i,
            data: s.data,
            tag: s.tag
        };
        r(s.events, q.event.addListener), r(s.onces, q.event.addListenerOnce);
    }
    function d(t) {
        var n, e = [];
        for (n in t) t.hasOwnProperty(n) && e.push(n);
        return e;
    }
    function c(t, n) {
        var e, o = arguments;
        for (e = 2; e < o.length; e++) if (n in o[e] && o[e].hasOwnProperty(n)) return void (t[n] = o[e][n]);
    }
    function p(n, e) {
        var o, i, a = [ "data", "tag", "id", "events", "onces" ], r = {};
        if (n.td) for (o in n.td) n.td.hasOwnProperty(o) && "options" !== o && "values" !== o && (r[o] = n.td[o]);
        for (i = 0; i < a.length; i++) c(r, a[i], e, n.td);
        return r.options = t.extend({}, n.opts || {}, e.options || {}), r;
    }
    function f() {
        if (A.verbose) {
            var t, n = [];
            if (window.console && z(console.error)) {
                for (t = 0; t < arguments.length; t++) n.push(arguments[t]);
                console.error.apply(console, n);
            } else {
                for (n = "", t = 0; t < arguments.length; t++) n += arguments[t].toString() + " ";
                alert(n);
            }
        }
    }
    function g(t) {
        return (i(t) || o(t)) && "" !== t && !isNaN(t);
    }
    function h(t) {
        var n, o = [];
        if (!a(t)) if (e(t)) if (i(t.length)) o = t; else for (n in t) o.push(t[n]); else o.push(t);
        return o;
    }
    function v(n) {
        return n ? z(n) ? n : (n = h(n), function(o) {
            var i;
            if (a(o)) return !1;
            if (e(o)) {
                for (i = 0; i < o.length; i++) if (t.inArray(o[i], n) >= 0) return !0;
                return !1;
            }
            return t.inArray(o, n) >= 0;
        }) : void 0;
    }
    function m(t, n, e) {
        var i = n ? t : null;
        return !t || o(t) ? i : t.latLng ? m(t.latLng) : t instanceof q.LatLng ? t : g(t.lat) ? new q.LatLng(t.lat, t.lng) : !e && R(t) && g(t[0]) && g(t[1]) ? new q.LatLng(t[0], t[1]) : i;
    }
    function y(t) {
        var n, e;
        return !t || t instanceof q.LatLngBounds ? t || null : (R(t) ? 2 === t.length ? (n = m(t[0]), 
        e = m(t[1])) : 4 === t.length && (n = m([ t[0], t[1] ]), e = m([ t[2], t[3] ])) : "ne" in t && "sw" in t ? (n = m(t.ne), 
        e = m(t.sw)) : "n" in t && "e" in t && "s" in t && "w" in t && (n = m([ t.n, t.e ]), 
        e = m([ t.s, t.w ])), n && e ? new q.LatLngBounds(e, n) : null);
    }
    function w(t, n, e, i, a) {
        var r = e ? m(i.td, !1, !0) : !1, s = r ? {
            latLng: r
        } : i.td.address ? o(i.td.address) ? {
            address: i.td.address
        } : i.td.address : !1, u = s ? G.get(s) : !1, l = this;
        s ? (a = a || 0, u ? (i.latLng = u.results[0].geometry.location, i.results = u.results, 
        i.status = u.status, n.apply(t, [ i ])) : (s.location && (s.location = m(s.location)), 
        s.bounds && (s.bounds = y(s.bounds)), M().geocode(s, function(o, r) {
            r === q.GeocoderStatus.OK ? (G.store(s, {
                results: o,
                status: r
            }), i.latLng = o[0].geometry.location, i.results = o, i.status = r, n.apply(t, [ i ])) : r === q.GeocoderStatus.OVER_QUERY_LIMIT && a < A.queryLimit.attempt ? setTimeout(function() {
                w.apply(l, [ t, n, e, i, a + 1 ]);
            }, A.queryLimit.delay + Math.floor(Math.random() * A.queryLimit.random)) : (f("geocode failed", r, s), 
            i.latLng = i.results = !1, i.status = r, n.apply(t, [ i ]));
        }))) : (i.latLng = m(i.td, !1, !0), n.apply(t, [ i ]));
    }
    function L(n, e, o, i) {
        function a() {
            do s++; while (s < n.length && !("address" in n[s]));
            return s >= n.length ? void o.apply(e, [ i ]) : void w(r, function(e) {
                delete e.td, t.extend(n[s], e), a.apply(r, []);
            }, !0, {
                td: n[s]
            });
        }
        var r = this, s = -1;
        a();
    }
    function b(t, n, e) {
        var o = !1;
        navigator && navigator.geolocation ? navigator.geolocation.getCurrentPosition(function(i) {
            o || (o = !0, e.latLng = new q.LatLng(i.coords.latitude, i.coords.longitude), n.apply(t, [ e ]));
        }, function() {
            o || (o = !0, e.latLng = !1, n.apply(t, [ e ]));
        }, e.opts.getCurrentPosition) : (e.latLng = !1, n.apply(t, [ e ]));
    }
    function x(t) {
        var n, o = !1;
        if (e(t) && t.hasOwnProperty("get")) {
            for (n in t) if ("get" !== n) return !1;
            o = !t.get.hasOwnProperty("callback");
        }
        return o;
    }
    function M() {
        return V.geocoder || (V.geocoder = new q.Geocoder()), V.geocoder;
    }
    function I() {
        var t = [];
        this.get = function(n) {
            if (t.length) {
                var o, i, a, r, s, u = d(n);
                for (o = 0; o < t.length; o++) {
                    for (r = t[o], s = u.length === r.keys.length, i = 0; i < u.length && s; i++) a = u[i], 
                    s = a in r.request, s && (s = e(n[a]) && "equals" in n[a] && z(n[a]) ? n[a].equals(r.request[a]) : n[a] === r.request[a]);
                    if (s) return r.results;
                }
            }
        }, this.store = function(n, e) {
            t.push({
                request: n,
                keys: d(n),
                results: e
            });
        };
    }
    function P() {
        var t = [], n = this;
        n.empty = function() {
            return !t.length;
        }, n.add = function(n) {
            t.push(n);
        }, n.get = function() {
            return t.length ? t[0] : !1;
        }, n.ack = function() {
            t.shift();
        };
    }
    function k() {
        function n(t) {
            return {
                id: t.id,
                name: t.name,
                object: t.obj,
                tag: t.tag,
                data: t.data
            };
        }
        function e(t) {
            z(t.setMap) && t.setMap(null), z(t.remove) && t.remove(), z(t.free) && t.free(), 
            t = null;
        }
        var o = {}, i = {}, r = this;
        r.add = function(t, n, e, a) {
            var u = t.td || {}, l = s(u.id);
            return o[n] || (o[n] = []), l in i && r.clearById(l), i[l] = {
                obj: e,
                sub: a,
                name: n,
                id: l,
                tag: u.tag,
                data: u.data
            }, o[n].push(l), l;
        }, r.getById = function(t, e, o) {
            var a = !1;
            return t in i && (a = e ? i[t].sub : o ? n(i[t]) : i[t].obj), a;
        }, r.get = function(t, e, a, r) {
            var s, u, l = v(a);
            if (!o[t] || !o[t].length) return null;
            for (s = o[t].length; s; ) if (s--, u = o[t][e ? s : o[t].length - s - 1], u && i[u]) {
                if (l && !l(i[u].tag)) continue;
                return r ? n(i[u]) : i[u].obj;
            }
            return null;
        }, r.all = function(t, e, r) {
            var s = [], u = v(e), l = function(t) {
                var e, a;
                for (e = 0; e < o[t].length; e++) if (a = o[t][e], a && i[a]) {
                    if (u && !u(i[a].tag)) continue;
                    s.push(r ? n(i[a]) : i[a].obj);
                }
            };
            if (t in o) l(t); else if (a(t)) for (t in o) l(t);
            return s;
        }, r.rm = function(t, n, e) {
            var a, s;
            if (!o[t]) return !1;
            if (n) if (e) for (a = o[t].length - 1; a >= 0 && (s = o[t][a], !n(i[s].tag)); a--) ; else for (a = 0; a < o[t].length && (s = o[t][a], 
            !n(i[s].tag)); a++) ; else a = e ? o[t].length - 1 : 0;
            return a in o[t] ? r.clearById(o[t][a], a) : !1;
        }, r.clearById = function(t, n) {
            if (t in i) {
                var r, s = i[t].name;
                for (r = 0; a(n) && r < o[s].length; r++) t === o[s][r] && (n = r);
                return e(i[t].obj), i[t].sub && e(i[t].sub), delete i[t], o[s].splice(n, 1), !0;
            }
            return !1;
        }, r.objGetById = function(t) {
            var n, e;
            if (o.clusterer) for (e in o.clusterer) if ((n = i[o.clusterer[e]].obj.getById(t)) !== !1) return n;
            return !1;
        }, r.objClearById = function(t) {
            var n;
            if (o.clusterer) for (n in o.clusterer) if (i[o.clusterer[n]].obj.clearById(t)) return !0;
            return null;
        }, r.clear = function(t, n, e, i) {
            var a, s, u, l = v(i);
            if (t && t.length) t = h(t); else {
                t = [];
                for (a in o) t.push(a);
            }
            for (s = 0; s < t.length; s++) if (u = t[s], n) r.rm(u, l, !0); else if (e) r.rm(u, l, !1); else for (;r.rm(u, l, !1); ) ;
        }, r.objClear = function(n, e, a, r) {
            var s;
            if (o.clusterer && (t.inArray("marker", n) >= 0 || !n.length)) for (s in o.clusterer) i[o.clusterer[s]].obj.clear(e, a, r);
        };
    }
    function B(n, e, i) {
        function a(t) {
            var n = {};
            return n[t] = {}, n;
        }
        function r() {
            var t;
            for (t in i) if (i.hasOwnProperty(t) && !u.hasOwnProperty(t)) return t;
        }
        var s, u = {}, l = this, d = {
            latLng: {
                map: !1,
                marker: !1,
                infowindow: !1,
                circle: !1,
                overlay: !1,
                getlatlng: !1,
                getmaxzoom: !1,
                getelevation: !1,
                streetviewpanorama: !1,
                getaddress: !0
            },
            geoloc: {
                getgeoloc: !0
            }
        };
        o(i) && (i = a(i)), l.run = function() {
            for (var o, a; o = r(); ) {
                if (z(n[o])) return s = o, a = t.extend(!0, {}, A[o] || {}, i[o].options || {}), 
                void (o in d.latLng ? i[o].values ? L(i[o].values, n, n[o], {
                    td: i[o],
                    opts: a,
                    session: u
                }) : w(n, n[o], d.latLng[o], {
                    td: i[o],
                    opts: a,
                    session: u
                }) : o in d.geoloc ? b(n, n[o], {
                    td: i[o],
                    opts: a,
                    session: u
                }) : n[o].apply(n, [ {
                    td: i[o],
                    opts: a,
                    session: u
                } ]));
                u[o] = null;
            }
            e.apply(n, [ i, u ]);
        }, l.ack = function(t) {
            u[s] = t, l.run.apply(l, []);
        };
    }
    function j() {
        return V.ds || (V.ds = new q.DirectionsService()), V.ds;
    }
    function O() {
        return V.dms || (V.dms = new q.DistanceMatrixService()), V.dms;
    }
    function C() {
        return V.mzs || (V.mzs = new q.MaxZoomService()), V.mzs;
    }
    function E() {
        return V.es || (V.es = new q.ElevationService()), V.es;
    }
    function S(t) {
        function n() {
            var t = this;
            return t.onAdd = function() {}, t.onRemove = function() {}, t.draw = function() {}, 
            A.classes.OverlayView.apply(t, []);
        }
        n.prototype = A.classes.OverlayView.prototype;
        var e = new n();
        return e.setMap(t), e;
    }
    function T(n, o, i) {
        function a(t) {
            T[t] || (delete _[t].options.map, T[t] = new A.classes.Marker(_[t].options), l(n, {
                td: _[t]
            }, T[t], _[t].id));
        }
        function r() {
            return (y = U.getProjection()) ? (P = !0, j.push(q.event.addListener(o, "zoom_changed", f)), 
            j.push(q.event.addListener(o, "bounds_changed", f)), void h()) : void setTimeout(function() {
                r.apply(B, []);
            }, 25);
        }
        function u(t) {
            e(O[t]) ? (z(O[t].obj.setMap) && O[t].obj.setMap(null), z(O[t].obj.remove) && O[t].obj.remove(), 
            z(O[t].shadow.remove) && O[t].obj.remove(), z(O[t].shadow.setMap) && O[t].shadow.setMap(null), 
            delete O[t].obj, delete O[t].shadow) : T[t] && T[t].setMap(null), delete O[t];
        }
        function d() {
            var t, n, e, o, i, a, r, s, u = Math.cos, l = Math.sin, d = arguments;
            return d[0] instanceof q.LatLng ? (t = d[0].lat(), e = d[0].lng(), d[1] instanceof q.LatLng ? (n = d[1].lat(), 
            o = d[1].lng()) : (n = d[1], o = d[2])) : (t = d[0], e = d[1], d[2] instanceof q.LatLng ? (n = d[2].lat(), 
            o = d[2].lng()) : (n = d[2], o = d[3])), i = Math.PI * t / 180, a = Math.PI * e / 180, 
            r = Math.PI * n / 180, s = Math.PI * o / 180, 6371e3 * Math.acos(Math.min(u(i) * u(r) * u(a) * u(s) + u(i) * l(a) * u(r) * l(s) + l(i) * l(r), 1));
        }
        function c() {
            var t = d(o.getCenter(), o.getBounds().getNorthEast()), n = new q.Circle({
                center: o.getCenter(),
                radius: 1.25 * t
            });
            return n.getBounds();
        }
        function p() {
            var t, n = {};
            for (t in O) n[t] = !0;
            return n;
        }
        function f() {
            clearTimeout(m), m = setTimeout(h, 25);
        }
        function g(t) {
            var n = y.fromLatLngToDivPixel(t), e = y.fromDivPixelToLatLng(new q.Point(n.x + i.radius, n.y - i.radius)), o = y.fromDivPixelToLatLng(new q.Point(n.x - i.radius, n.y + i.radius));
            return new q.LatLngBounds(o, e);
        }
        function h() {
            if (!x && !I && P) {
                var n, e, a, r, s, l, d, f, h, v, m, y = !1, b = [], B = {}, j = o.getZoom(), C = "maxZoom" in i && j > i.maxZoom, E = p();
                for (M = !1, j > 3 && (s = c(), y = s.getSouthWest().lng() < s.getNorthEast().lng()), 
                n = 0; n < _.length; n++) !_[n] || y && !s.contains(_[n].options.position) || w && !w(D[n]) || b.push(n);
                for (;;) {
                    for (n = 0; B[n] && n < b.length; ) n++;
                    if (n === b.length) break;
                    if (r = [], k && !C) {
                        m = 10;
                        do for (f = r, r = [], m--, d = f.length ? s.getCenter() : _[b[n]].options.position, 
                        s = g(d), e = n; e < b.length; e++) B[e] || s.contains(_[b[e]].options.position) && r.push(e); while (f.length < r.length && r.length > 1 && m);
                    } else for (e = n; e < b.length; e++) if (!B[e]) {
                        r.push(e);
                        break;
                    }
                    for (l = {
                        indexes: [],
                        ref: []
                    }, h = v = 0, a = 0; a < r.length; a++) B[r[a]] = !0, l.indexes.push(b[r[a]]), l.ref.push(b[r[a]]), 
                    h += _[b[r[a]]].options.position.lat(), v += _[b[r[a]]].options.position.lng();
                    h /= r.length, v /= r.length, l.latLng = new q.LatLng(h, v), l.ref = l.ref.join("-"), 
                    l.ref in E ? delete E[l.ref] : (1 === r.length && (O[l.ref] = !0), L(l));
                }
                t.each(E, function(t) {
                    u(t);
                }), I = !1;
            }
        }
        var m, y, w, L, b, x = !1, M = !1, I = !1, P = !1, k = !0, B = this, j = [], O = {}, C = {}, E = {}, T = [], _ = [], D = [], U = S(o, i.radius);
        r(), B.getById = function(t) {
            return t in C ? (a(C[t]), T[C[t]]) : !1;
        }, B.rm = function(t) {
            var n = C[t];
            T[n] && T[n].setMap(null), delete T[n], T[n] = !1, delete _[n], _[n] = !1, delete D[n], 
            D[n] = !1, delete C[t], delete E[n], M = !0;
        }, B.clearById = function(t) {
            return t in C ? (B.rm(t), !0) : void 0;
        }, B.clear = function(t, n, e) {
            var o, i, a, r, s, u = [], l = v(e);
            for (t ? (o = _.length - 1, i = -1, a = -1) : (o = 0, i = _.length, a = 1), r = o; r !== i && (!_[r] || l && !l(_[r].tag) || (u.push(E[r]), 
            !n && !t)); r += a) ;
            for (s = 0; s < u.length; s++) B.rm(u[s]);
        }, B.add = function(t, n) {
            t.id = s(t.id), B.clearById(t.id), C[t.id] = T.length, E[T.length] = t.id, T.push(null), 
            _.push(t), D.push(n), M = !0;
        }, B.addMarker = function(t, e) {
            e = e || {}, e.id = s(e.id), B.clearById(e.id), e.options || (e.options = {}), e.options.position = t.getPosition(), 
            l(n, {
                td: e
            }, t, e.id), C[e.id] = T.length, E[T.length] = e.id, T.push(t), _.push(e), D.push(e.data || {}), 
            M = !0;
        }, B.td = function(t) {
            return _[t];
        }, B.value = function(t) {
            return D[t];
        }, B.marker = function(t) {
            return t in T ? (a(t), T[t]) : !1;
        }, B.markerIsSet = function(t) {
            return Boolean(T[t]);
        }, B.setMarker = function(t, n) {
            T[t] = n;
        }, B.store = function(t, n, e) {
            O[t.ref] = {
                obj: n,
                shadow: e
            };
        }, B.free = function() {
            var n;
            for (n = 0; n < j.length; n++) q.event.removeListener(j[n]);
            j = [], t.each(O, function(t) {
                u(t);
            }), O = {}, t.each(_, function(t) {
                _[t] = null;
            }), _ = [], t.each(T, function(t) {
                T[t] && (T[t].setMap(null), delete T[t]);
            }), T = [], t.each(D, function(t) {
                delete D[t];
            }), D = [], C = {}, E = {};
        }, B.filter = function(t) {
            w = t, h();
        }, B.enable = function(t) {
            k !== t && (k = t, h());
        }, B.display = function(t) {
            L = t;
        }, B.error = function(t) {
            b = t;
        }, B.beginUpdate = function() {
            x = !0;
        }, B.endUpdate = function() {
            x = !1, M && h();
        }, B.autofit = function(t) {
            var n;
            for (n = 0; n < _.length; n++) _[n] && t.extend(_[n].options.position);
        };
    }
    function _(t, n) {
        var e = this;
        e.id = function() {
            return t;
        }, e.filter = function(t) {
            n.filter(t);
        }, e.enable = function() {
            n.enable(!0);
        }, e.disable = function() {
            n.enable(!1);
        }, e.add = function(t, e, o) {
            o || n.beginUpdate(), n.addMarker(t, e), o || n.endUpdate();
        }, e.getById = function(t) {
            return n.getById(t);
        }, e.clearById = function(t, e) {
            var o;
            return e || n.beginUpdate(), o = n.clearById(t), e || n.endUpdate(), o;
        }, e.clear = function(t, e, o, i) {
            i || n.beginUpdate(), n.clear(t, e, o), i || n.endUpdate();
        };
    }
    function D(n, e, o, i) {
        var a = this, r = [];
        A.classes.OverlayView.call(a), a.setMap(n), a.onAdd = function() {
            var n = a.getPanes();
            e.pane in n && t(n[e.pane]).append(i), t.each("dblclick click mouseover mousemove mouseout mouseup mousedown".split(" "), function(n, e) {
                r.push(q.event.addDomListener(i[0], e, function(n) {
                    t.Event(n).stopPropagation(), q.event.trigger(a, e, [ n ]), a.draw();
                }));
            }), r.push(q.event.addDomListener(i[0], "contextmenu", function(n) {
                t.Event(n).stopPropagation(), q.event.trigger(a, "rightclick", [ n ]), a.draw();
            }));
        }, a.getPosition = function() {
            return o;
        }, a.setPosition = function(t) {
            o = t, a.draw();
        }, a.draw = function() {
            var t = a.getProjection().fromLatLngToDivPixel(o);
            i.css("left", t.x + e.offset.x + "px").css("top", t.y + e.offset.y + "px");
        }, a.onRemove = function() {
            var t;
            for (t = 0; t < r.length; t++) q.event.removeListener(r[t]);
            i.remove();
        }, a.hide = function() {
            i.hide();
        }, a.show = function() {
            i.show();
        }, a.toggle = function() {
            i && (i.is(":visible") ? a.show() : a.hide());
        }, a.toggleDOM = function() {
            a.setMap(a.getMap() ? null : n);
        }, a.getDOMElement = function() {
            return i[0];
        };
    }
    function U(i) {
        function r() {
            !b && (b = M.get()) && b.run();
        }
        function d() {
            b = null, M.ack(), r.call(x);
        }
        function c(t) {
            var n, e = t.td.callback;
            e && (n = Array.prototype.slice.call(arguments, 1), z(e) ? e.apply(i, n) : R(e) && z(e[1]) && e[1].apply(e[0], n));
        }
        function g(t, n, e) {
            e && l(i, t, n, e), c(t, n), b.ack(n);
        }
        function v(n, e) {
            e = e || {};
            var o = e.td && e.td.options ? e.td.options : 0;
            S ? o && (o.center && (o.center = m(o.center)), S.setOptions(o)) : (o = e.opts || t.extend(!0, {}, A.map, o || {}), 
            o.center = n || m(o.center), S = new A.classes.Map(i.get(0), o));
        }
        function w(e) {
            var o, a, r = new T(i, S, e), s = {}, u = {}, d = [], c = /^[0-9]+$/;
            for (a in e) c.test(a) ? (d.push(1 * a), u[a] = e[a], u[a].width = u[a].width || 0, 
            u[a].height = u[a].height || 0) : s[a] = e[a];
            return d.sort(function(t, n) {
                return t > n;
            }), o = s.calculator ? function(n) {
                var e = [];
                return t.each(n, function(t, n) {
                    e.push(r.value(n));
                }), s.calculator.apply(i, [ e ]);
            } : function(t) {
                return t.length;
            }, r.error(function() {
                f.apply(x, arguments);
            }), r.display(function(a) {
                var c, p, f, g, h, v, y = o(a.indexes);
                if (e.force || y > 1) for (c = 0; c < d.length; c++) d[c] <= y && (p = u[d[c]]);
                p ? (h = p.offset || [ -p.width / 2, -p.height / 2 ], f = t.extend({}, s), f.options = t.extend({
                    pane: "overlayLayer",
                    content: p.content ? p.content.replace("CLUSTER_COUNT", y) : "",
                    offset: {
                        x: ("x" in h ? h.x : h[0]) || 0,
                        y: ("y" in h ? h.y : h[1]) || 0
                    }
                }, s.options || {}), g = x.overlay({
                    td: f,
                    opts: f.options,
                    latLng: m(a)
                }, !0), f.options.pane = "floatShadow", f.options.content = t(document.createElement("div")).width(p.width + "px").height(p.height + "px").css({
                    cursor: "pointer"
                }), v = x.overlay({
                    td: f,
                    opts: f.options,
                    latLng: m(a)
                }, !0), s.data = {
                    latLng: m(a),
                    markers: []
                }, t.each(a.indexes, function(t, n) {
                    s.data.markers.push(r.value(n)), r.markerIsSet(n) && r.marker(n).setMap(null);
                }), l(i, {
                    td: s
                }, v, n, {
                    main: g,
                    shadow: v
                }), r.store(a, g, v)) : t.each(a.indexes, function(t, n) {
                    r.marker(n).setMap(S);
                });
            }), r;
        }
        function L(n, e, o) {
            var a = [], r = "values" in n.td;
            return r || (n.td.values = [ {
                options: n.opts
            } ]), n.td.values.length ? (v(), t.each(n.td.values, function(t, r) {
                var s, u, d, c, f = p(n, r);
                if (f.options[o]) if (f.options[o][0][0] && R(f.options[o][0][0])) for (u = 0; u < f.options[o].length; u++) for (d = 0; d < f.options[o][u].length; d++) f.options[o][u][d] = m(f.options[o][u][d]); else for (u = 0; u < f.options[o].length; u++) f.options[o][u] = m(f.options[o][u]);
                f.options.map = S, c = new q[e](f.options), a.push(c), s = I.add({
                    td: f
                }, e.toLowerCase(), c), l(i, {
                    td: f
                }, c, s);
            }), void g(n, r ? a : a[0])) : void g(n, !1);
        }
        var b, x = this, M = new P(), I = new k(), S = null;
        x._plan = function(t) {
            var n;
            for (n = 0; n < t.length; n++) M.add(new B(x, d, t[n]));
            r();
        }, x.map = function(t) {
            v(t.latLng, t), l(i, t, S), g(t, S);
        }, x.destroy = function(t) {
            I.clear(), i.empty(), S && (S = null), g(t, !0);
        }, x.overlay = function(n, e) {
            var o = [], a = "values" in n.td;
            return a || (n.td.values = [ {
                latLng: n.latLng,
                options: n.opts
            } ]), n.td.values.length ? (D.__initialised || (D.prototype = new A.classes.OverlayView(), 
            D.__initialised = !0), t.each(n.td.values, function(a, r) {
                var s, u, d = p(n, r), c = t(document.createElement("div")).css({
                    border: "none",
                    borderWidth: 0,
                    position: "absolute"
                });
                c.append(d.options.content), u = new D(S, d.options, m(d) || m(r), c), o.push(u), 
                c = null, e || (s = I.add(n, "overlay", u), l(i, {
                    td: d
                }, u, s));
            }), e ? o[0] : void g(n, a ? o : o[0])) : void g(n, !1);
        }, x.marker = function(n) {
            var e, o, a, r = "values" in n.td, u = !S;
            return r || (n.opts.position = n.latLng || m(n.opts.position), n.td.values = [ {
                options: n.opts
            } ]), n.td.values.length ? (u && v(), n.td.cluster && !S.getBounds() ? void q.event.addListenerOnce(S, "bounds_changed", function() {
                x.marker.apply(x, [ n ]);
            }) : void (n.td.cluster ? (n.td.cluster instanceof _ ? (o = n.td.cluster, a = I.getById(o.id(), !0)) : (a = w(n.td.cluster), 
            o = new _(s(n.td.id, !0), a), I.add(n, "clusterer", o, a)), a.beginUpdate(), t.each(n.td.values, function(t, e) {
                var o = p(n, e);
                o.options.position = m(o.options.position ? o.options.position : e), o.options.position && (o.options.map = S, 
                u && (S.setCenter(o.options.position), u = !1), a.add(o, e));
            }), a.endUpdate(), g(n, o)) : (e = [], t.each(n.td.values, function(t, o) {
                var a, r, s = p(n, o);
                s.options.position = m(s.options.position ? s.options.position : o), s.options.position && (s.options.map = S, 
                u && (S.setCenter(s.options.position), u = !1), r = new A.classes.Marker(s.options), 
                e.push(r), a = I.add({
                    td: s
                }, "marker", r), l(i, {
                    td: s
                }, r, a));
            }), g(n, r ? e : e[0])))) : void g(n, !1);
        }, x.getroute = function(t) {
            t.opts.origin = m(t.opts.origin, !0), t.opts.destination = m(t.opts.destination, !0), 
            j().route(t.opts, function(n, e) {
                c(t, e === q.DirectionsStatus.OK ? n : !1, e), b.ack();
            });
        }, x.getdistance = function(t) {
            var n;
            for (t.opts.origins = h(t.opts.origins), n = 0; n < t.opts.origins.length; n++) t.opts.origins[n] = m(t.opts.origins[n], !0);
            for (t.opts.destinations = h(t.opts.destinations), n = 0; n < t.opts.destinations.length; n++) t.opts.destinations[n] = m(t.opts.destinations[n], !0);
            O().getDistanceMatrix(t.opts, function(n, e) {
                c(t, e === q.DistanceMatrixStatus.OK ? n : !1, e), b.ack();
            });
        }, x.infowindow = function(e) {
            var o = [], r = "values" in e.td;
            r || (e.latLng && (e.opts.position = e.latLng), e.td.values = [ {
                options: e.opts
            } ]), t.each(e.td.values, function(t, s) {
                var u, d, c = p(e, s);
                c.options.position = m(c.options.position ? c.options.position : s.latLng), S || v(c.options.position), 
                d = new A.classes.InfoWindow(c.options), d && (a(c.open) || c.open) && (r ? d.open(S, c.anchor || n) : d.open(S, c.anchor || (e.latLng ? n : e.session.marker ? e.session.marker : n))), 
                o.push(d), u = I.add({
                    td: c
                }, "infowindow", d), l(i, {
                    td: c
                }, d, u);
            }), g(e, r ? o : o[0]);
        }, x.circle = function(n) {
            var e = [], o = "values" in n.td;
            return o || (n.opts.center = n.latLng || m(n.opts.center), n.td.values = [ {
                options: n.opts
            } ]), n.td.values.length ? (t.each(n.td.values, function(t, o) {
                var a, r, s = p(n, o);
                s.options.center = m(s.options.center ? s.options.center : o), S || v(s.options.center), 
                s.options.map = S, r = new A.classes.Circle(s.options), e.push(r), a = I.add({
                    td: s
                }, "circle", r), l(i, {
                    td: s
                }, r, a);
            }), void g(n, o ? e : e[0])) : void g(n, !1);
        }, x.getaddress = function(t) {
            c(t, t.results, t.status), b.ack();
        }, x.getlatlng = function(t) {
            c(t, t.results, t.status), b.ack();
        }, x.getmaxzoom = function(t) {
            C().getMaxZoomAtLatLng(t.latLng, function(n) {
                c(t, n.status === q.MaxZoomStatus.OK ? n.zoom : !1, status), b.ack();
            });
        }, x.getelevation = function(t) {
            var n, e = [], o = function(n, e) {
                c(t, e === q.ElevationStatus.OK ? n : !1, e), b.ack();
            };
            if (t.latLng) e.push(t.latLng); else for (e = h(t.td.locations || []), n = 0; n < e.length; n++) e[n] = m(e[n]);
            if (e.length) E().getElevationForLocations({
                locations: e
            }, o); else {
                if (t.td.path && t.td.path.length) for (n = 0; n < t.td.path.length; n++) e.push(m(t.td.path[n]));
                e.length ? E().getElevationAlongPath({
                    path: e,
                    samples: t.td.samples
                }, o) : b.ack();
            }
        }, x.defaults = function(n) {
            t.each(n.td, function(n, o) {
                A[n] = e(A[n]) ? t.extend({}, A[n], o) : o;
            }), b.ack(!0);
        }, x.rectangle = function(n) {
            var e = [], o = "values" in n.td;
            return o || (n.td.values = [ {
                options: n.opts
            } ]), n.td.values.length ? (t.each(n.td.values, function(t, o) {
                var a, r, s = p(n, o);
                s.options.bounds = y(s.options.bounds ? s.options.bounds : o), S || v(s.options.bounds.getCenter()), 
                s.options.map = S, r = new A.classes.Rectangle(s.options), e.push(r), a = I.add({
                    td: s
                }, "rectangle", r), l(i, {
                    td: s
                }, r, a);
            }), void g(n, o ? e : e[0])) : void g(n, !1);
        }, x.polyline = function(t) {
            L(t, "Polyline", "path");
        }, x.polygon = function(t) {
            L(t, "Polygon", "paths");
        }, x.trafficlayer = function(t) {
            v();
            var n = I.get("trafficlayer");
            n || (n = new A.classes.TrafficLayer(), n.setMap(S), I.add(t, "trafficlayer", n)), 
            g(t, n);
        }, x.bicyclinglayer = function(t) {
            v();
            var n = I.get("bicyclinglayer");
            n || (n = new A.classes.BicyclingLayer(), n.setMap(S), I.add(t, "bicyclinglayer", n)), 
            g(t, n);
        }, x.groundoverlay = function(t) {
            t.opts.bounds = y(t.opts.bounds), t.opts.bounds && v(t.opts.bounds.getCenter());
            var n, e = new A.classes.GroundOverlay(t.opts.url, t.opts.bounds, t.opts.opts);
            e.setMap(S), n = I.add(t, "groundoverlay", e), g(t, e, n);
        }, x.streetviewpanorama = function(n) {
            n.opts.opts || (n.opts.opts = {}), n.latLng ? n.opts.opts.position = n.latLng : n.opts.opts.position && (n.opts.opts.position = m(n.opts.opts.position)), 
            n.td.divId ? n.opts.container = document.getElementById(n.td.divId) : n.opts.container && (n.opts.container = t(n.opts.container).get(0));
            var e, o = new A.classes.StreetViewPanorama(n.opts.container, n.opts.opts);
            o && S.setStreetView(o), e = I.add(n, "streetviewpanorama", o), g(n, o, e);
        }, x.kmllayer = function(n) {
            var e = [], o = "values" in n.td;
            return o || (n.td.values = [ {
                options: n.opts
            } ]), n.td.values.length ? (t.each(n.td.values, function(t, o) {
                var a, r, s, d = p(n, o);
                S || v(), s = d.options, d.options.opts && (s = d.options.opts, d.options.url && (s.url = d.options.url)), 
                s.map = S, r = u("3.10") ? new A.classes.KmlLayer(s) : new A.classes.KmlLayer(s.url, s), 
                e.push(r), a = I.add({
                    td: d
                }, "kmllayer", r), l(i, {
                    td: d
                }, r, a);
            }), void g(n, o ? e : e[0])) : void g(n, !1);
        }, x.panel = function(n) {
            v();
            var e, o, r = 0, s = 0, u = t(document.createElement("div"));
            u.css({
                position: "absolute",
                zIndex: 1e3,
                visibility: "hidden"
            }), n.opts.content && (o = t(n.opts.content), u.append(o), i.first().prepend(u), 
            a(n.opts.left) ? a(n.opts.right) ? n.opts.center && (r = (i.width() - o.width()) / 2) : r = i.width() - o.width() - n.opts.right : r = n.opts.left, 
            a(n.opts.top) ? a(n.opts.bottom) ? n.opts.middle && (s = (i.height() - o.height()) / 2) : s = i.height() - o.height() - n.opts.bottom : s = n.opts.top, 
            u.css({
                top: s,
                left: r,
                visibility: "visible"
            })), e = I.add(n, "panel", u), g(n, u, e), u = null;
        }, x.directionsrenderer = function(n) {
            n.opts.map = S;
            var e, o = new q.DirectionsRenderer(n.opts);
            n.td.divId ? o.setPanel(document.getElementById(n.td.divId)) : n.td.container && o.setPanel(t(n.td.container).get(0)), 
            e = I.add(n, "directionsrenderer", o), g(n, o, e);
        }, x.getgeoloc = function(t) {
            g(t, t.latLng);
        }, x.styledmaptype = function(t) {
            v();
            var n = new A.classes.StyledMapType(t.td.styles, t.opts);
            S.mapTypes.set(t.td.id, n), g(t, n);
        }, x.imagemaptype = function(t) {
            v();
            var n = new A.classes.ImageMapType(t.opts);
            S.mapTypes.set(t.td.id, n), g(t, n);
        }, x.autofit = function(n) {
            var e = new q.LatLngBounds();
            t.each(I.all(), function(t, n) {
                n.getPosition ? e.extend(n.getPosition()) : n.getBounds ? (e.extend(n.getBounds().getNorthEast()), 
                e.extend(n.getBounds().getSouthWest())) : n.getPaths ? n.getPaths().forEach(function(t) {
                    t.forEach(function(t) {
                        e.extend(t);
                    });
                }) : n.getPath ? n.getPath().forEach(function(t) {
                    e.extend(t);
                }) : n.getCenter ? e.extend(n.getCenter()) : "function" == typeof _ && n instanceof _ && (n = I.getById(n.id(), !0), 
                n && n.autofit(e));
            }), e.isEmpty() || S.getBounds() && S.getBounds().equals(e) || ("maxZoom" in n.td && q.event.addListenerOnce(S, "bounds_changed", function() {
                this.getZoom() > n.td.maxZoom && this.setZoom(n.td.maxZoom);
            }), S.fitBounds(e)), g(n, !0);
        }, x.clear = function(n) {
            if (o(n.td)) {
                if (I.clearById(n.td) || I.objClearById(n.td)) return void g(n, !0);
                n.td = {
                    name: n.td
                };
            }
            n.td.id ? t.each(h(n.td.id), function(t, n) {
                I.clearById(n) || I.objClearById(n);
            }) : (I.clear(h(n.td.name), n.td.last, n.td.first, n.td.tag), I.objClear(h(n.td.name), n.td.last, n.td.first, n.td.tag)), 
            g(n, !0);
        }, x.get = function(e, i, a) {
            var r, s, u = i ? e : e.td;
            return i || (a = u.full), o(u) ? (s = I.getById(u, !1, a) || I.objGetById(u), s === !1 && (r = u, 
            u = {})) : r = u.name, "map" === r && (s = S), s || (s = [], u.id ? (t.each(h(u.id), function(t, n) {
                s.push(I.getById(n, !1, a) || I.objGetById(n));
            }), R(u.id) || (s = s[0])) : (t.each(r ? h(r) : [ n ], function(n, e) {
                var o;
                u.first ? (o = I.get(e, !1, u.tag, a), o && s.push(o)) : u.all ? t.each(I.all(e, u.tag, a), function(t, n) {
                    s.push(n);
                }) : (o = I.get(e, !0, u.tag, a), o && s.push(o));
            }), u.all || R(r) || (s = s[0]))), s = R(s) || !u.all ? s : [ s ], i ? s : void g(e, s);
        }, x.exec = function(n) {
            t.each(h(n.td.func), function(e, o) {
                t.each(x.get(n.td, !0, n.td.hasOwnProperty("full") ? n.td.full : !0), function(t, n) {
                    o.call(i, n);
                });
            }), g(n, !0);
        }, x.trigger = function(n) {
            if (o(n.td)) q.event.trigger(S, n.td); else {
                var e = [ S, n.td.eventName ];
                n.td.var_args && t.each(n.td.var_args, function(t, n) {
                    e.push(n);
                }), q.event.trigger.apply(q.event, e);
            }
            c(n), b.ack();
        };
    }
    var A, q, Z = 0, z = t.isFunction, R = t.isArray, V = {}, G = new I();
    t.fn.gmap3 = function() {
        var n, e = [], o = !0, i = [];
        for (r(), n = 0; n < arguments.length; n++) arguments[n] && e.push(arguments[n]);
        return e.length || e.push("map"), t.each(this, function() {
            var n = t(this), a = n.data("gmap3");
            o = !1, a || (a = new U(n), n.data("gmap3", a)), 1 !== e.length || "get" !== e[0] && !x(e[0]) ? a._plan(e) : i.push("get" === e[0] ? a.get("map", !0) : a.get(e[0].get, !0, e[0].get.full));
        }), i.length ? 1 === i.length ? i[0] : i : this;
    };
}(jQuery);

(function(window) {
    "use strict";
    function classReg(className) {
        return new RegExp("(^|\\s+)" + className + "(\\s+|$)");
    }
    var hasClass, addClass, removeClass;
    if ("classList" in document.documentElement) {
        hasClass = function(elem, c) {
            return elem.classList.contains(c);
        };
        addClass = function(elem, c) {
            elem.classList.add(c);
        };
        removeClass = function(elem, c) {
            elem.classList.remove(c);
        };
    } else {
        hasClass = function(elem, c) {
            return classReg(c).test(elem.className);
        };
        addClass = function(elem, c) {
            if (!hasClass(elem, c)) {
                elem.className = elem.className + " " + c;
            }
        };
        removeClass = function(elem, c) {
            elem.className = elem.className.replace(classReg(c), " ");
        };
    }
    function toggleClass(elem, c) {
        var fn = hasClass(elem, c) ? removeClass : addClass;
        fn(elem, c);
    }
    window.classie = {
        hasClass: hasClass,
        addClass: addClass,
        removeClass: removeClass,
        toggleClass: toggleClass,
        has: hasClass,
        add: addClass,
        remove: removeClass,
        toggle: toggleClass
    };
})(window);

(function($) {
    if (typeof $.fn.each2 == "undefined") {
        $.extend($.fn, {
            each2: function(c) {
                var j = $([ 0 ]), i = -1, l = this.length;
                while (++i < l && (j.context = j[0] = this[i]) && c.call(j[0], i, j) !== false) ;
                return this;
            }
        });
    }
})(jQuery);

(function($, undefined) {
    "use strict";
    if (window.Select2 !== undefined) {
        return;
    }
    var KEY, AbstractSelect2, SingleSelect2, MultiSelect2, nextUid, sizer, lastMousePosition = {
        x: 0,
        y: 0
    }, $document, scrollBarDimensions, KEY = {
        TAB: 9,
        ENTER: 13,
        ESC: 27,
        SPACE: 32,
        LEFT: 37,
        UP: 38,
        RIGHT: 39,
        DOWN: 40,
        SHIFT: 16,
        CTRL: 17,
        ALT: 18,
        PAGE_UP: 33,
        PAGE_DOWN: 34,
        HOME: 36,
        END: 35,
        BACKSPACE: 8,
        DELETE: 46,
        isArrow: function(k) {
            k = k.which ? k.which : k;
            switch (k) {
              case KEY.LEFT:
              case KEY.RIGHT:
              case KEY.UP:
              case KEY.DOWN:
                return true;
            }
            return false;
        },
        isControl: function(e) {
            var k = e.which;
            switch (k) {
              case KEY.SHIFT:
              case KEY.CTRL:
              case KEY.ALT:
                return true;
            }
            if (e.metaKey) return true;
            return false;
        },
        isFunctionKey: function(k) {
            k = k.which ? k.which : k;
            return k >= 112 && k <= 123;
        }
    }, MEASURE_SCROLLBAR_TEMPLATE = "<div class='select2-measure-scrollbar'></div>", DIACRITICS = {
        "Ⓐ": "A",
        "Ａ": "A",
        "À": "A",
        "Á": "A",
        "Â": "A",
        "Ầ": "A",
        "Ấ": "A",
        "Ẫ": "A",
        "Ẩ": "A",
        "Ã": "A",
        "Ā": "A",
        "Ă": "A",
        "Ằ": "A",
        "Ắ": "A",
        "Ẵ": "A",
        "Ẳ": "A",
        "Ȧ": "A",
        "Ǡ": "A",
        "Ä": "A",
        "Ǟ": "A",
        "Ả": "A",
        "Å": "A",
        "Ǻ": "A",
        "Ǎ": "A",
        "Ȁ": "A",
        "Ȃ": "A",
        "Ạ": "A",
        "Ậ": "A",
        "Ặ": "A",
        "Ḁ": "A",
        "Ą": "A",
        "Ⱥ": "A",
        "Ɐ": "A",
        "Ꜳ": "AA",
        "Æ": "AE",
        "Ǽ": "AE",
        "Ǣ": "AE",
        "Ꜵ": "AO",
        "Ꜷ": "AU",
        "Ꜹ": "AV",
        "Ꜻ": "AV",
        "Ꜽ": "AY",
        "Ⓑ": "B",
        "Ｂ": "B",
        "Ḃ": "B",
        "Ḅ": "B",
        "Ḇ": "B",
        "Ƀ": "B",
        "Ƃ": "B",
        "Ɓ": "B",
        "Ⓒ": "C",
        "Ｃ": "C",
        "Ć": "C",
        "Ĉ": "C",
        "Ċ": "C",
        "Č": "C",
        "Ç": "C",
        "Ḉ": "C",
        "Ƈ": "C",
        "Ȼ": "C",
        "Ꜿ": "C",
        "Ⓓ": "D",
        "Ｄ": "D",
        "Ḋ": "D",
        "Ď": "D",
        "Ḍ": "D",
        "Ḑ": "D",
        "Ḓ": "D",
        "Ḏ": "D",
        "Đ": "D",
        "Ƌ": "D",
        "Ɗ": "D",
        "Ɖ": "D",
        "Ꝺ": "D",
        "Ǳ": "DZ",
        "Ǆ": "DZ",
        "ǲ": "Dz",
        "ǅ": "Dz",
        "Ⓔ": "E",
        "Ｅ": "E",
        "È": "E",
        "É": "E",
        "Ê": "E",
        "Ề": "E",
        "Ế": "E",
        "Ễ": "E",
        "Ể": "E",
        "Ẽ": "E",
        "Ē": "E",
        "Ḕ": "E",
        "Ḗ": "E",
        "Ĕ": "E",
        "Ė": "E",
        "Ë": "E",
        "Ẻ": "E",
        "Ě": "E",
        "Ȅ": "E",
        "Ȇ": "E",
        "Ẹ": "E",
        "Ệ": "E",
        "Ȩ": "E",
        "Ḝ": "E",
        "Ę": "E",
        "Ḙ": "E",
        "Ḛ": "E",
        "Ɛ": "E",
        "Ǝ": "E",
        "Ⓕ": "F",
        "Ｆ": "F",
        "Ḟ": "F",
        "Ƒ": "F",
        "Ꝼ": "F",
        "Ⓖ": "G",
        "Ｇ": "G",
        "Ǵ": "G",
        "Ĝ": "G",
        "Ḡ": "G",
        "Ğ": "G",
        "Ġ": "G",
        "Ǧ": "G",
        "Ģ": "G",
        "Ǥ": "G",
        "Ɠ": "G",
        "Ꞡ": "G",
        "Ᵹ": "G",
        "Ꝿ": "G",
        "Ⓗ": "H",
        "Ｈ": "H",
        "Ĥ": "H",
        "Ḣ": "H",
        "Ḧ": "H",
        "Ȟ": "H",
        "Ḥ": "H",
        "Ḩ": "H",
        "Ḫ": "H",
        "Ħ": "H",
        "Ⱨ": "H",
        "Ⱶ": "H",
        "Ɥ": "H",
        "Ⓘ": "I",
        "Ｉ": "I",
        "Ì": "I",
        "Í": "I",
        "Î": "I",
        "Ĩ": "I",
        "Ī": "I",
        "Ĭ": "I",
        "İ": "I",
        "Ï": "I",
        "Ḯ": "I",
        "Ỉ": "I",
        "Ǐ": "I",
        "Ȉ": "I",
        "Ȋ": "I",
        "Ị": "I",
        "Į": "I",
        "Ḭ": "I",
        "Ɨ": "I",
        "Ⓙ": "J",
        "Ｊ": "J",
        "Ĵ": "J",
        "Ɉ": "J",
        "Ⓚ": "K",
        "Ｋ": "K",
        "Ḱ": "K",
        "Ǩ": "K",
        "Ḳ": "K",
        "Ķ": "K",
        "Ḵ": "K",
        "Ƙ": "K",
        "Ⱪ": "K",
        "Ꝁ": "K",
        "Ꝃ": "K",
        "Ꝅ": "K",
        "Ꞣ": "K",
        "Ⓛ": "L",
        "Ｌ": "L",
        "Ŀ": "L",
        "Ĺ": "L",
        "Ľ": "L",
        "Ḷ": "L",
        "Ḹ": "L",
        "Ļ": "L",
        "Ḽ": "L",
        "Ḻ": "L",
        "Ł": "L",
        "Ƚ": "L",
        "Ɫ": "L",
        "Ⱡ": "L",
        "Ꝉ": "L",
        "Ꝇ": "L",
        "Ꞁ": "L",
        "Ǉ": "LJ",
        "ǈ": "Lj",
        "Ⓜ": "M",
        "Ｍ": "M",
        "Ḿ": "M",
        "Ṁ": "M",
        "Ṃ": "M",
        "Ɱ": "M",
        "Ɯ": "M",
        "Ⓝ": "N",
        "Ｎ": "N",
        "Ǹ": "N",
        "Ń": "N",
        "Ñ": "N",
        "Ṅ": "N",
        "Ň": "N",
        "Ṇ": "N",
        "Ņ": "N",
        "Ṋ": "N",
        "Ṉ": "N",
        "Ƞ": "N",
        "Ɲ": "N",
        "Ꞑ": "N",
        "Ꞥ": "N",
        "Ǌ": "NJ",
        "ǋ": "Nj",
        "Ⓞ": "O",
        "Ｏ": "O",
        "Ò": "O",
        "Ó": "O",
        "Ô": "O",
        "Ồ": "O",
        "Ố": "O",
        "Ỗ": "O",
        "Ổ": "O",
        "Õ": "O",
        "Ṍ": "O",
        "Ȭ": "O",
        "Ṏ": "O",
        "Ō": "O",
        "Ṑ": "O",
        "Ṓ": "O",
        "Ŏ": "O",
        "Ȯ": "O",
        "Ȱ": "O",
        "Ö": "O",
        "Ȫ": "O",
        "Ỏ": "O",
        "Ő": "O",
        "Ǒ": "O",
        "Ȍ": "O",
        "Ȏ": "O",
        "Ơ": "O",
        "Ờ": "O",
        "Ớ": "O",
        "Ỡ": "O",
        "Ở": "O",
        "Ợ": "O",
        "Ọ": "O",
        "Ộ": "O",
        "Ǫ": "O",
        "Ǭ": "O",
        "Ø": "O",
        "Ǿ": "O",
        "Ɔ": "O",
        "Ɵ": "O",
        "Ꝋ": "O",
        "Ꝍ": "O",
        "Ƣ": "OI",
        "Ꝏ": "OO",
        "Ȣ": "OU",
        "Ⓟ": "P",
        "Ｐ": "P",
        "Ṕ": "P",
        "Ṗ": "P",
        "Ƥ": "P",
        "Ᵽ": "P",
        "Ꝑ": "P",
        "Ꝓ": "P",
        "Ꝕ": "P",
        "Ⓠ": "Q",
        "Ｑ": "Q",
        "Ꝗ": "Q",
        "Ꝙ": "Q",
        "Ɋ": "Q",
        "Ⓡ": "R",
        "Ｒ": "R",
        "Ŕ": "R",
        "Ṙ": "R",
        "Ř": "R",
        "Ȑ": "R",
        "Ȓ": "R",
        "Ṛ": "R",
        "Ṝ": "R",
        "Ŗ": "R",
        "Ṟ": "R",
        "Ɍ": "R",
        "Ɽ": "R",
        "Ꝛ": "R",
        "Ꞧ": "R",
        "Ꞃ": "R",
        "Ⓢ": "S",
        "Ｓ": "S",
        "ẞ": "S",
        "Ś": "S",
        "Ṥ": "S",
        "Ŝ": "S",
        "Ṡ": "S",
        "Š": "S",
        "Ṧ": "S",
        "Ṣ": "S",
        "Ṩ": "S",
        "Ș": "S",
        "Ş": "S",
        "Ȿ": "S",
        "Ꞩ": "S",
        "Ꞅ": "S",
        "Ⓣ": "T",
        "Ｔ": "T",
        "Ṫ": "T",
        "Ť": "T",
        "Ṭ": "T",
        "Ț": "T",
        "Ţ": "T",
        "Ṱ": "T",
        "Ṯ": "T",
        "Ŧ": "T",
        "Ƭ": "T",
        "Ʈ": "T",
        "Ⱦ": "T",
        "Ꞇ": "T",
        "Ꜩ": "TZ",
        "Ⓤ": "U",
        "Ｕ": "U",
        "Ù": "U",
        "Ú": "U",
        "Û": "U",
        "Ũ": "U",
        "Ṹ": "U",
        "Ū": "U",
        "Ṻ": "U",
        "Ŭ": "U",
        "Ü": "U",
        "Ǜ": "U",
        "Ǘ": "U",
        "Ǖ": "U",
        "Ǚ": "U",
        "Ủ": "U",
        "Ů": "U",
        "Ű": "U",
        "Ǔ": "U",
        "Ȕ": "U",
        "Ȗ": "U",
        "Ư": "U",
        "Ừ": "U",
        "Ứ": "U",
        "Ữ": "U",
        "Ử": "U",
        "Ự": "U",
        "Ụ": "U",
        "Ṳ": "U",
        "Ų": "U",
        "Ṷ": "U",
        "Ṵ": "U",
        "Ʉ": "U",
        "Ⓥ": "V",
        "Ｖ": "V",
        "Ṽ": "V",
        "Ṿ": "V",
        "Ʋ": "V",
        "Ꝟ": "V",
        "Ʌ": "V",
        "Ꝡ": "VY",
        "Ⓦ": "W",
        "Ｗ": "W",
        "Ẁ": "W",
        "Ẃ": "W",
        "Ŵ": "W",
        "Ẇ": "W",
        "Ẅ": "W",
        "Ẉ": "W",
        "Ⱳ": "W",
        "Ⓧ": "X",
        "Ｘ": "X",
        "Ẋ": "X",
        "Ẍ": "X",
        "Ⓨ": "Y",
        "Ｙ": "Y",
        "Ỳ": "Y",
        "Ý": "Y",
        "Ŷ": "Y",
        "Ỹ": "Y",
        "Ȳ": "Y",
        "Ẏ": "Y",
        "Ÿ": "Y",
        "Ỷ": "Y",
        "Ỵ": "Y",
        "Ƴ": "Y",
        "Ɏ": "Y",
        "Ỿ": "Y",
        "Ⓩ": "Z",
        "Ｚ": "Z",
        "Ź": "Z",
        "Ẑ": "Z",
        "Ż": "Z",
        "Ž": "Z",
        "Ẓ": "Z",
        "Ẕ": "Z",
        "Ƶ": "Z",
        "Ȥ": "Z",
        "Ɀ": "Z",
        "Ⱬ": "Z",
        "Ꝣ": "Z",
        "ⓐ": "a",
        "ａ": "a",
        "ẚ": "a",
        "à": "a",
        "á": "a",
        "â": "a",
        "ầ": "a",
        "ấ": "a",
        "ẫ": "a",
        "ẩ": "a",
        "ã": "a",
        "ā": "a",
        "ă": "a",
        "ằ": "a",
        "ắ": "a",
        "ẵ": "a",
        "ẳ": "a",
        "ȧ": "a",
        "ǡ": "a",
        "ä": "a",
        "ǟ": "a",
        "ả": "a",
        "å": "a",
        "ǻ": "a",
        "ǎ": "a",
        "ȁ": "a",
        "ȃ": "a",
        "ạ": "a",
        "ậ": "a",
        "ặ": "a",
        "ḁ": "a",
        "ą": "a",
        "ⱥ": "a",
        "ɐ": "a",
        "ꜳ": "aa",
        "æ": "ae",
        "ǽ": "ae",
        "ǣ": "ae",
        "ꜵ": "ao",
        "ꜷ": "au",
        "ꜹ": "av",
        "ꜻ": "av",
        "ꜽ": "ay",
        "ⓑ": "b",
        "ｂ": "b",
        "ḃ": "b",
        "ḅ": "b",
        "ḇ": "b",
        "ƀ": "b",
        "ƃ": "b",
        "ɓ": "b",
        "ⓒ": "c",
        "ｃ": "c",
        "ć": "c",
        "ĉ": "c",
        "ċ": "c",
        "č": "c",
        "ç": "c",
        "ḉ": "c",
        "ƈ": "c",
        "ȼ": "c",
        "ꜿ": "c",
        "ↄ": "c",
        "ⓓ": "d",
        "ｄ": "d",
        "ḋ": "d",
        "ď": "d",
        "ḍ": "d",
        "ḑ": "d",
        "ḓ": "d",
        "ḏ": "d",
        "đ": "d",
        "ƌ": "d",
        "ɖ": "d",
        "ɗ": "d",
        "ꝺ": "d",
        "ǳ": "dz",
        "ǆ": "dz",
        "ⓔ": "e",
        "ｅ": "e",
        "è": "e",
        "é": "e",
        "ê": "e",
        "ề": "e",
        "ế": "e",
        "ễ": "e",
        "ể": "e",
        "ẽ": "e",
        "ē": "e",
        "ḕ": "e",
        "ḗ": "e",
        "ĕ": "e",
        "ė": "e",
        "ë": "e",
        "ẻ": "e",
        "ě": "e",
        "ȅ": "e",
        "ȇ": "e",
        "ẹ": "e",
        "ệ": "e",
        "ȩ": "e",
        "ḝ": "e",
        "ę": "e",
        "ḙ": "e",
        "ḛ": "e",
        "ɇ": "e",
        "ɛ": "e",
        "ǝ": "e",
        "ⓕ": "f",
        "ｆ": "f",
        "ḟ": "f",
        "ƒ": "f",
        "ꝼ": "f",
        "ⓖ": "g",
        "ｇ": "g",
        "ǵ": "g",
        "ĝ": "g",
        "ḡ": "g",
        "ğ": "g",
        "ġ": "g",
        "ǧ": "g",
        "ģ": "g",
        "ǥ": "g",
        "ɠ": "g",
        "ꞡ": "g",
        "ᵹ": "g",
        "ꝿ": "g",
        "ⓗ": "h",
        "ｈ": "h",
        "ĥ": "h",
        "ḣ": "h",
        "ḧ": "h",
        "ȟ": "h",
        "ḥ": "h",
        "ḩ": "h",
        "ḫ": "h",
        "ẖ": "h",
        "ħ": "h",
        "ⱨ": "h",
        "ⱶ": "h",
        "ɥ": "h",
        "ƕ": "hv",
        "ⓘ": "i",
        "ｉ": "i",
        "ì": "i",
        "í": "i",
        "î": "i",
        "ĩ": "i",
        "ī": "i",
        "ĭ": "i",
        "ï": "i",
        "ḯ": "i",
        "ỉ": "i",
        "ǐ": "i",
        "ȉ": "i",
        "ȋ": "i",
        "ị": "i",
        "į": "i",
        "ḭ": "i",
        "ɨ": "i",
        "ı": "i",
        "ⓙ": "j",
        "ｊ": "j",
        "ĵ": "j",
        "ǰ": "j",
        "ɉ": "j",
        "ⓚ": "k",
        "ｋ": "k",
        "ḱ": "k",
        "ǩ": "k",
        "ḳ": "k",
        "ķ": "k",
        "ḵ": "k",
        "ƙ": "k",
        "ⱪ": "k",
        "ꝁ": "k",
        "ꝃ": "k",
        "ꝅ": "k",
        "ꞣ": "k",
        "ⓛ": "l",
        "ｌ": "l",
        "ŀ": "l",
        "ĺ": "l",
        "ľ": "l",
        "ḷ": "l",
        "ḹ": "l",
        "ļ": "l",
        "ḽ": "l",
        "ḻ": "l",
        "ſ": "l",
        "ł": "l",
        "ƚ": "l",
        "ɫ": "l",
        "ⱡ": "l",
        "ꝉ": "l",
        "ꞁ": "l",
        "ꝇ": "l",
        "ǉ": "lj",
        "ⓜ": "m",
        "ｍ": "m",
        "ḿ": "m",
        "ṁ": "m",
        "ṃ": "m",
        "ɱ": "m",
        "ɯ": "m",
        "ⓝ": "n",
        "ｎ": "n",
        "ǹ": "n",
        "ń": "n",
        "ñ": "n",
        "ṅ": "n",
        "ň": "n",
        "ṇ": "n",
        "ņ": "n",
        "ṋ": "n",
        "ṉ": "n",
        "ƞ": "n",
        "ɲ": "n",
        "ŉ": "n",
        "ꞑ": "n",
        "ꞥ": "n",
        "ǌ": "nj",
        "ⓞ": "o",
        "ｏ": "o",
        "ò": "o",
        "ó": "o",
        "ô": "o",
        "ồ": "o",
        "ố": "o",
        "ỗ": "o",
        "ổ": "o",
        "õ": "o",
        "ṍ": "o",
        "ȭ": "o",
        "ṏ": "o",
        "ō": "o",
        "ṑ": "o",
        "ṓ": "o",
        "ŏ": "o",
        "ȯ": "o",
        "ȱ": "o",
        "ö": "o",
        "ȫ": "o",
        "ỏ": "o",
        "ő": "o",
        "ǒ": "o",
        "ȍ": "o",
        "ȏ": "o",
        "ơ": "o",
        "ờ": "o",
        "ớ": "o",
        "ỡ": "o",
        "ở": "o",
        "ợ": "o",
        "ọ": "o",
        "ộ": "o",
        "ǫ": "o",
        "ǭ": "o",
        "ø": "o",
        "ǿ": "o",
        "ɔ": "o",
        "ꝋ": "o",
        "ꝍ": "o",
        "ɵ": "o",
        "ƣ": "oi",
        "ȣ": "ou",
        "ꝏ": "oo",
        "ⓟ": "p",
        "ｐ": "p",
        "ṕ": "p",
        "ṗ": "p",
        "ƥ": "p",
        "ᵽ": "p",
        "ꝑ": "p",
        "ꝓ": "p",
        "ꝕ": "p",
        "ⓠ": "q",
        "ｑ": "q",
        "ɋ": "q",
        "ꝗ": "q",
        "ꝙ": "q",
        "ⓡ": "r",
        "ｒ": "r",
        "ŕ": "r",
        "ṙ": "r",
        "ř": "r",
        "ȑ": "r",
        "ȓ": "r",
        "ṛ": "r",
        "ṝ": "r",
        "ŗ": "r",
        "ṟ": "r",
        "ɍ": "r",
        "ɽ": "r",
        "ꝛ": "r",
        "ꞧ": "r",
        "ꞃ": "r",
        "ⓢ": "s",
        "ｓ": "s",
        "ß": "s",
        "ś": "s",
        "ṥ": "s",
        "ŝ": "s",
        "ṡ": "s",
        "š": "s",
        "ṧ": "s",
        "ṣ": "s",
        "ṩ": "s",
        "ș": "s",
        "ş": "s",
        "ȿ": "s",
        "ꞩ": "s",
        "ꞅ": "s",
        "ẛ": "s",
        "ⓣ": "t",
        "ｔ": "t",
        "ṫ": "t",
        "ẗ": "t",
        "ť": "t",
        "ṭ": "t",
        "ț": "t",
        "ţ": "t",
        "ṱ": "t",
        "ṯ": "t",
        "ŧ": "t",
        "ƭ": "t",
        "ʈ": "t",
        "ⱦ": "t",
        "ꞇ": "t",
        "ꜩ": "tz",
        "ⓤ": "u",
        "ｕ": "u",
        "ù": "u",
        "ú": "u",
        "û": "u",
        "ũ": "u",
        "ṹ": "u",
        "ū": "u",
        "ṻ": "u",
        "ŭ": "u",
        "ü": "u",
        "ǜ": "u",
        "ǘ": "u",
        "ǖ": "u",
        "ǚ": "u",
        "ủ": "u",
        "ů": "u",
        "ű": "u",
        "ǔ": "u",
        "ȕ": "u",
        "ȗ": "u",
        "ư": "u",
        "ừ": "u",
        "ứ": "u",
        "ữ": "u",
        "ử": "u",
        "ự": "u",
        "ụ": "u",
        "ṳ": "u",
        "ų": "u",
        "ṷ": "u",
        "ṵ": "u",
        "ʉ": "u",
        "ⓥ": "v",
        "ｖ": "v",
        "ṽ": "v",
        "ṿ": "v",
        "ʋ": "v",
        "ꝟ": "v",
        "ʌ": "v",
        "ꝡ": "vy",
        "ⓦ": "w",
        "ｗ": "w",
        "ẁ": "w",
        "ẃ": "w",
        "ŵ": "w",
        "ẇ": "w",
        "ẅ": "w",
        "ẘ": "w",
        "ẉ": "w",
        "ⱳ": "w",
        "ⓧ": "x",
        "ｘ": "x",
        "ẋ": "x",
        "ẍ": "x",
        "ⓨ": "y",
        "ｙ": "y",
        "ỳ": "y",
        "ý": "y",
        "ŷ": "y",
        "ỹ": "y",
        "ȳ": "y",
        "ẏ": "y",
        "ÿ": "y",
        "ỷ": "y",
        "ẙ": "y",
        "ỵ": "y",
        "ƴ": "y",
        "ɏ": "y",
        "ỿ": "y",
        "ⓩ": "z",
        "ｚ": "z",
        "ź": "z",
        "ẑ": "z",
        "ż": "z",
        "ž": "z",
        "ẓ": "z",
        "ẕ": "z",
        "ƶ": "z",
        "ȥ": "z",
        "ɀ": "z",
        "ⱬ": "z",
        "ꝣ": "z",
        "Ά": "Α",
        "Έ": "Ε",
        "Ή": "Η",
        "Ί": "Ι",
        "Ϊ": "Ι",
        "Ό": "Ο",
        "Ύ": "Υ",
        "Ϋ": "Υ",
        "Ώ": "Ω",
        "ά": "α",
        "έ": "ε",
        "ή": "η",
        "ί": "ι",
        "ϊ": "ι",
        "ΐ": "ι",
        "ό": "ο",
        "ύ": "υ",
        "ϋ": "υ",
        "ΰ": "υ",
        "ω": "ω",
        "ς": "σ"
    };
    $document = $(document);
    nextUid = function() {
        var counter = 1;
        return function() {
            return counter++;
        };
    }();
    function reinsertElement(element) {
        var placeholder = $(document.createTextNode(""));
        element.before(placeholder);
        placeholder.before(element);
        placeholder.remove();
    }
    function stripDiacritics(str) {
        function match(a) {
            return DIACRITICS[a] || a;
        }
        return str.replace(/[^\u0000-\u007E]/g, match);
    }
    function indexOf(value, array) {
        var i = 0, l = array.length;
        for (;i < l; i = i + 1) {
            if (equal(value, array[i])) return i;
        }
        return -1;
    }
    function measureScrollbar() {
        var $template = $(MEASURE_SCROLLBAR_TEMPLATE);
        $template.appendTo("body");
        var dim = {
            width: $template.width() - $template[0].clientWidth,
            height: $template.height() - $template[0].clientHeight
        };
        $template.remove();
        return dim;
    }
    function equal(a, b) {
        if (a === b) return true;
        if (a === undefined || b === undefined) return false;
        if (a === null || b === null) return false;
        if (a.constructor === String) return a + "" === b + "";
        if (b.constructor === String) return b + "" === a + "";
        return false;
    }
    function splitVal(string, separator) {
        var val, i, l;
        if (string === null || string.length < 1) return [];
        val = string.split(separator);
        for (i = 0, l = val.length; i < l; i = i + 1) val[i] = $.trim(val[i]);
        return val;
    }
    function getSideBorderPadding(element) {
        return element.outerWidth(false) - element.width();
    }
    function installKeyUpChangeEvent(element) {
        var key = "keyup-change-value";
        element.on("keydown", function() {
            if ($.data(element, key) === undefined) {
                $.data(element, key, element.val());
            }
        });
        element.on("keyup", function() {
            var val = $.data(element, key);
            if (val !== undefined && element.val() !== val) {
                $.removeData(element, key);
                element.trigger("keyup-change");
            }
        });
    }
    function installFilteredMouseMove(element) {
        element.on("mousemove", function(e) {
            var lastpos = lastMousePosition;
            if (lastpos === undefined || lastpos.x !== e.pageX || lastpos.y !== e.pageY) {
                $(e.target).trigger("mousemove-filtered", e);
            }
        });
    }
    function debounce(quietMillis, fn, ctx) {
        ctx = ctx || undefined;
        var timeout;
        return function() {
            var args = arguments;
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function() {
                fn.apply(ctx, args);
            }, quietMillis);
        };
    }
    function installDebouncedScroll(threshold, element) {
        var notify = debounce(threshold, function(e) {
            element.trigger("scroll-debounced", e);
        });
        element.on("scroll", function(e) {
            if (indexOf(e.target, element.get()) >= 0) notify(e);
        });
    }
    function focus($el) {
        if ($el[0] === document.activeElement) return;
        window.setTimeout(function() {
            var el = $el[0], pos = $el.val().length, range;
            $el.focus();
            var isVisible = el.offsetWidth > 0 || el.offsetHeight > 0;
            if (isVisible && el === document.activeElement) {
                if (el.setSelectionRange) {
                    el.setSelectionRange(pos, pos);
                } else if (el.createTextRange) {
                    range = el.createTextRange();
                    range.collapse(false);
                    range.select();
                }
            }
        }, 0);
    }
    function getCursorInfo(el) {
        el = $(el)[0];
        var offset = 0;
        var length = 0;
        if ("selectionStart" in el) {
            offset = el.selectionStart;
            length = el.selectionEnd - offset;
        } else if ("selection" in document) {
            el.focus();
            var sel = document.selection.createRange();
            length = document.selection.createRange().text.length;
            sel.moveStart("character", -el.value.length);
            offset = sel.text.length - length;
        }
        return {
            offset: offset,
            length: length
        };
    }
    function killEvent(event) {
        event.preventDefault();
        event.stopPropagation();
    }
    function killEventImmediately(event) {
        event.preventDefault();
        event.stopImmediatePropagation();
    }
    function measureTextWidth(e) {
        if (!sizer) {
            var style = e[0].currentStyle || window.getComputedStyle(e[0], null);
            sizer = $(document.createElement("div")).css({
                position: "absolute",
                left: "-10000px",
                top: "-10000px",
                display: "none",
                fontSize: style.fontSize,
                fontFamily: style.fontFamily,
                fontStyle: style.fontStyle,
                fontWeight: style.fontWeight,
                letterSpacing: style.letterSpacing,
                textTransform: style.textTransform,
                whiteSpace: "nowrap"
            });
            sizer.attr("class", "select2-sizer");
            $("body").append(sizer);
        }
        sizer.text(e.val());
        return sizer.width();
    }
    function syncCssClasses(dest, src, adapter) {
        var classes, replacements = [], adapted;
        classes = $.trim(dest.attr("class"));
        if (classes) {
            classes = "" + classes;
            $(classes.split(/\s+/)).each2(function() {
                if (this.indexOf("select2-") === 0) {
                    replacements.push(this);
                }
            });
        }
        classes = $.trim(src.attr("class"));
        if (classes) {
            classes = "" + classes;
            $(classes.split(/\s+/)).each2(function() {
                if (this.indexOf("select2-") !== 0) {
                    adapted = adapter(this);
                    if (adapted) {
                        replacements.push(adapted);
                    }
                }
            });
        }
        dest.attr("class", replacements.join(" "));
    }
    function markMatch(text, term, markup, escapeMarkup) {
        var match = stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())), tl = term.length;
        if (match < 0) {
            markup.push(escapeMarkup(text));
            return;
        }
        markup.push(escapeMarkup(text.substring(0, match)));
        markup.push("<span class='select2-match'>");
        markup.push(escapeMarkup(text.substring(match, match + tl)));
        markup.push("</span>");
        markup.push(escapeMarkup(text.substring(match + tl, text.length)));
    }
    function defaultEscapeMarkup(markup) {
        var replace_map = {
            "\\": "&#92;",
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
            "/": "&#47;"
        };
        return String(markup).replace(/[&<>"'\/\\]/g, function(match) {
            return replace_map[match];
        });
    }
    function ajax(options) {
        var timeout, handler = null, quietMillis = options.quietMillis || 100, ajaxUrl = options.url, self = this;
        return function(query) {
            window.clearTimeout(timeout);
            timeout = window.setTimeout(function() {
                var data = options.data, url = ajaxUrl, transport = options.transport || $.fn.select2.ajaxDefaults.transport, deprecated = {
                    type: options.type || "GET",
                    cache: options.cache || false,
                    jsonpCallback: options.jsonpCallback || undefined,
                    dataType: options.dataType || "json"
                }, params = $.extend({}, $.fn.select2.ajaxDefaults.params, deprecated);
                data = data ? data.call(self, query.term, query.page, query.context) : null;
                url = typeof url === "function" ? url.call(self, query.term, query.page, query.context) : url;
                if (handler && typeof handler.abort === "function") {
                    handler.abort();
                }
                if (options.params) {
                    if ($.isFunction(options.params)) {
                        $.extend(params, options.params.call(self));
                    } else {
                        $.extend(params, options.params);
                    }
                }
                $.extend(params, {
                    url: url,
                    dataType: options.dataType,
                    data: data,
                    success: function(data) {
                        var results = options.results(data, query.page, query);
                        query.callback(results);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        var results = {
                            hasError: true,
                            jqXHR: jqXHR,
                            textStatus: textStatus,
                            errorThrown: errorThrown
                        };
                        query.callback(results);
                    }
                });
                handler = transport.call(self, params);
            }, quietMillis);
        };
    }
    function local(options) {
        var data = options, dataText, tmp, text = function(item) {
            return "" + item.text;
        };
        if ($.isArray(data)) {
            tmp = data;
            data = {
                results: tmp
            };
        }
        if ($.isFunction(data) === false) {
            tmp = data;
            data = function() {
                return tmp;
            };
        }
        var dataItem = data();
        if (dataItem.text) {
            text = dataItem.text;
            if (!$.isFunction(text)) {
                dataText = dataItem.text;
                text = function(item) {
                    return item[dataText];
                };
            }
        }
        return function(query) {
            var t = query.term, filtered = {
                results: []
            }, process;
            if (t === "") {
                query.callback(data());
                return;
            }
            process = function(datum, collection) {
                var group, attr;
                datum = datum[0];
                if (datum.children) {
                    group = {};
                    for (attr in datum) {
                        if (datum.hasOwnProperty(attr)) group[attr] = datum[attr];
                    }
                    group.children = [];
                    $(datum.children).each2(function(i, childDatum) {
                        process(childDatum, group.children);
                    });
                    if (group.children.length || query.matcher(t, text(group), datum)) {
                        collection.push(group);
                    }
                } else {
                    if (query.matcher(t, text(datum), datum)) {
                        collection.push(datum);
                    }
                }
            };
            $(data().results).each2(function(i, datum) {
                process(datum, filtered.results);
            });
            query.callback(filtered);
        };
    }
    function tags(data) {
        var isFunc = $.isFunction(data);
        return function(query) {
            var t = query.term, filtered = {
                results: []
            };
            var result = isFunc ? data(query) : data;
            if ($.isArray(result)) {
                $(result).each(function() {
                    var isObject = this.text !== undefined, text = isObject ? this.text : this;
                    if (t === "" || query.matcher(t, text)) {
                        filtered.results.push(isObject ? this : {
                            id: this,
                            text: this
                        });
                    }
                });
                query.callback(filtered);
            }
        };
    }
    function checkFormatter(formatter, formatterName) {
        if ($.isFunction(formatter)) return true;
        if (!formatter) return false;
        if (typeof formatter === "string") return true;
        throw new Error(formatterName + " must be a string, function, or falsy value");
    }
    function evaluate(val, context) {
        if ($.isFunction(val)) {
            var args = Array.prototype.slice.call(arguments, 2);
            return val.apply(context, args);
        }
        return val;
    }
    function countResults(results) {
        var count = 0;
        $.each(results, function(i, item) {
            if (item.children) {
                count += countResults(item.children);
            } else {
                count++;
            }
        });
        return count;
    }
    function defaultTokenizer(input, selection, selectCallback, opts) {
        var original = input, dupe = false, token, index, i, l, separator;
        if (!opts.createSearchChoice || !opts.tokenSeparators || opts.tokenSeparators.length < 1) return undefined;
        while (true) {
            index = -1;
            for (i = 0, l = opts.tokenSeparators.length; i < l; i++) {
                separator = opts.tokenSeparators[i];
                index = input.indexOf(separator);
                if (index >= 0) break;
            }
            if (index < 0) break;
            token = input.substring(0, index);
            input = input.substring(index + separator.length);
            if (token.length > 0) {
                token = opts.createSearchChoice.call(this, token, selection);
                if (token !== undefined && token !== null && opts.id(token) !== undefined && opts.id(token) !== null) {
                    dupe = false;
                    for (i = 0, l = selection.length; i < l; i++) {
                        if (equal(opts.id(token), opts.id(selection[i]))) {
                            dupe = true;
                            break;
                        }
                    }
                    if (!dupe) selectCallback(token);
                }
            }
        }
        if (original !== input) return input;
    }
    function cleanupJQueryElements() {
        var self = this;
        $.each(arguments, function(i, element) {
            self[element].remove();
            self[element] = null;
        });
    }
    function clazz(SuperClass, methods) {
        var constructor = function() {};
        constructor.prototype = new SuperClass();
        constructor.prototype.constructor = constructor;
        constructor.prototype.parent = SuperClass.prototype;
        constructor.prototype = $.extend(constructor.prototype, methods);
        return constructor;
    }
    AbstractSelect2 = clazz(Object, {
        bind: function(func) {
            var self = this;
            return function() {
                func.apply(self, arguments);
            };
        },
        init: function(opts) {
            var results, search, resultsSelector = ".select2-results";
            this.opts = opts = this.prepareOpts(opts);
            this.id = opts.id;
            if (opts.element.data("select2") !== undefined && opts.element.data("select2") !== null) {
                opts.element.data("select2").destroy();
            }
            this.container = this.createContainer();
            this.liveRegion = $(".select2-hidden-accessible");
            if (this.liveRegion.length == 0) {
                this.liveRegion = $("<span>", {
                    role: "status",
                    "aria-live": "polite"
                }).addClass("select2-hidden-accessible").appendTo(document.body);
            }
            this.containerId = "s2id_" + (opts.element.attr("id") || "autogen" + nextUid());
            this.containerEventName = this.containerId.replace(/([.])/g, "_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g, "\\$1");
            this.container.attr("id", this.containerId);
            this.container.attr("title", opts.element.attr("title"));
            this.body = $("body");
            syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);
            this.container.attr("style", opts.element.attr("style"));
            this.container.css(evaluate(opts.containerCss, this.opts.element));
            this.container.addClass(evaluate(opts.containerCssClass, this.opts.element));
            this.elementTabIndex = this.opts.element.attr("tabindex");
            this.opts.element.data("select2", this).attr("tabindex", "-1").before(this.container).on("click.select2", killEvent);
            this.container.data("select2", this);
            this.dropdown = this.container.find(".select2-drop");
            syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
            this.dropdown.addClass(evaluate(opts.dropdownCssClass, this.opts.element));
            this.dropdown.data("select2", this);
            this.dropdown.on("click", killEvent);
            this.results = results = this.container.find(resultsSelector);
            this.search = search = this.container.find("input.select2-input");
            this.queryCount = 0;
            this.resultsPage = 0;
            this.context = null;
            this.initContainer();
            this.container.on("click", killEvent);
            installFilteredMouseMove(this.results);
            this.dropdown.on("mousemove-filtered", resultsSelector, this.bind(this.highlightUnderEvent));
            this.dropdown.on("touchstart touchmove touchend", resultsSelector, this.bind(function(event) {
                this._touchEvent = true;
                this.highlightUnderEvent(event);
            }));
            this.dropdown.on("touchmove", resultsSelector, this.bind(this.touchMoved));
            this.dropdown.on("touchstart touchend", resultsSelector, this.bind(this.clearTouchMoved));
            this.dropdown.on("click", this.bind(function(event) {
                if (this._touchEvent) {
                    this._touchEvent = false;
                    this.selectHighlighted();
                }
            }));
            installDebouncedScroll(80, this.results);
            this.dropdown.on("scroll-debounced", resultsSelector, this.bind(this.loadMoreIfNeeded));
            $(this.container).on("change", ".select2-input", function(e) {
                e.stopPropagation();
            });
            $(this.dropdown).on("change", ".select2-input", function(e) {
                e.stopPropagation();
            });
            if ($.fn.mousewheel) {
                results.mousewheel(function(e, delta, deltaX, deltaY) {
                    var top = results.scrollTop();
                    if (deltaY > 0 && top - deltaY <= 0) {
                        results.scrollTop(0);
                        killEvent(e);
                    } else if (deltaY < 0 && results.get(0).scrollHeight - results.scrollTop() + deltaY <= results.height()) {
                        results.scrollTop(results.get(0).scrollHeight - results.height());
                        killEvent(e);
                    }
                });
            }
            installKeyUpChangeEvent(search);
            search.on("keyup-change input paste", this.bind(this.updateResults));
            search.on("focus", function() {
                search.addClass("select2-focused");
            });
            search.on("blur", function() {
                search.removeClass("select2-focused");
            });
            this.dropdown.on("mouseup", resultsSelector, this.bind(function(e) {
                if ($(e.target).closest(".select2-result-selectable").length > 0) {
                    this.highlightUnderEvent(e);
                    this.selectHighlighted(e);
                }
            }));
            this.dropdown.on("click mouseup mousedown touchstart touchend focusin", function(e) {
                e.stopPropagation();
            });
            this.nextSearchTerm = undefined;
            if ($.isFunction(this.opts.initSelection)) {
                this.initSelection();
                this.monitorSource();
            }
            if (opts.maximumInputLength !== null) {
                this.search.attr("maxlength", opts.maximumInputLength);
            }
            var disabled = opts.element.prop("disabled");
            if (disabled === undefined) disabled = false;
            this.enable(!disabled);
            var readonly = opts.element.prop("readonly");
            if (readonly === undefined) readonly = false;
            this.readonly(readonly);
            scrollBarDimensions = scrollBarDimensions || measureScrollbar();
            this.autofocus = opts.element.prop("autofocus");
            opts.element.prop("autofocus", false);
            if (this.autofocus) this.focus();
            this.search.attr("placeholder", opts.searchInputPlaceholder);
        },
        destroy: function() {
            var element = this.opts.element, select2 = element.data("select2"), self = this;
            this.close();
            if (element.length && element[0].detachEvent && self._sync) {
                element.each(function() {
                    this.detachEvent("onpropertychange", self._sync);
                });
            }
            if (this.propertyObserver) {
                this.propertyObserver.disconnect();
                this.propertyObserver = null;
            }
            this._sync = null;
            if (select2 !== undefined) {
                select2.container.remove();
                select2.liveRegion.remove();
                select2.dropdown.remove();
                element.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus", this.autofocus || false);
                if (this.elementTabIndex) {
                    element.attr({
                        tabindex: this.elementTabIndex
                    });
                } else {
                    element.removeAttr("tabindex");
                }
                element.show();
            }
            cleanupJQueryElements.call(this, "container", "liveRegion", "dropdown", "results", "search");
        },
        optionToData: function(element) {
            if (element.is("option")) {
                return {
                    id: element.prop("value"),
                    text: element.text(),
                    element: element.get(),
                    css: element.attr("class"),
                    disabled: element.prop("disabled"),
                    locked: equal(element.attr("locked"), "locked") || equal(element.data("locked"), true)
                };
            } else if (element.is("optgroup")) {
                return {
                    text: element.attr("label"),
                    children: [],
                    element: element.get(),
                    css: element.attr("class")
                };
            }
        },
        prepareOpts: function(opts) {
            var element, select, idKey, ajaxUrl, self = this;
            element = opts.element;
            if (element.get(0).tagName.toLowerCase() === "select") {
                this.select = select = opts.element;
            }
            if (select) {
                $.each([ "id", "multiple", "ajax", "query", "createSearchChoice", "initSelection", "data", "tags" ], function() {
                    if (this in opts) {
                        throw new Error("Option '" + this + "' is not allowed for Select2 when attached to a <select> element.");
                    }
                });
            }
            opts = $.extend({}, {
                populateResults: function(container, results, query) {
                    var populate, id = this.opts.id, liveRegion = this.liveRegion;
                    populate = function(results, container, depth) {
                        var i, l, result, selectable, disabled, compound, node, label, innerContainer, formatted;
                        results = opts.sortResults(results, container, query);
                        var nodes = [];
                        for (i = 0, l = results.length; i < l; i = i + 1) {
                            result = results[i];
                            disabled = result.disabled === true;
                            selectable = !disabled && id(result) !== undefined;
                            compound = result.children && result.children.length > 0;
                            node = $("<li></li>");
                            node.addClass("select2-results-dept-" + depth);
                            node.addClass("select2-result");
                            node.addClass(selectable ? "select2-result-selectable" : "select2-result-unselectable");
                            if (disabled) {
                                node.addClass("select2-disabled");
                            }
                            if (compound) {
                                node.addClass("select2-result-with-children");
                            }
                            node.addClass(self.opts.formatResultCssClass(result));
                            node.attr("role", "presentation");
                            label = $(document.createElement("div"));
                            label.addClass("select2-result-label");
                            label.attr("id", "select2-result-label-" + nextUid());
                            label.attr("role", "option");
                            formatted = opts.formatResult(result, label, query, self.opts.escapeMarkup);
                            if (formatted !== undefined) {
                                label.html(formatted);
                                node.append(label);
                            }
                            if (compound) {
                                innerContainer = $("<ul></ul>");
                                innerContainer.addClass("select2-result-sub");
                                populate(result.children, innerContainer, depth + 1);
                                node.append(innerContainer);
                            }
                            node.data("select2-data", result);
                            nodes.push(node[0]);
                        }
                        container.append(nodes);
                        liveRegion.text(opts.formatMatches(results.length));
                    };
                    populate(results, container, 0);
                }
            }, $.fn.select2.defaults, opts);
            if (typeof opts.id !== "function") {
                idKey = opts.id;
                opts.id = function(e) {
                    return e[idKey];
                };
            }
            if ($.isArray(opts.element.data("select2Tags"))) {
                if ("tags" in opts) {
                    throw "tags specified as both an attribute 'data-select2-tags' and in options of Select2 " + opts.element.attr("id");
                }
                opts.tags = opts.element.data("select2Tags");
            }
            if (select) {
                opts.query = this.bind(function(query) {
                    var data = {
                        results: [],
                        more: false
                    }, term = query.term, children, placeholderOption, process;
                    process = function(element, collection) {
                        var group;
                        if (element.is("option")) {
                            if (query.matcher(term, element.text(), element)) {
                                collection.push(self.optionToData(element));
                            }
                        } else if (element.is("optgroup")) {
                            group = self.optionToData(element);
                            element.children().each2(function(i, elm) {
                                process(elm, group.children);
                            });
                            if (group.children.length > 0) {
                                collection.push(group);
                            }
                        }
                    };
                    children = element.children();
                    if (this.getPlaceholder() !== undefined && children.length > 0) {
                        placeholderOption = this.getPlaceholderOption();
                        if (placeholderOption) {
                            children = children.not(placeholderOption);
                        }
                    }
                    children.each2(function(i, elm) {
                        process(elm, data.results);
                    });
                    query.callback(data);
                });
                opts.id = function(e) {
                    return e.id;
                };
            } else {
                if (!("query" in opts)) {
                    if ("ajax" in opts) {
                        ajaxUrl = opts.element.data("ajax-url");
                        if (ajaxUrl && ajaxUrl.length > 0) {
                            opts.ajax.url = ajaxUrl;
                        }
                        opts.query = ajax.call(opts.element, opts.ajax);
                    } else if ("data" in opts) {
                        opts.query = local(opts.data);
                    } else if ("tags" in opts) {
                        opts.query = tags(opts.tags);
                        if (opts.createSearchChoice === undefined) {
                            opts.createSearchChoice = function(term) {
                                return {
                                    id: $.trim(term),
                                    text: $.trim(term)
                                };
                            };
                        }
                        if (opts.initSelection === undefined) {
                            opts.initSelection = function(element, callback) {
                                var data = [];
                                $(splitVal(element.val(), opts.separator)).each(function() {
                                    var obj = {
                                        id: this,
                                        text: this
                                    }, tags = opts.tags;
                                    if ($.isFunction(tags)) tags = tags();
                                    $(tags).each(function() {
                                        if (equal(this.id, obj.id)) {
                                            obj = this;
                                            return false;
                                        }
                                    });
                                    data.push(obj);
                                });
                                callback(data);
                            };
                        }
                    }
                }
            }
            if (typeof opts.query !== "function") {
                throw "query function not defined for Select2 " + opts.element.attr("id");
            }
            if (opts.createSearchChoicePosition === "top") {
                opts.createSearchChoicePosition = function(list, item) {
                    list.unshift(item);
                };
            } else if (opts.createSearchChoicePosition === "bottom") {
                opts.createSearchChoicePosition = function(list, item) {
                    list.push(item);
                };
            } else if (typeof opts.createSearchChoicePosition !== "function") {
                throw "invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";
            }
            return opts;
        },
        monitorSource: function() {
            var el = this.opts.element, observer, self = this;
            el.on("change.select2", this.bind(function(e) {
                if (this.opts.element.data("select2-change-triggered") !== true) {
                    this.initSelection();
                }
            }));
            this._sync = this.bind(function() {
                var disabled = el.prop("disabled");
                if (disabled === undefined) disabled = false;
                this.enable(!disabled);
                var readonly = el.prop("readonly");
                if (readonly === undefined) readonly = false;
                this.readonly(readonly);
                syncCssClasses(this.container, this.opts.element, this.opts.adaptContainerCssClass);
                this.container.addClass(evaluate(this.opts.containerCssClass, this.opts.element));
                syncCssClasses(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
                this.dropdown.addClass(evaluate(this.opts.dropdownCssClass, this.opts.element));
            });
            if (el.length && el[0].attachEvent) {
                el.each(function() {
                    this.attachEvent("onpropertychange", self._sync);
                });
            }
            observer = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
            if (observer !== undefined) {
                if (this.propertyObserver) {
                    delete this.propertyObserver;
                    this.propertyObserver = null;
                }
                this.propertyObserver = new observer(function(mutations) {
                    $.each(mutations, self._sync);
                });
                this.propertyObserver.observe(el.get(0), {
                    attributes: true,
                    subtree: false
                });
            }
        },
        triggerSelect: function(data) {
            var evt = $.Event("select2-selecting", {
                val: this.id(data),
                object: data,
                choice: data
            });
            this.opts.element.trigger(evt);
            return !evt.isDefaultPrevented();
        },
        triggerChange: function(details) {
            details = details || {};
            details = $.extend({}, details, {
                type: "change",
                val: this.val()
            });
            this.opts.element.data("select2-change-triggered", true);
            this.opts.element.trigger(details);
            this.opts.element.data("select2-change-triggered", false);
            this.opts.element.click();
            if (this.opts.blurOnChange) this.opts.element.blur();
        },
        isInterfaceEnabled: function() {
            return this.enabledInterface === true;
        },
        enableInterface: function() {
            var enabled = this._enabled && !this._readonly, disabled = !enabled;
            if (enabled === this.enabledInterface) return false;
            this.container.toggleClass("select2-container-disabled", disabled);
            this.close();
            this.enabledInterface = enabled;
            return true;
        },
        enable: function(enabled) {
            if (enabled === undefined) enabled = true;
            if (this._enabled === enabled) return;
            this._enabled = enabled;
            this.opts.element.prop("disabled", !enabled);
            this.enableInterface();
        },
        disable: function() {
            this.enable(false);
        },
        readonly: function(enabled) {
            if (enabled === undefined) enabled = false;
            if (this._readonly === enabled) return;
            this._readonly = enabled;
            this.opts.element.prop("readonly", enabled);
            this.enableInterface();
        },
        opened: function() {
            return this.container ? this.container.hasClass("select2-dropdown-open") : false;
        },
        positionDropdown: function() {
            var $dropdown = this.dropdown, container = this.container, offset = container.offset(), height = container.outerHeight(false), width = container.outerWidth(false), dropHeight = $dropdown.outerHeight(false), $window = $(window), windowWidth = $window.width(), windowHeight = $window.height(), viewPortRight = $window.scrollLeft() + windowWidth, viewportBottom = $window.scrollTop() + windowHeight, dropTop = offset.top + height, dropLeft = offset.left, enoughRoomBelow = dropTop + dropHeight <= viewportBottom, enoughRoomAbove = offset.top - dropHeight >= $window.scrollTop(), dropWidth = $dropdown.outerWidth(false), enoughRoomOnRight = function() {
                return dropLeft + dropWidth <= viewPortRight;
            }, enoughRoomOnLeft = function() {
                return offset.left + viewPortRight + container.outerWidth(false) > dropWidth;
            }, aboveNow = $dropdown.hasClass("select2-drop-above"), bodyOffset, above, changeDirection, css, resultsListNode;
            if (aboveNow) {
                above = true;
                if (!enoughRoomAbove && enoughRoomBelow) {
                    changeDirection = true;
                    above = false;
                }
            } else {
                above = false;
                if (!enoughRoomBelow && enoughRoomAbove) {
                    changeDirection = true;
                    above = true;
                }
            }
            if (changeDirection) {
                $dropdown.hide();
                offset = this.container.offset();
                height = this.container.outerHeight(false);
                width = this.container.outerWidth(false);
                dropHeight = $dropdown.outerHeight(false);
                viewPortRight = $window.scrollLeft() + windowWidth;
                viewportBottom = $window.scrollTop() + windowHeight;
                dropTop = offset.top + height;
                dropLeft = offset.left;
                dropWidth = $dropdown.outerWidth(false);
                $dropdown.show();
                this.focusSearch();
            }
            if (this.opts.dropdownAutoWidth) {
                resultsListNode = $(".select2-results", $dropdown)[0];
                $dropdown.addClass("select2-drop-auto-width");
                $dropdown.css("width", "");
                dropWidth = $dropdown.outerWidth(false) + (resultsListNode.scrollHeight === resultsListNode.clientHeight ? 0 : scrollBarDimensions.width);
                dropWidth > width ? width = dropWidth : dropWidth = width;
                dropHeight = $dropdown.outerHeight(false);
            } else {
                this.container.removeClass("select2-drop-auto-width");
            }
            if (this.body.css("position") !== "static") {
                bodyOffset = this.body.offset();
                dropTop -= bodyOffset.top;
                dropLeft -= bodyOffset.left;
            }
            if (!enoughRoomOnRight() && enoughRoomOnLeft()) {
                dropLeft = offset.left + this.container.outerWidth(false) - dropWidth;
            }
            css = {
                left: dropLeft,
                width: width
            };
            if (above) {
                css.top = offset.top - dropHeight;
                css.bottom = "auto";
                this.container.addClass("select2-drop-above");
                $dropdown.addClass("select2-drop-above");
            } else {
                css.top = dropTop;
                css.bottom = "auto";
                this.container.removeClass("select2-drop-above");
                $dropdown.removeClass("select2-drop-above");
            }
            css = $.extend(css, evaluate(this.opts.dropdownCss, this.opts.element));
            $dropdown.css(css);
        },
        shouldOpen: function() {
            var event;
            if (this.opened()) return false;
            if (this._enabled === false || this._readonly === true) return false;
            event = $.Event("select2-opening");
            this.opts.element.trigger(event);
            return !event.isDefaultPrevented();
        },
        clearDropdownAlignmentPreference: function() {
            this.container.removeClass("select2-drop-above");
            this.dropdown.removeClass("select2-drop-above");
        },
        open: function() {
            if (!this.shouldOpen()) return false;
            this.opening();
            $document.on("mousemove.select2Event", function(e) {
                lastMousePosition.x = e.pageX;
                lastMousePosition.y = e.pageY;
            });
            return true;
        },
        opening: function() {
            var cid = this.containerEventName, scroll = "scroll." + cid, resize = "resize." + cid, orient = "orientationchange." + cid, mask;
            this.container.addClass("select2-dropdown-open").addClass("select2-container-active");
            this.clearDropdownAlignmentPreference();
            if (this.dropdown[0] !== this.body.children().last()[0]) {
                this.dropdown.detach().appendTo(this.body);
            }
            mask = $("#select2-drop-mask");
            if (mask.length == 0) {
                mask = $(document.createElement("div"));
                mask.attr("id", "select2-drop-mask").attr("class", "select2-drop-mask");
                mask.hide();
                mask.appendTo(this.body);
                mask.on("mousedown touchstart click", function(e) {
                    reinsertElement(mask);
                    var dropdown = $("#select2-drop"), self;
                    if (dropdown.length > 0) {
                        self = dropdown.data("select2");
                        if (self.opts.selectOnBlur) {
                            self.selectHighlighted({
                                noFocus: true
                            });
                        }
                        self.close();
                        e.preventDefault();
                        e.stopPropagation();
                    }
                });
            }
            if (this.dropdown.prev()[0] !== mask[0]) {
                this.dropdown.before(mask);
            }
            $("#select2-drop").removeAttr("id");
            this.dropdown.attr("id", "select2-drop");
            mask.show();
            this.positionDropdown();
            this.dropdown.show();
            this.positionDropdown();
            this.dropdown.addClass("select2-drop-active");
            var that = this;
            this.container.parents().add(window).each(function() {
                $(this).on(resize + " " + scroll + " " + orient, function(e) {
                    if (that.opened()) that.positionDropdown();
                });
            });
        },
        close: function() {
            if (!this.opened()) return;
            var cid = this.containerEventName, scroll = "scroll." + cid, resize = "resize." + cid, orient = "orientationchange." + cid;
            this.container.parents().add(window).each(function() {
                $(this).off(scroll).off(resize).off(orient);
            });
            this.clearDropdownAlignmentPreference();
            $("#select2-drop-mask").hide();
            this.dropdown.removeAttr("id");
            this.dropdown.hide();
            this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");
            this.results.empty();
            $document.off("mousemove.select2Event");
            this.clearSearch();
            this.search.removeClass("select2-active");
            this.opts.element.trigger($.Event("select2-close"));
        },
        externalSearch: function(term) {
            this.open();
            this.search.val(term);
            this.updateResults(false);
        },
        clearSearch: function() {},
        getMaximumSelectionSize: function() {
            return evaluate(this.opts.maximumSelectionSize, this.opts.element);
        },
        ensureHighlightVisible: function() {
            var results = this.results, children, index, child, hb, rb, y, more, topOffset;
            index = this.highlight();
            if (index < 0) return;
            if (index == 0) {
                results.scrollTop(0);
                return;
            }
            children = this.findHighlightableChoices().find(".select2-result-label");
            child = $(children[index]);
            topOffset = (child.offset() || {}).top || 0;
            hb = topOffset + child.outerHeight(true);
            if (index === children.length - 1) {
                more = results.find("li.select2-more-results");
                if (more.length > 0) {
                    hb = more.offset().top + more.outerHeight(true);
                }
            }
            rb = results.offset().top + results.outerHeight(true);
            if (hb > rb) {
                results.scrollTop(results.scrollTop() + (hb - rb));
            }
            y = topOffset - results.offset().top;
            if (y < 0 && child.css("display") != "none") {
                results.scrollTop(results.scrollTop() + y);
            }
        },
        findHighlightableChoices: function() {
            return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)");
        },
        moveHighlight: function(delta) {
            var choices = this.findHighlightableChoices(), index = this.highlight();
            while (index > -1 && index < choices.length) {
                index += delta;
                var choice = $(choices[index]);
                if (choice.hasClass("select2-result-selectable") && !choice.hasClass("select2-disabled") && !choice.hasClass("select2-selected")) {
                    this.highlight(index);
                    break;
                }
            }
        },
        highlight: function(index) {
            var choices = this.findHighlightableChoices(), choice, data;
            if (arguments.length === 0) {
                return indexOf(choices.filter(".select2-highlighted")[0], choices.get());
            }
            if (index >= choices.length) index = choices.length - 1;
            if (index < 0) index = 0;
            this.removeHighlight();
            choice = $(choices[index]);
            choice.addClass("select2-highlighted");
            this.search.attr("aria-activedescendant", choice.find(".select2-result-label").attr("id"));
            this.ensureHighlightVisible();
            this.liveRegion.text(choice.text());
            data = choice.data("select2-data");
            if (data) {
                this.opts.element.trigger({
                    type: "select2-highlight",
                    val: this.id(data),
                    choice: data
                });
            }
        },
        removeHighlight: function() {
            this.results.find(".select2-highlighted").removeClass("select2-highlighted");
        },
        touchMoved: function() {
            this._touchMoved = true;
        },
        clearTouchMoved: function() {
            this._touchMoved = false;
        },
        countSelectableResults: function() {
            return this.findHighlightableChoices().length;
        },
        highlightUnderEvent: function(event) {
            var el = $(event.target).closest(".select2-result-selectable");
            if (el.length > 0 && !el.is(".select2-highlighted")) {
                var choices = this.findHighlightableChoices();
                this.highlight(choices.index(el));
            } else if (el.length == 0) {
                this.removeHighlight();
            }
        },
        loadMoreIfNeeded: function() {
            var results = this.results, more = results.find("li.select2-more-results"), below, page = this.resultsPage + 1, self = this, term = this.search.val(), context = this.context;
            if (more.length === 0) return;
            below = more.offset().top - results.offset().top - results.height();
            if (below <= this.opts.loadMorePadding) {
                more.addClass("select2-active");
                this.opts.query({
                    element: this.opts.element,
                    term: term,
                    page: page,
                    context: context,
                    matcher: this.opts.matcher,
                    callback: this.bind(function(data) {
                        if (!self.opened()) return;
                        self.opts.populateResults.call(this, results, data.results, {
                            term: term,
                            page: page,
                            context: context
                        });
                        self.postprocessResults(data, false, false);
                        if (data.more === true) {
                            more.detach().appendTo(results).text(evaluate(self.opts.formatLoadMore, self.opts.element, page + 1));
                            window.setTimeout(function() {
                                self.loadMoreIfNeeded();
                            }, 10);
                        } else {
                            more.remove();
                        }
                        self.positionDropdown();
                        self.resultsPage = page;
                        self.context = data.context;
                        this.opts.element.trigger({
                            type: "select2-loaded",
                            items: data
                        });
                    })
                });
            }
        },
        tokenize: function() {},
        updateResults: function(initial) {
            var search = this.search, results = this.results, opts = this.opts, data, self = this, input, term = search.val(), lastTerm = $.data(this.container, "select2-last-term"), queryNumber;
            if (initial !== true && lastTerm && equal(term, lastTerm)) return;
            $.data(this.container, "select2-last-term", term);
            if (initial !== true && (this.showSearchInput === false || !this.opened())) {
                return;
            }
            function postRender() {
                search.removeClass("select2-active");
                self.positionDropdown();
                if (results.find(".select2-no-results,.select2-selection-limit,.select2-searching").length) {
                    self.liveRegion.text(results.text());
                } else {
                    self.liveRegion.text(self.opts.formatMatches(results.find(".select2-result-selectable").length));
                }
            }
            function render(html) {
                results.html(html);
                postRender();
            }
            queryNumber = ++this.queryCount;
            var maxSelSize = this.getMaximumSelectionSize();
            if (maxSelSize >= 1) {
                data = this.data();
                if ($.isArray(data) && data.length >= maxSelSize && checkFormatter(opts.formatSelectionTooBig, "formatSelectionTooBig")) {
                    render("<li class='select2-selection-limit'>" + evaluate(opts.formatSelectionTooBig, opts.element, maxSelSize) + "</li>");
                    return;
                }
            }
            if (search.val().length < opts.minimumInputLength) {
                if (checkFormatter(opts.formatInputTooShort, "formatInputTooShort")) {
                    render("<li class='select2-no-results'>" + evaluate(opts.formatInputTooShort, opts.element, search.val(), opts.minimumInputLength) + "</li>");
                } else {
                    render("");
                }
                if (initial && this.showSearch) this.showSearch(true);
                return;
            }
            if (opts.maximumInputLength && search.val().length > opts.maximumInputLength) {
                if (checkFormatter(opts.formatInputTooLong, "formatInputTooLong")) {
                    render("<li class='select2-no-results'>" + evaluate(opts.formatInputTooLong, opts.element, search.val(), opts.maximumInputLength) + "</li>");
                } else {
                    render("");
                }
                return;
            }
            if (opts.formatSearching && this.findHighlightableChoices().length === 0) {
                render("<li class='select2-searching'>" + evaluate(opts.formatSearching, opts.element) + "</li>");
            }
            search.addClass("select2-active");
            this.removeHighlight();
            input = this.tokenize();
            if (input != undefined && input != null) {
                search.val(input);
            }
            this.resultsPage = 1;
            opts.query({
                element: opts.element,
                term: search.val(),
                page: this.resultsPage,
                context: null,
                matcher: opts.matcher,
                callback: this.bind(function(data) {
                    var def;
                    if (queryNumber != this.queryCount) {
                        return;
                    }
                    if (!this.opened()) {
                        this.search.removeClass("select2-active");
                        return;
                    }
                    if (data.hasError !== undefined && checkFormatter(opts.formatAjaxError, "formatAjaxError")) {
                        render("<li class='select2-ajax-error'>" + evaluate(opts.formatAjaxError, opts.element, data.jqXHR, data.textStatus, data.errorThrown) + "</li>");
                        return;
                    }
                    this.context = data.context === undefined ? null : data.context;
                    if (this.opts.createSearchChoice && search.val() !== "") {
                        def = this.opts.createSearchChoice.call(self, search.val(), data.results);
                        if (def !== undefined && def !== null && self.id(def) !== undefined && self.id(def) !== null) {
                            if ($(data.results).filter(function() {
                                return equal(self.id(this), self.id(def));
                            }).length === 0) {
                                this.opts.createSearchChoicePosition(data.results, def);
                            }
                        }
                    }
                    if (data.results.length === 0 && checkFormatter(opts.formatNoMatches, "formatNoMatches")) {
                        render("<li class='select2-no-results'>" + evaluate(opts.formatNoMatches, opts.element, search.val()) + "</li>");
                        return;
                    }
                    results.empty();
                    self.opts.populateResults.call(this, results, data.results, {
                        term: search.val(),
                        page: this.resultsPage,
                        context: null
                    });
                    if (data.more === true && checkFormatter(opts.formatLoadMore, "formatLoadMore")) {
                        results.append("<li class='select2-more-results'>" + opts.escapeMarkup(evaluate(opts.formatLoadMore, opts.element, this.resultsPage)) + "</li>");
                        window.setTimeout(function() {
                            self.loadMoreIfNeeded();
                        }, 10);
                    }
                    this.postprocessResults(data, initial);
                    postRender();
                    this.opts.element.trigger({
                        type: "select2-loaded",
                        items: data
                    });
                })
            });
        },
        cancel: function() {
            this.close();
        },
        blur: function() {
            if (this.opts.selectOnBlur) this.selectHighlighted({
                noFocus: true
            });
            this.close();
            this.container.removeClass("select2-container-active");
            if (this.search[0] === document.activeElement) {
                this.search.blur();
            }
            this.clearSearch();
            this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
        },
        focusSearch: function() {
            focus(this.search);
        },
        selectHighlighted: function(options) {
            if (this._touchMoved) {
                this.clearTouchMoved();
                return;
            }
            var index = this.highlight(), highlighted = this.results.find(".select2-highlighted"), data = highlighted.closest(".select2-result").data("select2-data");
            if (data) {
                this.highlight(index);
                this.onSelect(data, options);
            } else if (options && options.noFocus) {
                this.close();
            }
        },
        getPlaceholder: function() {
            var placeholderOption;
            return this.opts.element.attr("placeholder") || this.opts.element.attr("data-placeholder") || this.opts.element.data("placeholder") || this.opts.placeholder || ((placeholderOption = this.getPlaceholderOption()) !== undefined ? placeholderOption.text() : undefined);
        },
        getPlaceholderOption: function() {
            if (this.select) {
                var firstOption = this.select.children("option").first();
                if (this.opts.placeholderOption !== undefined) {
                    return this.opts.placeholderOption === "first" && firstOption || typeof this.opts.placeholderOption === "function" && this.opts.placeholderOption(this.select);
                } else if ($.trim(firstOption.text()) === "" && firstOption.val() === "") {
                    return firstOption;
                }
            }
        },
        initContainerWidth: function() {
            function resolveContainerWidth() {
                var style, attrs, matches, i, l, attr;
                if (this.opts.width === "off") {
                    return null;
                } else if (this.opts.width === "element") {
                    return this.opts.element.outerWidth(false) === 0 ? "auto" : this.opts.element.outerWidth(false) + "px";
                } else if (this.opts.width === "copy" || this.opts.width === "resolve") {
                    style = this.opts.element.attr("style");
                    if (style !== undefined) {
                        attrs = style.split(";");
                        for (i = 0, l = attrs.length; i < l; i = i + 1) {
                            attr = attrs[i].replace(/\s/g, "");
                            matches = attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);
                            if (matches !== null && matches.length >= 1) return matches[1];
                        }
                    }
                    if (this.opts.width === "resolve") {
                        style = this.opts.element.css("width");
                        if (style.indexOf("%") > 0) return style;
                        return this.opts.element.outerWidth(false) === 0 ? "auto" : this.opts.element.outerWidth(false) + "px";
                    }
                    return null;
                } else if ($.isFunction(this.opts.width)) {
                    return this.opts.width();
                } else {
                    return this.opts.width;
                }
            }
            var width = resolveContainerWidth.call(this);
            if (width !== null) {
                this.container.css("width", width);
            }
        }
    });
    SingleSelect2 = clazz(AbstractSelect2, {
        createContainer: function() {
            var container = $(document.createElement("div")).attr({
                "class": "select2-container"
            }).html([ "<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>", "   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>", "   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>", "</a>", "<label for='' class='select2-offscreen'></label>", "<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />", "<div class='select2-drop select2-display-none'>", "   <div class='select2-search'>", "       <label for='' class='select2-offscreen'></label>", "       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'", "       aria-autocomplete='list' />", "   </div>", "   <ul class='select2-results' role='listbox'>", "   </ul>", "</div>" ].join(""));
            return container;
        },
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.focusser.prop("disabled", !this.isInterfaceEnabled());
            }
        },
        opening: function() {
            var el, range, len;
            if (this.opts.minimumResultsForSearch >= 0) {
                this.showSearch(true);
            }
            this.parent.opening.apply(this, arguments);
            if (this.showSearchInput !== false) {
                this.search.val(this.focusser.val());
            }
            if (this.opts.shouldFocusInput(this)) {
                this.search.focus();
                el = this.search.get(0);
                if (el.createTextRange) {
                    range = el.createTextRange();
                    range.collapse(false);
                    range.select();
                } else if (el.setSelectionRange) {
                    len = this.search.val().length;
                    el.setSelectionRange(len, len);
                }
            }
            if (this.search.val() === "") {
                if (this.nextSearchTerm != undefined) {
                    this.search.val(this.nextSearchTerm);
                    this.search.select();
                }
            }
            this.focusser.prop("disabled", true).val("");
            this.updateResults(true);
            this.opts.element.trigger($.Event("select2-open"));
        },
        close: function() {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);
            this.focusser.prop("disabled", false);
            if (this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }
        },
        focus: function() {
            if (this.opened()) {
                this.close();
            } else {
                this.focusser.prop("disabled", false);
                if (this.opts.shouldFocusInput(this)) {
                    this.focusser.focus();
                }
            }
        },
        isFocused: function() {
            return this.container.hasClass("select2-container-active");
        },
        cancel: function() {
            this.parent.cancel.apply(this, arguments);
            this.focusser.prop("disabled", false);
            if (this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }
        },
        destroy: function() {
            $("label[for='" + this.focusser.attr("id") + "']").attr("for", this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);
            cleanupJQueryElements.call(this, "selection", "focusser");
        },
        initContainer: function() {
            var selection, container = this.container, dropdown = this.dropdown, idSuffix = nextUid(), elementLabel;
            if (this.opts.minimumResultsForSearch < 0) {
                this.showSearch(false);
            } else {
                this.showSearch(true);
            }
            this.selection = selection = container.find(".select2-choice");
            this.focusser = container.find(".select2-focusser");
            selection.find(".select2-chosen").attr("id", "select2-chosen-" + idSuffix);
            this.focusser.attr("aria-labelledby", "select2-chosen-" + idSuffix);
            this.results.attr("id", "select2-results-" + idSuffix);
            this.search.attr("aria-owns", "select2-results-" + idSuffix);
            this.focusser.attr("id", "s2id_autogen" + idSuffix);
            elementLabel = $("label[for='" + this.opts.element.attr("id") + "']");
            this.focusser.prev().text(elementLabel.text()).attr("for", this.focusser.attr("id"));
            var originalTitle = this.opts.element.attr("title");
            this.opts.element.attr("title", originalTitle || elementLabel.text());
            this.focusser.attr("tabindex", this.elementTabIndex);
            this.search.attr("id", this.focusser.attr("id") + "_search");
            this.search.prev().text($("label[for='" + this.focusser.attr("id") + "']").text()).attr("for", this.search.attr("id"));
            this.search.on("keydown", this.bind(function(e) {
                if (!this.isInterfaceEnabled()) return;
                if (229 == e.keyCode) return;
                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    killEvent(e);
                    return;
                }
                switch (e.which) {
                  case KEY.UP:
                  case KEY.DOWN:
                    this.moveHighlight(e.which === KEY.UP ? -1 : 1);
                    killEvent(e);
                    return;

                  case KEY.ENTER:
                    this.selectHighlighted();
                    killEvent(e);
                    return;

                  case KEY.TAB:
                    this.selectHighlighted({
                        noFocus: true
                    });
                    return;

                  case KEY.ESC:
                    this.cancel(e);
                    killEvent(e);
                    return;
                }
            }));
            this.search.on("blur", this.bind(function(e) {
                if (document.activeElement === this.body.get(0)) {
                    window.setTimeout(this.bind(function() {
                        if (this.opened()) {
                            this.search.focus();
                        }
                    }), 0);
                }
            }));
            this.focusser.on("keydown", this.bind(function(e) {
                if (!this.isInterfaceEnabled()) return;
                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.ESC) {
                    return;
                }
                if (this.opts.openOnEnter === false && e.which === KEY.ENTER) {
                    killEvent(e);
                    return;
                }
                if (e.which == KEY.DOWN || e.which == KEY.UP || e.which == KEY.ENTER && this.opts.openOnEnter) {
                    if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) return;
                    this.open();
                    killEvent(e);
                    return;
                }
                if (e.which == KEY.DELETE || e.which == KEY.BACKSPACE) {
                    if (this.opts.allowClear) {
                        this.clear();
                    }
                    killEvent(e);
                    return;
                }
            }));
            installKeyUpChangeEvent(this.focusser);
            this.focusser.on("keyup-change input", this.bind(function(e) {
                if (this.opts.minimumResultsForSearch >= 0) {
                    e.stopPropagation();
                    if (this.opened()) return;
                    this.open();
                }
            }));
            selection.on("mousedown touchstart", "abbr", this.bind(function(e) {
                if (!this.isInterfaceEnabled()) return;
                this.clear();
                killEventImmediately(e);
                this.close();
                this.selection.focus();
            }));
            selection.on("mousedown touchstart", this.bind(function(e) {
                reinsertElement(selection);
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                if (this.opened()) {
                    this.close();
                } else if (this.isInterfaceEnabled()) {
                    this.open();
                }
                killEvent(e);
            }));
            dropdown.on("mousedown touchstart", this.bind(function() {
                if (this.opts.shouldFocusInput(this)) {
                    this.search.focus();
                }
            }));
            selection.on("focus", this.bind(function(e) {
                killEvent(e);
            }));
            this.focusser.on("focus", this.bind(function() {
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
            })).on("blur", this.bind(function() {
                if (!this.opened()) {
                    this.container.removeClass("select2-container-active");
                    this.opts.element.trigger($.Event("select2-blur"));
                }
            }));
            this.search.on("focus", this.bind(function() {
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
            }));
            this.initContainerWidth();
            this.opts.element.addClass("select2-offscreen");
            this.setPlaceholder();
        },
        clear: function(triggerChange) {
            var data = this.selection.data("select2-data");
            if (data) {
                var evt = $.Event("select2-clearing");
                this.opts.element.trigger(evt);
                if (evt.isDefaultPrevented()) {
                    return;
                }
                var placeholderOption = this.getPlaceholderOption();
                this.opts.element.val(placeholderOption ? placeholderOption.val() : "");
                this.selection.find(".select2-chosen").empty();
                this.selection.removeData("select2-data");
                this.setPlaceholder();
                if (triggerChange !== false) {
                    this.opts.element.trigger({
                        type: "select2-removed",
                        val: this.id(data),
                        choice: data
                    });
                    this.triggerChange({
                        removed: data
                    });
                }
            }
        },
        initSelection: function() {
            var selected;
            if (this.isPlaceholderOptionSelected()) {
                this.updateSelection(null);
                this.close();
                this.setPlaceholder();
            } else {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(selected) {
                    if (selected !== undefined && selected !== null) {
                        self.updateSelection(selected);
                        self.close();
                        self.setPlaceholder();
                        self.nextSearchTerm = self.opts.nextSearchTerm(selected, self.search.val());
                    }
                });
            }
        },
        isPlaceholderOptionSelected: function() {
            var placeholderOption;
            if (this.getPlaceholder() === undefined) return false;
            return (placeholderOption = this.getPlaceholderOption()) !== undefined && placeholderOption.prop("selected") || this.opts.element.val() === "" || this.opts.element.val() === undefined || this.opts.element.val() === null;
        },
        prepareOpts: function() {
            var opts = this.parent.prepareOpts.apply(this, arguments), self = this;
            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                opts.initSelection = function(element, callback) {
                    var selected = element.find("option").filter(function() {
                        return this.selected && !this.disabled;
                    });
                    callback(self.optionToData(selected));
                };
            } else if ("data" in opts) {
                opts.initSelection = opts.initSelection || function(element, callback) {
                    var id = element.val();
                    var match = null;
                    opts.query({
                        matcher: function(term, text, el) {
                            var is_match = equal(id, opts.id(el));
                            if (is_match) {
                                match = el;
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            callback(match);
                        }
                    });
                };
            }
            return opts;
        },
        getPlaceholder: function() {
            if (this.select) {
                if (this.getPlaceholderOption() === undefined) {
                    return undefined;
                }
            }
            return this.parent.getPlaceholder.apply(this, arguments);
        },
        setPlaceholder: function() {
            var placeholder = this.getPlaceholder();
            if (this.isPlaceholderOptionSelected() && placeholder !== undefined) {
                if (this.select && this.getPlaceholderOption() === undefined) return;
                this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(placeholder));
                this.selection.addClass("select2-default");
                this.container.removeClass("select2-allowclear");
            }
        },
        postprocessResults: function(data, initial, noHighlightUpdate) {
            var selected = 0, self = this, showSearchInput = true;
            this.findHighlightableChoices().each2(function(i, elm) {
                if (equal(self.id(elm.data("select2-data")), self.opts.element.val())) {
                    selected = i;
                    return false;
                }
            });
            if (noHighlightUpdate !== false) {
                if (initial === true && selected >= 0) {
                    this.highlight(selected);
                } else {
                    this.highlight(0);
                }
            }
            if (initial === true) {
                var min = this.opts.minimumResultsForSearch;
                if (min >= 0) {
                    this.showSearch(countResults(data.results) >= min);
                }
            }
        },
        showSearch: function(showSearchInput) {
            if (this.showSearchInput === showSearchInput) return;
            this.showSearchInput = showSearchInput;
            this.dropdown.find(".select2-search").toggleClass("select2-search-hidden", !showSearchInput);
            this.dropdown.find(".select2-search").toggleClass("select2-offscreen", !showSearchInput);
            $(this.dropdown, this.container).toggleClass("select2-with-searchbox", showSearchInput);
        },
        onSelect: function(data, options) {
            if (!this.triggerSelect(data)) {
                return;
            }
            var old = this.opts.element.val(), oldData = this.data();
            this.opts.element.val(this.id(data));
            this.updateSelection(data);
            this.opts.element.trigger({
                type: "select2-selected",
                val: this.id(data),
                choice: data
            });
            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());
            this.close();
            if ((!options || !options.noFocus) && this.opts.shouldFocusInput(this)) {
                this.focusser.focus();
            }
            if (!equal(old, this.id(data))) {
                this.triggerChange({
                    added: data,
                    removed: oldData
                });
            }
        },
        updateSelection: function(data) {
            var container = this.selection.find(".select2-chosen"), formatted, cssClass;
            this.selection.data("select2-data", data);
            container.empty();
            if (data !== null) {
                formatted = this.opts.formatSelection(data, container, this.opts.escapeMarkup);
            }
            if (formatted !== undefined) {
                container.append(formatted);
            }
            cssClass = this.opts.formatSelectionCssClass(data, container);
            if (cssClass !== undefined) {
                container.addClass(cssClass);
            }
            this.selection.removeClass("select2-default");
            if (this.opts.allowClear && this.getPlaceholder() !== undefined) {
                this.container.addClass("select2-allowclear");
            }
        },
        val: function() {
            var val, triggerChange = false, data = null, self = this, oldData = this.data();
            if (arguments.length === 0) {
                return this.opts.element.val();
            }
            val = arguments[0];
            if (arguments.length > 1) {
                triggerChange = arguments[1];
            }
            if (this.select) {
                this.select.val(val).find("option").filter(function() {
                    return this.selected;
                }).each2(function(i, elm) {
                    data = self.optionToData(elm);
                    return false;
                });
                this.updateSelection(data);
                this.setPlaceholder();
                if (triggerChange) {
                    this.triggerChange({
                        added: data,
                        removed: oldData
                    });
                }
            } else {
                if (!val && val !== 0) {
                    this.clear(triggerChange);
                    return;
                }
                if (this.opts.initSelection === undefined) {
                    throw new Error("cannot call val() if initSelection() is not defined");
                }
                this.opts.element.val(val);
                this.opts.initSelection(this.opts.element, function(data) {
                    self.opts.element.val(!data ? "" : self.id(data));
                    self.updateSelection(data);
                    self.setPlaceholder();
                    if (triggerChange) {
                        self.triggerChange({
                            added: data,
                            removed: oldData
                        });
                    }
                });
            }
        },
        clearSearch: function() {
            this.search.val("");
            this.focusser.val("");
        },
        data: function(value) {
            var data, triggerChange = false;
            if (arguments.length === 0) {
                data = this.selection.data("select2-data");
                if (data == undefined) data = null;
                return data;
            } else {
                if (arguments.length > 1) {
                    triggerChange = arguments[1];
                }
                if (!value) {
                    this.clear(triggerChange);
                } else {
                    data = this.data();
                    this.opts.element.val(!value ? "" : this.id(value));
                    this.updateSelection(value);
                    if (triggerChange) {
                        this.triggerChange({
                            added: value,
                            removed: data
                        });
                    }
                }
            }
        }
    });
    MultiSelect2 = clazz(AbstractSelect2, {
        createContainer: function() {
            var container = $(document.createElement("div")).attr({
                "class": "select2-container select2-container-multi"
            }).html([ "<ul class='select2-choices'>", "  <li class='select2-search-field'>", "    <label for='' class='select2-offscreen'></label>", "    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>", "  </li>", "</ul>", "<div class='select2-drop select2-drop-multi select2-display-none'>", "   <ul class='select2-results'>", "   </ul>", "</div>" ].join(""));
            return container;
        },
        prepareOpts: function() {
            var opts = this.parent.prepareOpts.apply(this, arguments), self = this;
            if (opts.element.get(0).tagName.toLowerCase() === "select") {
                opts.initSelection = function(element, callback) {
                    var data = [];
                    element.find("option").filter(function() {
                        return this.selected && !this.disabled;
                    }).each2(function(i, elm) {
                        data.push(self.optionToData(elm));
                    });
                    callback(data);
                };
            } else if ("data" in opts) {
                opts.initSelection = opts.initSelection || function(element, callback) {
                    var ids = splitVal(element.val(), opts.separator);
                    var matches = [];
                    opts.query({
                        matcher: function(term, text, el) {
                            var is_match = $.grep(ids, function(id) {
                                return equal(id, opts.id(el));
                            }).length;
                            if (is_match) {
                                matches.push(el);
                            }
                            return is_match;
                        },
                        callback: !$.isFunction(callback) ? $.noop : function() {
                            var ordered = [];
                            for (var i = 0; i < ids.length; i++) {
                                var id = ids[i];
                                for (var j = 0; j < matches.length; j++) {
                                    var match = matches[j];
                                    if (equal(id, opts.id(match))) {
                                        ordered.push(match);
                                        matches.splice(j, 1);
                                        break;
                                    }
                                }
                            }
                            callback(ordered);
                        }
                    });
                };
            }
            return opts;
        },
        selectChoice: function(choice) {
            var selected = this.container.find(".select2-search-choice-focus");
            if (selected.length && choice && choice[0] == selected[0]) {} else {
                if (selected.length) {
                    this.opts.element.trigger("choice-deselected", selected);
                }
                selected.removeClass("select2-search-choice-focus");
                if (choice && choice.length) {
                    this.close();
                    choice.addClass("select2-search-choice-focus");
                    this.opts.element.trigger("choice-selected", choice);
                }
            }
        },
        destroy: function() {
            $("label[for='" + this.search.attr("id") + "']").attr("for", this.opts.element.attr("id"));
            this.parent.destroy.apply(this, arguments);
            cleanupJQueryElements.call(this, "searchContainer", "selection");
        },
        initContainer: function() {
            var selector = ".select2-choices", selection;
            this.searchContainer = this.container.find(".select2-search-field");
            this.selection = selection = this.container.find(selector);
            var _this = this;
            this.selection.on("click", ".select2-container:not(.select2-container-disabled) .select2-search-choice:not(.select2-locked)", function(e) {
                _this.search[0].focus();
                _this.selectChoice($(this));
            });
            this.search.attr("id", "s2id_autogen" + nextUid());
            this.search.prev().text($("label[for='" + this.opts.element.attr("id") + "']").text()).attr("for", this.search.attr("id"));
            this.search.on("input paste", this.bind(function() {
                if (this.search.attr("placeholder") && this.search.val().length == 0) return;
                if (!this.isInterfaceEnabled()) return;
                if (!this.opened()) {
                    this.open();
                }
            }));
            this.search.attr("tabindex", this.elementTabIndex);
            this.keydowns = 0;
            this.search.on("keydown", this.bind(function(e) {
                if (!this.isInterfaceEnabled()) return;
                ++this.keydowns;
                var selected = selection.find(".select2-search-choice-focus");
                var prev = selected.prev(".select2-search-choice:not(.select2-locked)");
                var next = selected.next(".select2-search-choice:not(.select2-locked)");
                var pos = getCursorInfo(this.search);
                if (selected.length && (e.which == KEY.LEFT || e.which == KEY.RIGHT || e.which == KEY.BACKSPACE || e.which == KEY.DELETE || e.which == KEY.ENTER)) {
                    var selectedChoice = selected;
                    if (e.which == KEY.LEFT && prev.length) {
                        selectedChoice = prev;
                    } else if (e.which == KEY.RIGHT) {
                        selectedChoice = next.length ? next : null;
                    } else if (e.which === KEY.BACKSPACE) {
                        if (this.unselect(selected.first())) {
                            this.search.width(10);
                            selectedChoice = prev.length ? prev : next;
                        }
                    } else if (e.which == KEY.DELETE) {
                        if (this.unselect(selected.first())) {
                            this.search.width(10);
                            selectedChoice = next.length ? next : null;
                        }
                    } else if (e.which == KEY.ENTER) {
                        selectedChoice = null;
                    }
                    this.selectChoice(selectedChoice);
                    killEvent(e);
                    if (!selectedChoice || !selectedChoice.length) {
                        this.open();
                    }
                    return;
                } else if ((e.which === KEY.BACKSPACE && this.keydowns == 1 || e.which == KEY.LEFT) && (pos.offset == 0 && !pos.length)) {
                    this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last());
                    killEvent(e);
                    return;
                } else {
                    this.selectChoice(null);
                }
                if (this.opened()) {
                    switch (e.which) {
                      case KEY.UP:
                      case KEY.DOWN:
                        this.moveHighlight(e.which === KEY.UP ? -1 : 1);
                        killEvent(e);
                        return;

                      case KEY.ENTER:
                        this.selectHighlighted();
                        killEvent(e);
                        return;

                      case KEY.TAB:
                        this.selectHighlighted({
                            noFocus: true
                        });
                        this.close();
                        return;

                      case KEY.ESC:
                        this.cancel(e);
                        killEvent(e);
                        return;
                    }
                }
                if (e.which === KEY.TAB || KEY.isControl(e) || KEY.isFunctionKey(e) || e.which === KEY.BACKSPACE || e.which === KEY.ESC) {
                    return;
                }
                if (e.which === KEY.ENTER) {
                    if (this.opts.openOnEnter === false) {
                        return;
                    } else if (e.altKey || e.ctrlKey || e.shiftKey || e.metaKey) {
                        return;
                    }
                }
                this.open();
                if (e.which === KEY.PAGE_UP || e.which === KEY.PAGE_DOWN) {
                    killEvent(e);
                }
                if (e.which === KEY.ENTER) {
                    killEvent(e);
                }
            }));
            this.search.on("keyup", this.bind(function(e) {
                this.keydowns = 0;
                this.resizeSearch();
            }));
            this.search.on("blur", this.bind(function(e) {
                this.container.removeClass("select2-container-active");
                this.search.removeClass("select2-focused");
                this.selectChoice(null);
                if (!this.opened()) this.clearSearch();
                e.stopImmediatePropagation();
                this.opts.element.trigger($.Event("select2-blur"));
            }));
            this.container.on("click", selector, this.bind(function(e) {
                if (!this.isInterfaceEnabled()) return;
                if ($(e.target).closest(".select2-search-choice").length > 0) {
                    return;
                }
                this.selectChoice(null);
                this.clearPlaceholder();
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.open();
                this.focusSearch();
                e.preventDefault();
            }));
            this.container.on("focus", selector, this.bind(function() {
                if (!this.isInterfaceEnabled()) return;
                if (!this.container.hasClass("select2-container-active")) {
                    this.opts.element.trigger($.Event("select2-focus"));
                }
                this.container.addClass("select2-container-active");
                this.dropdown.addClass("select2-drop-active");
                this.clearPlaceholder();
            }));
            this.initContainerWidth();
            this.opts.element.addClass("select2-offscreen");
            this.clearSearch();
        },
        enableInterface: function() {
            if (this.parent.enableInterface.apply(this, arguments)) {
                this.search.prop("disabled", !this.isInterfaceEnabled());
            }
        },
        initSelection: function() {
            var data;
            if (this.opts.element.val() === "" && this.opts.element.text() === "") {
                this.updateSelection([]);
                this.close();
                this.clearSearch();
            }
            if (this.select || this.opts.element.val() !== "") {
                var self = this;
                this.opts.initSelection.call(null, this.opts.element, function(data) {
                    if (data !== undefined && data !== null) {
                        self.updateSelection(data);
                        self.close();
                        self.clearSearch();
                    }
                });
            }
        },
        clearSearch: function() {
            var placeholder = this.getPlaceholder(), maxWidth = this.getMaxSearchWidth();
            if (placeholder !== undefined && this.getVal().length === 0 && this.search.hasClass("select2-focused") === false) {
                this.search.val(placeholder).addClass("select2-default");
                this.search.width(maxWidth > 0 ? maxWidth : this.container.css("width"));
            } else {
                this.search.val("").width(10);
            }
        },
        clearPlaceholder: function() {
            if (this.search.hasClass("select2-default")) {
                this.search.val("").removeClass("select2-default");
            }
        },
        opening: function() {
            this.clearPlaceholder();
            this.resizeSearch();
            this.parent.opening.apply(this, arguments);
            this.focusSearch();
            if (this.search.val() === "") {
                if (this.nextSearchTerm != undefined) {
                    this.search.val(this.nextSearchTerm);
                    this.search.select();
                }
            }
            this.updateResults(true);
            if (this.opts.shouldFocusInput(this)) {
                this.search.focus();
            }
            this.opts.element.trigger($.Event("select2-open"));
        },
        close: function() {
            if (!this.opened()) return;
            this.parent.close.apply(this, arguments);
        },
        focus: function() {
            this.close();
            this.search.focus();
        },
        isFocused: function() {
            return this.search.hasClass("select2-focused");
        },
        updateSelection: function(data) {
            var ids = [], filtered = [], self = this;
            $(data).each(function() {
                if (indexOf(self.id(this), ids) < 0) {
                    ids.push(self.id(this));
                    filtered.push(this);
                }
            });
            data = filtered;
            this.selection.find(".select2-search-choice").remove();
            $(data).each(function() {
                self.addSelectedChoice(this);
            });
            self.postprocessResults();
        },
        tokenize: function() {
            var input = this.search.val();
            input = this.opts.tokenizer.call(this, input, this.data(), this.bind(this.onSelect), this.opts);
            if (input != null && input != undefined) {
                this.search.val(input);
                if (input.length > 0) {
                    this.open();
                }
            }
        },
        onSelect: function(data, options) {
            if (!this.triggerSelect(data) || data.text === "") {
                return;
            }
            this.addSelectedChoice(data);
            this.opts.element.trigger({
                type: "selected",
                val: this.id(data),
                choice: data
            });
            this.nextSearchTerm = this.opts.nextSearchTerm(data, this.search.val());
            this.clearSearch();
            this.updateResults();
            if (this.select || !this.opts.closeOnSelect) this.postprocessResults(data, false, this.opts.closeOnSelect === true);
            if (this.opts.closeOnSelect) {
                this.close();
                this.search.width(10);
            } else {
                if (this.countSelectableResults() > 0) {
                    this.search.width(10);
                    this.resizeSearch();
                    if (this.getMaximumSelectionSize() > 0 && this.val().length >= this.getMaximumSelectionSize()) {
                        this.updateResults(true);
                    } else {
                        if (this.nextSearchTerm != undefined) {
                            this.search.val(this.nextSearchTerm);
                            this.updateResults();
                            this.search.select();
                        }
                    }
                    this.positionDropdown();
                } else {
                    this.close();
                    this.search.width(10);
                }
            }
            this.triggerChange({
                added: data
            });
            if (!options || !options.noFocus) this.focusSearch();
        },
        cancel: function() {
            this.close();
            this.focusSearch();
        },
        addSelectedChoice: function(data) {
            var enableChoice = !data.locked, enabledItem = $("<li class='select2-search-choice'>" + "    <div></div>" + "    <a href='#' class='select2-search-choice-close' tabindex='-1'></a>" + "</li>"), disabledItem = $("<li class='select2-search-choice select2-locked'>" + "<div></div>" + "</li>");
            var choice = enableChoice ? enabledItem : disabledItem, id = this.id(data), val = this.getVal(), formatted, cssClass;
            formatted = this.opts.formatSelection(data, choice.find("div"), this.opts.escapeMarkup);
            if (formatted != undefined) {
                choice.find("div").replaceWith("<div>" + formatted + "</div>");
            }
            cssClass = this.opts.formatSelectionCssClass(data, choice.find("div"));
            if (cssClass != undefined) {
                choice.addClass(cssClass);
            }
            if (enableChoice) {
                choice.find(".select2-search-choice-close").on("mousedown", killEvent).on("click dblclick", this.bind(function(e) {
                    if (!this.isInterfaceEnabled()) return;
                    this.unselect($(e.target));
                    this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
                    killEvent(e);
                    this.close();
                    this.focusSearch();
                })).on("focus", this.bind(function() {
                    if (!this.isInterfaceEnabled()) return;
                    this.container.addClass("select2-container-active");
                    this.dropdown.addClass("select2-drop-active");
                }));
            }
            choice.data("select2-data", data);
            choice.insertBefore(this.searchContainer);
            val.push(id);
            this.setVal(val);
        },
        unselect: function(selected) {
            var val = this.getVal(), data, index;
            selected = selected.closest(".select2-search-choice");
            if (selected.length === 0) {
                throw "Invalid argument: " + selected + ". Must be .select2-search-choice";
            }
            data = selected.data("select2-data");
            if (!data) {
                return;
            }
            var evt = $.Event("select2-removing");
            evt.val = this.id(data);
            evt.choice = data;
            this.opts.element.trigger(evt);
            if (evt.isDefaultPrevented()) {
                return false;
            }
            while ((index = indexOf(this.id(data), val)) >= 0) {
                val.splice(index, 1);
                this.setVal(val);
                if (this.select) this.postprocessResults();
            }
            selected.remove();
            this.opts.element.trigger({
                type: "select2-removed",
                val: this.id(data),
                choice: data
            });
            this.triggerChange({
                removed: data
            });
            return true;
        },
        postprocessResults: function(data, initial, noHighlightUpdate) {
            var val = this.getVal(), choices = this.results.find(".select2-result"), compound = this.results.find(".select2-result-with-children"), self = this;
            choices.each2(function(i, choice) {
                var id = self.id(choice.data("select2-data"));
                if (indexOf(id, val) >= 0) {
                    choice.addClass("select2-selected");
                    choice.find(".select2-result-selectable").addClass("select2-selected");
                }
            });
            compound.each2(function(i, choice) {
                if (!choice.is(".select2-result-selectable") && choice.find(".select2-result-selectable:not(.select2-selected)").length === 0) {
                    choice.addClass("select2-selected");
                }
            });
            if (this.highlight() == -1 && noHighlightUpdate !== false) {
                self.highlight(0);
            }
            if (!this.opts.createSearchChoice && !choices.filter(".select2-result:not(.select2-selected)").length > 0) {
                if (!data || data && !data.more && this.results.find(".select2-no-results").length === 0) {
                    if (checkFormatter(self.opts.formatNoMatches, "formatNoMatches")) {
                        this.results.append("<li class='select2-no-results'>" + evaluate(self.opts.formatNoMatches, self.opts.element, self.search.val()) + "</li>");
                    }
                }
            }
        },
        getMaxSearchWidth: function() {
            return this.selection.width() - getSideBorderPadding(this.search);
        },
        resizeSearch: function() {
            var minimumWidth, left, maxWidth, containerLeft, searchWidth, sideBorderPadding = getSideBorderPadding(this.search);
            minimumWidth = measureTextWidth(this.search) + 10;
            left = this.search.offset().left;
            maxWidth = this.selection.width();
            containerLeft = this.selection.offset().left;
            searchWidth = maxWidth - (left - containerLeft) - sideBorderPadding;
            if (searchWidth < minimumWidth) {
                searchWidth = maxWidth - sideBorderPadding;
            }
            if (searchWidth < 40) {
                searchWidth = maxWidth - sideBorderPadding;
            }
            if (searchWidth <= 0) {
                searchWidth = minimumWidth;
            }
            this.search.width(Math.floor(searchWidth));
        },
        getVal: function() {
            var val;
            if (this.select) {
                val = this.select.val();
                return val === null ? [] : val;
            } else {
                val = this.opts.element.val();
                return splitVal(val, this.opts.separator);
            }
        },
        setVal: function(val) {
            var unique;
            if (this.select) {
                this.select.val(val);
            } else {
                unique = [];
                $(val).each(function() {
                    if (indexOf(this, unique) < 0) unique.push(this);
                });
                this.opts.element.val(unique.length === 0 ? "" : unique.join(this.opts.separator));
            }
        },
        buildChangeDetails: function(old, current) {
            var current = current.slice(0), old = old.slice(0);
            for (var i = 0; i < current.length; i++) {
                for (var j = 0; j < old.length; j++) {
                    if (equal(this.opts.id(current[i]), this.opts.id(old[j]))) {
                        current.splice(i, 1);
                        if (i > 0) {
                            i--;
                        }
                        old.splice(j, 1);
                        j--;
                    }
                }
            }
            return {
                added: current,
                removed: old
            };
        },
        val: function(val, triggerChange) {
            var oldData, self = this;
            if (arguments.length === 0) {
                return this.getVal();
            }
            oldData = this.data();
            if (!oldData.length) oldData = [];
            if (!val && val !== 0) {
                this.opts.element.val("");
                this.updateSelection([]);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange({
                        added: this.data(),
                        removed: oldData
                    });
                }
                return;
            }
            this.setVal(val);
            if (this.select) {
                this.opts.initSelection(this.select, this.bind(this.updateSelection));
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(oldData, this.data()));
                }
            } else {
                if (this.opts.initSelection === undefined) {
                    throw new Error("val() cannot be called if initSelection() is not defined");
                }
                this.opts.initSelection(this.opts.element, function(data) {
                    var ids = $.map(data, self.id);
                    self.setVal(ids);
                    self.updateSelection(data);
                    self.clearSearch();
                    if (triggerChange) {
                        self.triggerChange(self.buildChangeDetails(oldData, self.data()));
                    }
                });
            }
            this.clearSearch();
        },
        onSortStart: function() {
            if (this.select) {
                throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");
            }
            this.search.width(0);
            this.searchContainer.hide();
        },
        onSortEnd: function() {
            var val = [], self = this;
            this.searchContainer.show();
            this.searchContainer.appendTo(this.searchContainer.parent());
            this.resizeSearch();
            this.selection.find(".select2-search-choice").each(function() {
                val.push(self.opts.id($(this).data("select2-data")));
            });
            this.setVal(val);
            this.triggerChange();
        },
        data: function(values, triggerChange) {
            var self = this, ids, old;
            if (arguments.length === 0) {
                return this.selection.children(".select2-search-choice").map(function() {
                    return $(this).data("select2-data");
                }).get();
            } else {
                old = this.data();
                if (!values) {
                    values = [];
                }
                ids = $.map(values, function(e) {
                    return self.opts.id(e);
                });
                this.setVal(ids);
                this.updateSelection(values);
                this.clearSearch();
                if (triggerChange) {
                    this.triggerChange(this.buildChangeDetails(old, this.data()));
                }
            }
        }
    });
    $.fn.select2 = function() {
        var args = Array.prototype.slice.call(arguments, 0), opts, select2, method, value, multiple, allowedMethods = [ "val", "destroy", "opened", "open", "close", "focus", "isFocused", "container", "dropdown", "onSortStart", "onSortEnd", "enable", "disable", "readonly", "positionDropdown", "data", "search" ], valueMethods = [ "opened", "isFocused", "container", "dropdown" ], propertyMethods = [ "val", "data" ], methodsMap = {
            search: "externalSearch"
        };
        this.each(function() {
            if (args.length === 0 || typeof args[0] === "object") {
                opts = args.length === 0 ? {} : $.extend({}, args[0]);
                opts.element = $(this);
                if (opts.element.get(0).tagName.toLowerCase() === "select") {
                    multiple = opts.element.prop("multiple");
                } else {
                    multiple = opts.multiple || false;
                    if ("tags" in opts) {
                        opts.multiple = multiple = true;
                    }
                }
                select2 = multiple ? new window.Select2["class"].multi() : new window.Select2["class"].single();
                select2.init(opts);
            } else if (typeof args[0] === "string") {
                if (indexOf(args[0], allowedMethods) < 0) {
                    throw "Unknown method: " + args[0];
                }
                value = undefined;
                select2 = $(this).data("select2");
                if (select2 === undefined) return;
                method = args[0];
                if (method === "container") {
                    value = select2.container;
                } else if (method === "dropdown") {
                    value = select2.dropdown;
                } else {
                    if (methodsMap[method]) method = methodsMap[method];
                    value = select2[method].apply(select2, args.slice(1));
                }
                if (indexOf(args[0], valueMethods) >= 0 || indexOf(args[0], propertyMethods) >= 0 && args.length == 1) {
                    return false;
                }
            } else {
                throw "Invalid arguments to select2 plugin: " + args;
            }
        });
        return value === undefined ? this : value;
    };
    $.fn.select2.defaults = {
        width: "copy",
        loadMorePadding: 0,
        closeOnSelect: true,
        openOnEnter: true,
        containerCss: {},
        dropdownCss: {},
        containerCssClass: "",
        dropdownCssClass: "",
        formatResult: function(result, container, query, escapeMarkup) {
            var markup = [];
            markMatch(this.text(result), query.term, markup, escapeMarkup);
            return markup.join("");
        },
        formatSelection: function(data, container, escapeMarkup) {
            return data ? escapeMarkup(this.text(data)) : undefined;
        },
        sortResults: function(results, container, query) {
            return results;
        },
        formatResultCssClass: function(data) {
            return data.css;
        },
        formatSelectionCssClass: function(data, container) {
            return undefined;
        },
        minimumResultsForSearch: 0,
        minimumInputLength: 0,
        maximumInputLength: null,
        maximumSelectionSize: 0,
        id: function(e) {
            return e == undefined ? null : e.id;
        },
        text: function(e) {
            if (e && this.data && this.data.text) {
                if ($.isFunction(this.data.text)) {
                    return this.data.text(e);
                } else {
                    return e[this.data.text];
                }
            } else {
                return e.text;
            }
        },
        matcher: function(term, text) {
            return stripDiacritics("" + text).toUpperCase().indexOf(stripDiacritics("" + term).toUpperCase()) >= 0;
        },
        separator: ",",
        tokenSeparators: [],
        tokenizer: defaultTokenizer,
        escapeMarkup: defaultEscapeMarkup,
        blurOnChange: false,
        selectOnBlur: false,
        adaptContainerCssClass: function(c) {
            return c;
        },
        adaptDropdownCssClass: function(c) {
            return null;
        },
        nextSearchTerm: function(selectedObject, currentSearchTerm) {
            return undefined;
        },
        searchInputPlaceholder: "",
        createSearchChoicePosition: "top",
        shouldFocusInput: function(instance) {
            var supportsTouchEvents = "ontouchstart" in window || navigator.msMaxTouchPoints > 0;
            if (!supportsTouchEvents) {
                return true;
            }
            if (instance.opts.minimumResultsForSearch < 0) {
                return false;
            }
            return true;
        }
    };
    $.fn.select2.locales = [];
    $.fn.select2.locales["en"] = {
        formatMatches: function(matches) {
            if (matches === 1) {
                return "One result is available, press enter to select it.";
            }
            return matches + " results are available, use up and down arrow keys to navigate.";
        },
        formatNoMatches: function() {
            return "No matches found";
        },
        formatAjaxError: function(jqXHR, textStatus, errorThrown) {
            return "Loading failed";
        },
        formatInputTooShort: function(input, min) {
            var n = min - input.length;
            return "Please enter " + n + " or more character" + (n == 1 ? "" : "s");
        },
        formatInputTooLong: function(input, max) {
            var n = input.length - max;
            return "Please delete " + n + " character" + (n == 1 ? "" : "s");
        },
        formatSelectionTooBig: function(limit) {
            return "You can only select " + limit + " item" + (limit == 1 ? "" : "s");
        },
        formatLoadMore: function(pageNumber) {
            return "Loading more results…";
        },
        formatSearching: function() {
            return "Searching…";
        }
    };
    $.extend($.fn.select2.defaults, $.fn.select2.locales["en"]);
    $.fn.select2.ajaxDefaults = {
        transport: $.ajax,
        params: {
            type: "GET",
            cache: false,
            dataType: "json"
        }
    };
    window.Select2 = {
        query: {
            ajax: ajax,
            local: local,
            tags: tags
        },
        util: {
            debounce: debounce,
            markMatch: markMatch,
            escapeMarkup: defaultEscapeMarkup,
            stripDiacritics: stripDiacritics
        },
        "class": {
            "abstract": AbstractSelect2,
            single: SingleSelect2,
            multi: MultiSelect2
        }
    };
})(jQuery);

!function(a) {
    "use strict";
    var b = a.jCarousel = {};
    b.version = "0.3.4";
    var c = /^([+\-]=)?(.+)$/;
    b.parseTarget = function(a) {
        var b = !1, d = "object" != typeof a ? c.exec(a) : null;
        return d ? (a = parseInt(d[2], 10) || 0, d[1] && (b = !0, "-=" === d[1] && (a *= -1))) : "object" != typeof a && (a = parseInt(a, 10) || 0), 
        {
            target: a,
            relative: b
        };
    }, b.detectCarousel = function(a) {
        for (var b; a.length > 0; ) {
            if (b = a.filter("[data-jcarousel]"), b.length > 0) return b;
            if (b = a.find("[data-jcarousel]"), b.length > 0) return b;
            a = a.parent();
        }
        return null;
    }, b.base = function(c) {
        return {
            version: b.version,
            _options: {},
            _element: null,
            _carousel: null,
            _init: a.noop,
            _create: a.noop,
            _destroy: a.noop,
            _reload: a.noop,
            create: function() {
                return this._element.attr("data-" + c.toLowerCase(), !0).data(c, this), !1 === this._trigger("create") ? this : (this._create(), 
                this._trigger("createend"), this);
            },
            destroy: function() {
                return !1 === this._trigger("destroy") ? this : (this._destroy(), this._trigger("destroyend"), 
                this._element.removeData(c).removeAttr("data-" + c.toLowerCase()), this);
            },
            reload: function(a) {
                return !1 === this._trigger("reload") ? this : (a && this.options(a), this._reload(), 
                this._trigger("reloadend"), this);
            },
            element: function() {
                return this._element;
            },
            options: function(b, c) {
                if (0 === arguments.length) return a.extend({}, this._options);
                if ("string" == typeof b) {
                    if ("undefined" == typeof c) return "undefined" == typeof this._options[b] ? null : this._options[b];
                    this._options[b] = c;
                } else this._options = a.extend({}, this._options, b);
                return this;
            },
            carousel: function() {
                return this._carousel || (this._carousel = b.detectCarousel(this.options("carousel") || this._element), 
                this._carousel || a.error('Could not detect carousel for plugin "' + c + '"')), 
                this._carousel;
            },
            _trigger: function(b, d, e) {
                var f, g = !1;
                return e = [ this ].concat(e || []), (d || this._element).each(function() {
                    f = a.Event((c + ":" + b).toLowerCase()), a(this).trigger(f, e), f.isDefaultPrevented() && (g = !0);
                }), !g;
            }
        };
    }, b.plugin = function(c, d) {
        var e = a[c] = function(b, c) {
            this._element = a(b), this.options(c), this._init(), this.create();
        };
        return e.fn = e.prototype = a.extend({}, b.base(c), d), a.fn[c] = function(b) {
            var d = Array.prototype.slice.call(arguments, 1), f = this;
            return this.each("string" == typeof b ? function() {
                var e = a(this).data(c);
                if (!e) return a.error("Cannot call methods on " + c + ' prior to initialization; attempted to call method "' + b + '"');
                if (!a.isFunction(e[b]) || "_" === b.charAt(0)) return a.error('No such method "' + b + '" for ' + c + " instance");
                var g = e[b].apply(e, d);
                return g !== e && "undefined" != typeof g ? (f = g, !1) : void 0;
            } : function() {
                var d = a(this).data(c);
                d instanceof e ? d.reload(b) : new e(this, b);
            }), f;
        }, e;
    };
}(jQuery), function(a, b) {
    "use strict";
    var c = function(a) {
        return parseFloat(a) || 0;
    };
    a.jCarousel.plugin("jcarousel", {
        animating: !1,
        tail: 0,
        inTail: !1,
        resizeTimer: null,
        lt: null,
        vertical: !1,
        rtl: !1,
        circular: !1,
        underflow: !1,
        relative: !1,
        _options: {
            list: function() {
                return this.element().children().eq(0);
            },
            items: function() {
                return this.list().children();
            },
            animation: 400,
            transitions: !1,
            wrap: null,
            vertical: null,
            rtl: null,
            center: !1
        },
        _list: null,
        _items: null,
        _target: a(),
        _first: a(),
        _last: a(),
        _visible: a(),
        _fullyvisible: a(),
        _init: function() {
            var a = this;
            return this.onWindowResize = function() {
                a.resizeTimer && clearTimeout(a.resizeTimer), a.resizeTimer = setTimeout(function() {
                    a.reload();
                }, 100);
            }, this;
        },
        _create: function() {
            this._reload(), a(b).on("resize.jcarousel", this.onWindowResize);
        },
        _destroy: function() {
            a(b).off("resize.jcarousel", this.onWindowResize);
        },
        _reload: function() {
            this.vertical = this.options("vertical"), null == this.vertical && (this.vertical = this.list().height() > this.list().width()), 
            this.rtl = this.options("rtl"), null == this.rtl && (this.rtl = function(b) {
                if ("rtl" === ("" + b.attr("dir")).toLowerCase()) return !0;
                var c = !1;
                return b.parents("[dir]").each(function() {
                    return /rtl/i.test(a(this).attr("dir")) ? (c = !0, !1) : void 0;
                }), c;
            }(this._element)), this.lt = this.vertical ? "top" : "left", this.relative = "relative" === this.list().css("position"), 
            this._list = null, this._items = null;
            var b = this.index(this._target) >= 0 ? this._target : this.closest();
            this.circular = "circular" === this.options("wrap"), this.underflow = !1;
            var c = {
                left: 0,
                top: 0
            };
            return b.length > 0 && (this._prepare(b), this.list().find("[data-jcarousel-clone]").remove(), 
            this._items = null, this.underflow = this._fullyvisible.length >= this.items().length, 
            this.circular = this.circular && !this.underflow, c[this.lt] = this._position(b) + "px"), 
            this.move(c), this;
        },
        list: function() {
            if (null === this._list) {
                var b = this.options("list");
                this._list = a.isFunction(b) ? b.call(this) : this._element.find(b);
            }
            return this._list;
        },
        items: function() {
            if (null === this._items) {
                var b = this.options("items");
                this._items = (a.isFunction(b) ? b.call(this) : this.list().find(b)).not("[data-jcarousel-clone]");
            }
            return this._items;
        },
        index: function(a) {
            return this.items().index(a);
        },
        closest: function() {
            var b, d = this, e = this.list().position()[this.lt], f = a(), g = !1, h = this.vertical ? "bottom" : this.rtl && !this.relative ? "left" : "right";
            return this.rtl && this.relative && !this.vertical && (e += this.list().width() - this.clipping()), 
            this.items().each(function() {
                if (f = a(this), g) return !1;
                var i = d.dimension(f);
                if (e += i, e >= 0) {
                    if (b = i - c(f.css("margin-" + h)), !(Math.abs(e) - i + b / 2 <= 0)) return !1;
                    g = !0;
                }
            }), f;
        },
        target: function() {
            return this._target;
        },
        first: function() {
            return this._first;
        },
        last: function() {
            return this._last;
        },
        visible: function() {
            return this._visible;
        },
        fullyvisible: function() {
            return this._fullyvisible;
        },
        hasNext: function() {
            if (!1 === this._trigger("hasnext")) return !0;
            var a = this.options("wrap"), b = this.items().length - 1, c = this.options("center") ? this._target : this._last;
            return b >= 0 && !this.underflow && (a && "first" !== a || this.index(c) < b || this.tail && !this.inTail) ? !0 : !1;
        },
        hasPrev: function() {
            if (!1 === this._trigger("hasprev")) return !0;
            var a = this.options("wrap");
            return this.items().length > 0 && !this.underflow && (a && "last" !== a || this.index(this._first) > 0 || this.tail && this.inTail) ? !0 : !1;
        },
        clipping: function() {
            return this._element["inner" + (this.vertical ? "Height" : "Width")]();
        },
        dimension: function(a) {
            return a["outer" + (this.vertical ? "Height" : "Width")](!0);
        },
        scroll: function(b, c, d) {
            if (this.animating) return this;
            if (!1 === this._trigger("scroll", null, [ b, c ])) return this;
            a.isFunction(c) && (d = c, c = !0);
            var e = a.jCarousel.parseTarget(b);
            if (e.relative) {
                var f, g, h, i, j, k, l, m, n = this.items().length - 1, o = Math.abs(e.target), p = this.options("wrap");
                if (e.target > 0) {
                    var q = this.index(this._last);
                    if (q >= n && this.tail) this.inTail ? "both" === p || "last" === p ? this._scroll(0, c, d) : a.isFunction(d) && d.call(this, !1) : this._scrollTail(c, d); else if (f = this.index(this._target), 
                    this.underflow && f === n && ("circular" === p || "both" === p || "last" === p) || !this.underflow && q === n && ("both" === p || "last" === p)) this._scroll(0, c, d); else if (h = f + o, 
                    this.circular && h > n) {
                        for (m = n, j = this.items().get(-1); m++ < h; ) j = this.items().eq(0), k = this._visible.index(j) >= 0, 
                        k && j.after(j.clone(!0).attr("data-jcarousel-clone", !0)), this.list().append(j), 
                        k || (l = {}, l[this.lt] = this.dimension(j), this.moveBy(l)), this._items = null;
                        this._scroll(j, c, d);
                    } else this._scroll(Math.min(h, n), c, d);
                } else if (this.inTail) this._scroll(Math.max(this.index(this._first) - o + 1, 0), c, d); else if (g = this.index(this._first), 
                f = this.index(this._target), i = this.underflow ? f : g, h = i - o, 0 >= i && (this.underflow && "circular" === p || "both" === p || "first" === p)) this._scroll(n, c, d); else if (this.circular && 0 > h) {
                    for (m = h, j = this.items().get(0); m++ < 0; ) {
                        j = this.items().eq(-1), k = this._visible.index(j) >= 0, k && j.after(j.clone(!0).attr("data-jcarousel-clone", !0)), 
                        this.list().prepend(j), this._items = null;
                        var r = this.dimension(j);
                        l = {}, l[this.lt] = -r, this.moveBy(l);
                    }
                    this._scroll(j, c, d);
                } else this._scroll(Math.max(h, 0), c, d);
            } else this._scroll(e.target, c, d);
            return this._trigger("scrollend"), this;
        },
        moveBy: function(a, b) {
            var d = this.list().position(), e = 1, f = 0;
            return this.rtl && !this.vertical && (e = -1, this.relative && (f = this.list().width() - this.clipping())), 
            a.left && (a.left = d.left + f + c(a.left) * e + "px"), a.top && (a.top = d.top + f + c(a.top) * e + "px"), 
            this.move(a, b);
        },
        move: function(b, c) {
            c = c || {};
            var d = this.options("transitions"), e = !!d, f = !!d.transforms, g = !!d.transforms3d, h = c.duration || 0, i = this.list();
            if (!e && h > 0) return void i.animate(b, c);
            var j = c.complete || a.noop, k = {};
            if (e) {
                var l = {
                    transitionDuration: i.css("transitionDuration"),
                    transitionTimingFunction: i.css("transitionTimingFunction"),
                    transitionProperty: i.css("transitionProperty")
                }, m = j;
                j = function() {
                    a(this).css(l), m.call(this);
                }, k = {
                    transitionDuration: (h > 0 ? h / 1e3 : 0) + "s",
                    transitionTimingFunction: d.easing || c.easing,
                    transitionProperty: h > 0 ? function() {
                        return f || g ? "all" : b.left ? "left" : "top";
                    }() : "none",
                    transform: "none"
                };
            }
            g ? k.transform = "translate3d(" + (b.left || 0) + "," + (b.top || 0) + ",0)" : f ? k.transform = "translate(" + (b.left || 0) + "," + (b.top || 0) + ")" : a.extend(k, b), 
            e && h > 0 && i.one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd", j), 
            i.css(k), 0 >= h && i.each(function() {
                j.call(this);
            });
        },
        _scroll: function(b, c, d) {
            if (this.animating) return a.isFunction(d) && d.call(this, !1), this;
            if ("object" != typeof b ? b = this.items().eq(b) : "undefined" == typeof b.jquery && (b = a(b)), 
            0 === b.length) return a.isFunction(d) && d.call(this, !1), this;
            this.inTail = !1, this._prepare(b);
            var e = this._position(b), f = this.list().position()[this.lt];
            if (e === f) return a.isFunction(d) && d.call(this, !1), this;
            var g = {};
            return g[this.lt] = e + "px", this._animate(g, c, d), this;
        },
        _scrollTail: function(b, c) {
            if (this.animating || !this.tail) return a.isFunction(c) && c.call(this, !1), this;
            var d = this.list().position()[this.lt];
            this.rtl && this.relative && !this.vertical && (d += this.list().width() - this.clipping()), 
            this.rtl && !this.vertical ? d += this.tail : d -= this.tail, this.inTail = !0;
            var e = {};
            return e[this.lt] = d + "px", this._update({
                target: this._target.next(),
                fullyvisible: this._fullyvisible.slice(1).add(this._visible.last())
            }), this._animate(e, b, c), this;
        },
        _animate: function(b, c, d) {
            if (d = d || a.noop, !1 === this._trigger("animate")) return d.call(this, !1), this;
            this.animating = !0;
            var e = this.options("animation"), f = a.proxy(function() {
                this.animating = !1;
                var a = this.list().find("[data-jcarousel-clone]");
                a.length > 0 && (a.remove(), this._reload()), this._trigger("animateend"), d.call(this, !0);
            }, this), g = "object" == typeof e ? a.extend({}, e) : {
                duration: e
            }, h = g.complete || a.noop;
            return c === !1 ? g.duration = 0 : "undefined" != typeof a.fx.speeds[g.duration] && (g.duration = a.fx.speeds[g.duration]), 
            g.complete = function() {
                f(), h.call(this);
            }, this.move(b, g), this;
        },
        _prepare: function(b) {
            var d, e, f, g, h = this.index(b), i = h, j = this.dimension(b), k = this.clipping(), l = this.vertical ? "bottom" : this.rtl ? "left" : "right", m = this.options("center"), n = {
                target: b,
                first: b,
                last: b,
                visible: b,
                fullyvisible: k >= j ? b : a()
            };
            if (m && (j /= 2, k /= 2), k > j) for (;;) {
                if (d = this.items().eq(++i), 0 === d.length) {
                    if (!this.circular) break;
                    if (d = this.items().eq(0), b.get(0) === d.get(0)) break;
                    if (e = this._visible.index(d) >= 0, e && d.after(d.clone(!0).attr("data-jcarousel-clone", !0)), 
                    this.list().append(d), !e) {
                        var o = {};
                        o[this.lt] = this.dimension(d), this.moveBy(o);
                    }
                    this._items = null;
                }
                if (g = this.dimension(d), 0 === g) break;
                if (j += g, n.last = d, n.visible = n.visible.add(d), f = c(d.css("margin-" + l)), 
                k >= j - f && (n.fullyvisible = n.fullyvisible.add(d)), j >= k) break;
            }
            if (!this.circular && !m && k > j) for (i = h; ;) {
                if (--i < 0) break;
                if (d = this.items().eq(i), 0 === d.length) break;
                if (g = this.dimension(d), 0 === g) break;
                if (j += g, n.first = d, n.visible = n.visible.add(d), f = c(d.css("margin-" + l)), 
                k >= j - f && (n.fullyvisible = n.fullyvisible.add(d)), j >= k) break;
            }
            return this._update(n), this.tail = 0, m || "circular" === this.options("wrap") || "custom" === this.options("wrap") || this.index(n.last) !== this.items().length - 1 || (j -= c(n.last.css("margin-" + l)), 
            j > k && (this.tail = j - k)), this;
        },
        _position: function(a) {
            var b = this._first, c = b.position()[this.lt], d = this.options("center"), e = d ? this.clipping() / 2 - this.dimension(b) / 2 : 0;
            return this.rtl && !this.vertical ? (c -= this.relative ? this.list().width() - this.dimension(b) : this.clipping() - this.dimension(b), 
            c += e) : c -= e, !d && (this.index(a) > this.index(b) || this.inTail) && this.tail ? (c = this.rtl && !this.vertical ? c - this.tail : c + this.tail, 
            this.inTail = !0) : this.inTail = !1, -c;
        },
        _update: function(b) {
            var c, d = this, e = {
                target: this._target,
                first: this._first,
                last: this._last,
                visible: this._visible,
                fullyvisible: this._fullyvisible
            }, f = this.index(b.first || e.first) < this.index(e.first), g = function(c) {
                var g = [], h = [];
                b[c].each(function() {
                    e[c].index(this) < 0 && g.push(this);
                }), e[c].each(function() {
                    b[c].index(this) < 0 && h.push(this);
                }), f ? g = g.reverse() : h = h.reverse(), d._trigger(c + "in", a(g)), d._trigger(c + "out", a(h)), 
                d["_" + c] = b[c];
            };
            for (c in b) g(c);
            return this;
        }
    });
}(jQuery, window), function(a) {
    "use strict";
    a.jcarousel.fn.scrollIntoView = function(b, c, d) {
        var e, f = a.jCarousel.parseTarget(b), g = this.index(this._fullyvisible.first()), h = this.index(this._fullyvisible.last());
        if (e = f.relative ? f.target < 0 ? Math.max(0, g + f.target) : h + f.target : "object" != typeof f.target ? f.target : this.index(f.target), 
        g > e) return this.scroll(e, c, d);
        if (e >= g && h >= e) return a.isFunction(d) && d.call(this, !1), this;
        for (var i, j = this.items(), k = this.clipping(), l = this.vertical ? "bottom" : this.rtl ? "left" : "right", m = 0; ;) {
            if (i = j.eq(e), 0 === i.length) break;
            if (m += this.dimension(i), m >= k) {
                var n = parseFloat(i.css("margin-" + l)) || 0;
                m - n !== k && e++;
                break;
            }
            if (0 >= e) break;
            e--;
        }
        return this.scroll(e, c, d);
    };
}(jQuery), function(a) {
    "use strict";
    a.jCarousel.plugin("jcarouselControl", {
        _options: {
            target: "+=1",
            event: "click",
            method: "scroll"
        },
        _active: null,
        _init: function() {
            this.onDestroy = a.proxy(function() {
                this._destroy(), this.carousel().one("jcarousel:createend", a.proxy(this._create, this));
            }, this), this.onReload = a.proxy(this._reload, this), this.onEvent = a.proxy(function(b) {
                b.preventDefault();
                var c = this.options("method");
                a.isFunction(c) ? c.call(this) : this.carousel().jcarousel(this.options("method"), this.options("target"));
            }, this);
        },
        _create: function() {
            this.carousel().one("jcarousel:destroy", this.onDestroy).on("jcarousel:reloadend jcarousel:scrollend", this.onReload), 
            this._element.on(this.options("event") + ".jcarouselcontrol", this.onEvent), this._reload();
        },
        _destroy: function() {
            this._element.off(".jcarouselcontrol", this.onEvent), this.carousel().off("jcarousel:destroy", this.onDestroy).off("jcarousel:reloadend jcarousel:scrollend", this.onReload);
        },
        _reload: function() {
            var b, c = a.jCarousel.parseTarget(this.options("target")), d = this.carousel();
            if (c.relative) b = d.jcarousel(c.target > 0 ? "hasNext" : "hasPrev"); else {
                var e = "object" != typeof c.target ? d.jcarousel("items").eq(c.target) : c.target;
                b = d.jcarousel("target").index(e) >= 0;
            }
            return this._active !== b && (this._trigger(b ? "active" : "inactive"), this._active = b), 
            this;
        }
    });
}(jQuery), function(a) {
    "use strict";
    a.jCarousel.plugin("jcarouselPagination", {
        _options: {
            perPage: null,
            item: function(a) {
                return '<a href="#' + a + '">' + a + "</a>";
            },
            event: "click",
            method: "scroll"
        },
        _carouselItems: null,
        _pages: {},
        _items: {},
        _currentPage: null,
        _init: function() {
            this.onDestroy = a.proxy(function() {
                this._destroy(), this.carousel().one("jcarousel:createend", a.proxy(this._create, this));
            }, this), this.onReload = a.proxy(this._reload, this), this.onScroll = a.proxy(this._update, this);
        },
        _create: function() {
            this.carousel().one("jcarousel:destroy", this.onDestroy).on("jcarousel:reloadend", this.onReload).on("jcarousel:scrollend", this.onScroll), 
            this._reload();
        },
        _destroy: function() {
            this._clear(), this.carousel().off("jcarousel:destroy", this.onDestroy).off("jcarousel:reloadend", this.onReload).off("jcarousel:scrollend", this.onScroll), 
            this._carouselItems = null;
        },
        _reload: function() {
            var b = this.options("perPage");
            if (this._pages = {}, this._items = {}, a.isFunction(b) && (b = b.call(this)), null == b) this._pages = this._calculatePages(); else for (var c, d = parseInt(b, 10) || 0, e = this._getCarouselItems(), f = 1, g = 0; ;) {
                if (c = e.eq(g++), 0 === c.length) break;
                this._pages[f] = this._pages[f] ? this._pages[f].add(c) : c, g % d === 0 && f++;
            }
            this._clear();
            var h = this, i = this.carousel().data("jcarousel"), j = this._element, k = this.options("item"), l = this._getCarouselItems().length;
            a.each(this._pages, function(b, c) {
                var d = h._items[b] = a(k.call(h, b, c));
                d.on(h.options("event") + ".jcarouselpagination", a.proxy(function() {
                    var a = c.eq(0);
                    if (i.circular) {
                        var d = i.index(i.target()), e = i.index(a);
                        parseFloat(b) > parseFloat(h._currentPage) ? d > e && (a = "+=" + (l - d + e)) : e > d && (a = "-=" + (d + (l - e)));
                    }
                    i[this.options("method")](a);
                }, h)), j.append(d);
            }), this._update();
        },
        _update: function() {
            var b, c = this.carousel().jcarousel("target");
            a.each(this._pages, function(a, d) {
                return d.each(function() {
                    return c.is(this) ? (b = a, !1) : void 0;
                }), b ? !1 : void 0;
            }), this._currentPage !== b && (this._trigger("inactive", this._items[this._currentPage]), 
            this._trigger("active", this._items[b])), this._currentPage = b;
        },
        items: function() {
            return this._items;
        },
        reloadCarouselItems: function() {
            return this._carouselItems = null, this;
        },
        _clear: function() {
            this._element.empty(), this._currentPage = null;
        },
        _calculatePages: function() {
            for (var a, b, c = this.carousel().data("jcarousel"), d = this._getCarouselItems(), e = c.clipping(), f = 0, g = 0, h = 1, i = {}; ;) {
                if (a = d.eq(g++), 0 === a.length) break;
                b = c.dimension(a), f + b > e && (h++, f = 0), f += b, i[h] = i[h] ? i[h].add(a) : a;
            }
            return i;
        },
        _getCarouselItems: function() {
            return this._carouselItems || (this._carouselItems = this.carousel().jcarousel("items")), 
            this._carouselItems;
        }
    });
}(jQuery), function(a, b) {
    "use strict";
    var c, d, e = {
        hidden: "visibilitychange",
        mozHidden: "mozvisibilitychange",
        msHidden: "msvisibilitychange",
        webkitHidden: "webkitvisibilitychange"
    };
    a.each(e, function(a, e) {
        return "undefined" != typeof b[a] ? (c = a, d = e, !1) : void 0;
    }), a.jCarousel.plugin("jcarouselAutoscroll", {
        _options: {
            target: "+=1",
            interval: 3e3,
            autostart: !0
        },
        _timer: null,
        _started: !1,
        _init: function() {
            this.onDestroy = a.proxy(function() {
                this._destroy(), this.carousel().one("jcarousel:createend", a.proxy(this._create, this));
            }, this), this.onAnimateEnd = a.proxy(this._start, this), this.onVisibilityChange = a.proxy(function() {
                b[c] ? this._stop() : this._start();
            }, this);
        },
        _create: function() {
            this.carousel().one("jcarousel:destroy", this.onDestroy), a(b).on(d, this.onVisibilityChange), 
            this.options("autostart") && this.start();
        },
        _destroy: function() {
            this._stop(), this.carousel().off("jcarousel:destroy", this.onDestroy), a(b).off(d, this.onVisibilityChange);
        },
        _start: function() {
            return this._stop(), this._started ? (this.carousel().one("jcarousel:animateend", this.onAnimateEnd), 
            this._timer = setTimeout(a.proxy(function() {
                this.carousel().jcarousel("scroll", this.options("target"));
            }, this), this.options("interval")), this) : void 0;
        },
        _stop: function() {
            return this._timer && (this._timer = clearTimeout(this._timer)), this.carousel().off("jcarousel:animateend", this.onAnimateEnd), 
            this;
        },
        start: function() {
            return this._started = !0, this._start(), this;
        },
        stop: function() {
            return this._started = !1, this._stop(), this;
        }
    });
}(jQuery, document);

(function($) {
    inits = function() {
        dynamicElements();
        $(document).foundation();
        $("#object-reveal").foundation("reveal", {
            animation: "fadeAndslide",
            open: function() {
                $("body").addClass("popup-open");
            },
            close: function() {
                $("body").removeClass("popup-open");
            },
            opened: function() {
                $(".reveal-modal-bg").css("top", $("nav.top-bar").height() + "px");
            },
            closed: function() {
                $(".reveal-modal-bg").css("top", "0");
            }
        });
        $(".link-form-submit").on({
            click: function(event) {
                event.preventDefault();
                $(this).parents("form").submit();
            }
        });
        jQuery(document).ready(function() {
            jQuery("#video-reveal").foundation("reveal", {
                open: function() {
                    var data = {
                        action: "load_vimeo"
                    };
                    $.post(otwarte_data.ajax_url, data, function(response) {
                        console.info("load vimeo", response);
                        $("#video-reveal .flex-video").html(response);
                    });
                }
            });
        });
        $("#my-favs #ver-bar").on({
            click: toggleMyFavBar
        });
        if ($("body").hasClass("home") || $("body").hasClass("single")) {
            thumb_events();
        }
        if ($("body").hasClass("page-template-my_folders")) {
            $("#my-favs").addClass("bar-opened");
        }
        mobileMenu();
    };
    showLoadedInitials = function() {
        $(window).load(function() {});
    };
    dynamicElements = function() {
        $("#my-favs").css({
            top: $("nav.top-bar").height()
        });
        if ($("#list-cnt").outerHeight() > .5 * $(window).height()) $("#list-cnt .scrollable").addClass("scroll-active"); else $("#list-cnt .scrollable").removeClass("scroll-active");
        reColumnFolders();
        $(document).foundation("interchange", "reflow");
    };
    showHeaderSearch = function() {
        if ($("body").hasClass("home")) {
            if ($("#home-search").length > 0 && $(window).scrollTop() > $("#slider").outerHeight() + $("#home-search").innerHeight()) {
                $("#header-search").fadeIn();
                $("#home-search .oz-button").fadeOut("slow");
            } else {
                $("#header-search").fadeOut("slow");
                $("#home-search .oz-button").fadeIn("slow");
            }
        }
    };
    init_home_map = function() {
        if ($("#home-map").length > 0) {
            var h, scroll;
            if ($("#home-map-container").length > 0) {
                h = 600;
                scroll = false;
            } else {
                var header = $("#header-menu").outerHeight(true);
                $("#home-map").css("margin-top", header + "px");
                h = $(window).height() - header;
                scroll = true;
            }
            $("#home-map").height(h).gmap3({
                map: {
                    options: {
                        minZoom: 7,
                        center: [ 52.06881, 19.47974 ],
                        mapTypeControl: false,
                        panControl: false,
                        scrollwheel: scroll,
                        zoomControlOptions: {
                            style: google.maps.ZoomControlStyle.SMALL
                        },
                        styles: [ {
                            stylers: [ {
                                saturation: -95
                            }, {
                                lightness: 5
                            } ]
                        }, {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [ {
                                visibility: "off"
                            } ]
                        } ]
                    },
                    events: {
                        click: function() {
                            $("#home-map").gmap3({
                                clear: "overlay"
                            });
                        }
                    }
                }
            });
        }
    };
    get_map_objects = function(paged, total) {
        var async = true;
        if (paged === 1) {
            async = false;
        }
        var data = {
            action: "map_objects",
            paged: paged
        };
        var table = [];
        $.ajax({
            type: "POST",
            url: otwarte_data.ajax_url,
            data: data,
            async: async,
            success: function(response) {
                table = jQuery.parseJSON(response);
                if (paged === 1) {
                    $("#home-map").gmap3({
                        marker: {
                            values: table,
                            options: {
                                icon: new google.maps.MarkerImage(otwarte_data.template_url + "/img/monument-marker.png")
                            },
                            cluster: {
                                radius: 30,
                                3: {
                                    content: "<div class='cluster'>CLUSTER_COUNT</div>",
                                    width: 30,
                                    height: 52
                                },
                                events: {
                                    click: function(cluster, event, context) {
                                        var m = $(this).gmap3("get");
                                        if (m.getZoom() < 12) {
                                            m.setCenter(cluster.main.getPosition());
                                            m.setZoom(m.getZoom() + 1);
                                        } else {
                                            var ids = [];
                                            var markers_length = context.data.markers.length;
                                            if (markers_length <= 55) {
                                                $(context.data.markers).each(function(index, el) {
                                                    ids[index] = el.id;
                                                });
                                                var monument_data = {
                                                    action: "monument_data_multiple",
                                                    ids: ids
                                                };
                                                $.post(otwarte_data.ajax_url, monument_data, function(response) {
                                                    var data = jQuery.parseJSON(response);
                                                    var text = "";
                                                    $(data).each(function(index, el) {
                                                        text = text + '<p style="margin-bottom: 5px;">' + (index + 1) + '. <a style="font-size: 12px; color: #000;"href="' + el.permalink + '">' + el.name + "</a></p>";
                                                    });
                                                    $("#home-map").gmap3({
                                                        clear: "overlay"
                                                    }, {
                                                        overlay: {
                                                            latLng: cluster.main.getPosition(),
                                                            options: {
                                                                content: '<div id="ovr' + context.id + '" class="map-ovr">' + '<h4 class="label">' + "Lista zabytków w tym miejscu" + "</h4>" + '<div class="ovr-content">' + text + "</div></div>",
                                                                offset: {
                                                                    x: 20,
                                                                    y: -54
                                                                }
                                                            }
                                                        }
                                                    });
                                                });
                                            } else {
                                                m.setZoom(m.getZoom() + 1);
                                            }
                                        }
                                    }
                                }
                            },
                            events: {
                                click: function(marker, event, context) {
                                    if ($("#ovr" + context.id).length > 0) {
                                        $("#home-map").gmap3({
                                            clear: "overlay"
                                        });
                                    } else {
                                        var monument_data = {
                                            action: "monument_data",
                                            id: context.id
                                        };
                                        $.post(otwarte_data.ajax_url, monument_data, function(response) {
                                            var data = jQuery.parseJSON(response);
                                            $("#home-map").gmap3({
                                                clear: "overlay"
                                            }, {
                                                overlay: {
                                                    latLng: marker.getPosition(),
                                                    options: {
                                                        content: '<div id="ovr' + context.id + '" class="map-ovr">' + '<h4 class="label">' + data.name + "</h4>" + '<div class="ovr-content">' + data.excerpt + "</div>" + '<div class="ovr-button-container"><a href="' + data.permalink + '"></a></div>' + "</div>",
                                                        offset: {
                                                            x: 20,
                                                            y: -54
                                                        }
                                                    }
                                                }
                                            });
                                        });
                                    }
                                }
                            }
                        },
                        autofit: {}
                    });
                } else {
                    var cls = $("#home-map").gmap3({
                        get: {
                            name: "clusterer",
                            all: true
                        }
                    });
                    $("#home-map").gmap3({
                        marker: {
                            values: table,
                            cluster: cls[0],
                            options: {
                                icon: new google.maps.MarkerImage(otwarte_data.template_url + "/img/monument-marker.png")
                            },
                            events: {
                                click: function(marker, event, context) {
                                    if ($("#ovr" + context.id).length > 0) {
                                        $("#home-map").gmap3({
                                            clear: "overlay"
                                        });
                                    } else {
                                        var monument_data = {
                                            action: "monument_data",
                                            id: context.id
                                        };
                                        $.post(otwarte_data.ajax_url, monument_data, function(response) {
                                            var data = jQuery.parseJSON(response);
                                            $("#home-map").gmap3({
                                                clear: "overlay"
                                            }, {
                                                overlay: {
                                                    latLng: marker.getPosition(),
                                                    options: {
                                                        content: '<div id="ovr' + context.id + '" class="map-ovr">' + '<h4 class="label">' + data.name + "</h4>" + '<div class="ovr-content">' + data.excerpt + "</div>" + '<div class="ovr-button-container"><a href="' + data.permalink + '"></a></div>' + "</div>",
                                                        offset: {
                                                            x: 20,
                                                            y: -54
                                                        }
                                                    }
                                                }
                                            });
                                        });
                                    }
                                }
                            }
                        }
                    });
                }
                if (paged === total) {
                    $("#home-map").gmap3({
                        autofit: {}
                    });
                }
            }
        });
    };
    load_home_map = function() {
        var data2 = {
            action: "map_objects_all"
        };
        $.post(otwarte_data.ajax_url, data2, function(response) {
            if (response === 0) return;
            var pages = parseInt(response);
            for (var i = 1; i <= pages; i++) {
                get_map_objects(i, pages);
            }
        });
    };
    monument_map = function() {
        if ($("#monument-map").data("lat") && $("#monument-map").data("lng")) {
            if ($("#monument-map").length > 0) {
                $("#monument-map").height(400).gmap3({
                    map: {
                        options: {
                            minZoom: 7,
                            center: [ 52.06881, 19.47974 ],
                            mapTypeControl: false,
                            panControl: false,
                            scrollwheel: scroll,
                            zoomControlOptions: {
                                style: google.maps.ZoomControlStyle.SMALL
                            },
                            styles: [ {
                                stylers: [ {
                                    saturation: -95
                                }, {
                                    lightness: 5
                                } ]
                            }, {
                                featureType: "poi",
                                elementType: "labels",
                                stylers: [ {
                                    visibility: "off"
                                } ]
                            } ]
                        }
                    },
                    marker: {
                        lat: $("#monument-map").data("lat"),
                        lng: $("#monument-map").data("lng"),
                        options: {
                            icon: new google.maps.MarkerImage(otwarte_data.template_url + "/img/monument-marker.png")
                        }
                    },
                    autofit: {}
                });
            }
        } else {
            $("#monument-map").height(400).gmap3({
                map: {
                    options: {
                        minZoom: 7,
                        center: [ 52.06881, 19.47974 ],
                        mapTypeControl: false,
                        panControl: false,
                        scrollwheel: scroll,
                        zoomControlOptions: {
                            style: google.maps.ZoomControlStyle.SMALL
                        },
                        styles: [ {
                            stylers: [ {
                                saturation: -95
                            }, {
                                lightness: 5
                            } ]
                        }, {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [ {
                                visibility: "off"
                            } ]
                        } ]
                    }
                },
                marker: {
                    values: [ {
                        address: $("#monument-map").data("address") + $("#monument-map").data("city"),
                        options: {
                            icon: new google.maps.MarkerImage(otwarte_data.template_url + "/img/monument-marker.png")
                        }
                    } ]
                },
                autofit: {}
            });
        }
    };
    contact_map = function() {
        if ($("#contact-map").length > 0) {
            $("#contact-map").height(300).gmap3({
                map: {
                    options: {
                        zoom: 15,
                        minZoom: 7,
                        center: [ $("#contact-map").data("lat"), $("#contact-map").data("lng") ],
                        mapTypeControl: false,
                        panControl: false,
                        scrollwheel: scroll,
                        zoomControlOptions: {
                            style: google.maps.ZoomControlStyle.SMALL
                        },
                        styles: [ {
                            stylers: [ {
                                saturation: -95
                            }, {
                                lightness: 5
                            } ]
                        }, {
                            featureType: "poi",
                            elementType: "labels",
                            stylers: [ {
                                visibility: "off"
                            } ]
                        } ]
                    }
                },
                marker: {
                    lat: $("#contact-map").data("lat"),
                    lng: $("#contact-map").data("lng"),
                    options: {
                        icon: new google.maps.MarkerImage(otwarte_data.template_url + "/img/monument-marker.png")
                    }
                }
            });
        }
    };
    thumb_events = function() {
        $(".single-thumb .fav-star-ico").on({
            click: handle_star_click
        });
        dragItemInsideFolder();
        $(".rem-from-fol").on({
            click: removeSingleItemFomFolder
        });
        $(document).foundation("interchange", "reflow");
        $(".single-thumb[data-post-id]").on({
            click: get_single_object
        });
        $(".single-thumb[data-post-id]").on({
            click: function() {
                var href = $("a", this).attr("href");
                var old_url = window.location.href;
                window.history.pushState(null, null, href);
                $("#object-reveal").attr("data-old-url", old_url);
            }
        });
    };
    my_favs_bar_inside_events = function() {
        $("#my-favs .del-favs").on({
            click: remove_all_favs
        });
        $("#my-favs .remove-fav").on({
            click: remove_from_bar
        });
        if ($("#list-cnt").outerHeight() > .5 * $(window).height()) $("#list-cnt .scrollable").addClass("scroll-active"); else $("#list-cnt .scrollable").removeClass("scroll-active");
        if ($("body").hasClass("page-template-my_folders-php")) {
            var draggers = $("#my-favs #list-cnt ul li");
            draggers.draggable({
                helper: "clone"
            });
        }
    };
    toggleMyFavBar = function() {
        var bar_cnt = $(this).parents("#my-favs");
        var data;
        if (bar_cnt.hasClass("bar-opened")) {
            data = {
                action: "close_favs"
            };
            $.post(otwarte_data.ajax_url, data, function(response) {});
        } else {
            data = {
                action: "open_favs"
            };
            $.post(otwarte_data.ajax_url, data, function(response) {});
        }
        bar_cnt.toggleClass("bar-opened");
        reColumnFolders();
    };
    remove_from_bar = function() {
        var id = parseInt($(this).parents("li").attr("data-post-id"));
        var clicker = $(this);
        var data = {
            action: "remove_fav",
            post_id: id
        };
        $.post(otwarte_data.ajax_url, data, function(response) {
            if (parseInt(response) === 0) {
                clicker.parents("li").remove();
                $('.single-thumb[data-post-id="' + id + '"] .alreadyfav').removeClass("alreadyfav");
                refresh_favs();
            }
        });
    };
    remove_all_favs = function(event) {
        event.preventDefault();
        var clicker = $(this);
        var data = {
            action: "remove_all_favs"
        };
        $.post(otwarte_data.ajax_url, data, function(response) {
            clicker.fadeOut("slow");
            $(".single-thumb .alreadyfav").removeClass("alreadyfav");
            refresh_favs();
        });
    };
    handle_star_click = function(event) {
        $("#my-favs").addClass("bar-opened");
        event.preventDefault();
        event.stopPropagation();
        var add;
        var idToHandle = parseInt($(this).parents(".single-thumb").attr("data-post-id"));
        var post_type = $(this).parents(".single-thumb").attr("data-post-type");
        if ($(this).hasClass("alreadyfav")) add = false; else add = true;
        if (add) add_to_fav(idToHandle, $(this)); else remove_fav(idToHandle, $(this));
    };
    add_to_fav = function(id, clicker) {
        var data = {
            action: "add_to_fav",
            post_id: id
        };
        $.post(otwarte_data.ajax_url, data, function(response) {
            if (parseInt(response) === 0) {
                clicker.addClass("alreadyfav");
                refresh_favs();
                makeObjectAnimate(clicker.parents(".large-3"), "pulse");
            }
        });
    };
    remove_fav = function(id, clicker) {
        var data = {
            action: "remove_fav",
            post_id: id
        };
        $.post(otwarte_data.ajax_url, data, function(response) {
            if (parseInt(response) === 0) {
                clicker.removeClass("alreadyfav");
                refresh_favs();
                makeObjectAnimate(clicker.parents(".large-3"), "pulse");
            }
        });
    };
    refresh_favs = function() {
        var data = {
            action: "refresh_all_favs"
        };
        $("#list-cnt .scrollable").addClass("preloader");
        $.post(otwarte_data.ajax_url, data, function(response) {
            if (response !== -1) {
                $("#list-cnt").html(response);
                $("#list-cnt .scrollable").removeClass("preloader");
            }
            my_favs_bar_inside_events();
        });
    };
    ajaxFilterAction = function() {
        var filters = $(" #filter-grey #recent-label .object-filter a ");
        var doctype = $("#filter-grey #recent-label #document-type");
        var montype = $("#filter-grey #recent-label #monument-type");
        var docfilter = $('#filter-grey #recent-label .object-filter a[data-type="document"]');
        var monfilter = $('#filter-grey #recent-label .object-filter a[data-type="monument"]');
        if (docfilter.hasClass("ajax-on")) {
            $(".document-types").show();
            $(".monument-types").hide();
            $(".select2-results").addClass("document_results");
            $(".select2-results").removeClass("monument_results");
            $(".category-info").hide();
            $('a[href="#data-powstania"]').hide();
        }
        if (monfilter.hasClass("ajax-on")) {
            $(".monument-types").show();
            $(".document-types").hide();
            $(".select2-results").removeClass("document_results");
            $(".select2-results").addClass("monument_results");
            $(".category-info").hide();
        }
        if (docfilter.hasClass("ajax-on") && monfilter.hasClass("ajax-on")) {
            $(".document-types").hide();
            $(".monument-types").hide();
            $(".category-info").show();
        }
        filters.on({
            click: function() {
                $(".alert-box").hide();
                var filterson = $(" #filter-grey #recent-label .object-filter a.ajax-on ");
                if ($(this).hasClass("ajax-on") && filterson.length === 2) {
                    $(this).removeClass("ajax-on");
                } else {
                    $(this).addClass("ajax-on");
                }
                $(".category-info").hide();
                if (docfilter.hasClass("ajax-on")) {
                    $(".document-types").show();
                    $(".monument-types").hide();
                    $(".select2-results").addClass("document_results");
                    $(".select2-results").removeClass("monument_results");
                    $('a[href="#data-powstania"]').hide();
                }
                if (monfilter.hasClass("ajax-on")) {
                    $(".monument-types").show();
                    $(".document-types").hide();
                    $(".select2-results").removeClass("document_results");
                    $(".select2-results").addClass("monument_results");
                    $(".category-info").hide();
                    $('a[href="#data-powstania"]').show();
                }
                if (docfilter.hasClass("ajax-on") && monfilter.hasClass("ajax-on")) {
                    $(".document-types").hide();
                    $(".monument-types").hide();
                    $(".category-info").show();
                    $('a[href="#data-powstania"]').show();
                }
            }
        });
        doctype.on({
            change: function() {
                $(this).addClass("ajax-on");
                getPageObjects(1);
            }
        });
        montype.on({
            change: function() {
                $(this).addClass("ajax-on");
                getPageObjects(1);
            }
        });
        var sorters = $(" #filter-grey #recent-label .object-sorters a ");
        sorters.on({
            click: function() {
                $(".alert-box").hide();
                $(this).siblings("a").removeClass("ajax-on");
                $(this).addClass("ajax-on");
                if ($(this).attr("data-order") === "ASC") $(this).attr("data-order", "DESC"); else $(this).attr("data-order", "ASC");
            }
        });
        filters.add(sorters).on({
            click: function(event) {
                event.preventDefault();
                getPageObjects(1);
                window.location.hash = "";
            }
        });
        $('a[href="#data-powstania"]').on({
            click: function() {
                var css_alert_prop = {
                    "float": "left",
                    margin: "0 1.6em 1.6em 1.6em",
                    outline: "0",
                    padding: "1.7em 3em 1.7em 0.91667em",
                    "line-height": "2em",
                    width: "90%"
                };
                var css_btn_prop = {
                    "background-color": "#517286",
                    border: "0",
                    outline: "0",
                    "line-height": "9px",
                    top: "0.3em"
                };
                $(".alert-box").css(css_alert_prop);
                $(".alert-box .close").css(css_btn_prop);
                $(".alert-box").fadeIn();
            }
        });
        $(".alert-box button.close").on({
            click: function() {
                $(".alert-box").fadeOut();
            }
        });
    };
    getPageObjects = function(page) {
        var post_types = [];
        $(" #filter-grey #recent-label .object-filter a.ajax-on ").each(function() {
            post_types.push($(this).attr("data-type"));
        });
        var sorter = $(" #filter-grey #recent-label .object-sorters a.ajax-on ").attr("data-order-by");
        var order = $(" #filter-grey #recent-label .object-sorters a.ajax-on ").attr("data-order");
        var doctype = $("#filter-grey #recent-label #document-type.ajax-on").val();
        var montype = $("#filter-grey #recent-label #monument-type.ajax-on").val();
        var data = {
            action: "get_page_objects",
            post_type: post_types,
            orderby: sorter,
            order: order,
            paged: page
        };
        if (doctype !== null && doctype !== undefined && post_types.length === 1 && post_types[0] === "document") data.doctype = doctype;
        if (montype !== null && montype !== undefined && post_types.length === 1 && post_types[0] === "monument") data.montype = montype;
        var keyword = $("#searchword").val();
        if (keyword !== "") data.keyword = keyword;
        $("#ajax-wrapper").addClass("preloader");
        $.post(otwarte_data.ajax_url, data, function(response) {
            if (response !== -1) {
                $("#ajax-wrapper").html(response);
                if ($("#ajax-wrapper img").length > 0) {
                    $("#ajax-wrapper img").last().load(function() {
                        thumb_events();
                        $("#ajax-wrapper").removeClass("preloader");
                    });
                } else {
                    $("#ajax-wrapper").removeClass("preloader");
                }
            }
            paginationRefresh();
        });
    };
    paginationRefresh = function() {
        $(".pagination a").on({
            click: function(event) {
                event.preventDefault();
                var page;
                if ($(this).hasClass("prev")) page = parseInt($(".pagination .current").parent().prev().children().text());
                if ($(this).hasClass("next")) page = parseInt($(".pagination .current").parent().next().children().text());
                if (!($(this).hasClass("next") || $(this).hasClass("prev"))) page = parseInt($(this).text());
                window.location.hash = "strona" + page;
                console.info(page);
                if ($("body").hasClass("page-template-searchpage-php")) getPageObjects(page);
                if ($("body").hasClass("page-template-my_folders-php")) getUserFolderPage(page);
            }
        });
    };
    triggerAjaxPaginationOnHash = function() {
        var page;
        if ($("#search-results.search-base").length > 0) {
            $(window).on("hashchange", function() {
                page = window.location.hash;
                page = parseInt(page.replace("#strona", ""));
                if (isNaN(page)) page = 1;
                getPageObjects(page);
            });
            page = window.location.hash;
            page = parseInt(page.replace("#strona", ""));
            if (isNaN(page) || page === "") page = 1;
            getPageObjects(page);
        }
        if ($("#search-results.user-folder").length > 0) {
            $(window).on("hashchange", function() {
                var page = window.location.hash;
                page = parseInt(page.replace("#strona", ""));
                if (isNaN(page)) page = 1;
                getUserFolderPage(page);
            });
            page = window.location.hash;
            page = parseInt(page.replace("#strona", ""));
            if (isNaN(page) || page === "") page = 1;
        }
    };
    activateUserDnD = function() {
        var droppers = $("#my-cats-cnt .sf-cnt:not(.add-cnt)").droppable({
            hoverClass: "about-to-drop",
            drop: function(event, ui) {
                var dropped = $(".ui-draggable-dragging").attr("data-post-id");
                var folder = $(this).find(".single-folder");
                var posts_in = folder.attr("data-post-in");
                if (posts_in !== "") posts_in = posts_in.split(","); else posts_in = [];
                if (posts_in.indexOf(dropped) === -1) {
                    posts_in.push(dropped);
                    folder.attr("data-post-in", posts_in);
                    var folder_id = parseInt(folder.attr("data-folder-id"));
                    var posts = folder.attr("data-post-in");
                    console.info(folder_id, posts);
                    var data = {
                        action: "save_after_change",
                        folder: folder_id,
                        posts: posts
                    };
                    $.post(otwarte_data.ajax_url, data, function(response) {
                        makeObjectAnimate(folder.parent(), "bounce");
                    });
                    $(this).trigger("click");
                } else {
                    $("#msg-reveal p").html("Ten element znajduje się już w tym folderze!");
                    $("#msg-reveal").foundation("reveal", "open");
                }
            }
        });
        droppers.on({
            click: loadUserFolder
        });
    };
    loadUserFolder = function(e) {
        e.preventDefault();
        $(".sf-cnt.browsed").removeClass("browsed");
        $(this).addClass("browsed");
        var folder = $(this).find(".single-folder");
        var f_name = $(this).find(".title-text").html();
        var post__in = folder.attr("data-post-in");
        if (post__in !== "") post__in = post__in.split(","); else post__in = false;
        if (post__in) {
            var data = {
                action: "load_user_folder",
                posts: post__in,
                f_name: f_name,
                folders_page: true
            };
            makeOpenFolderDroppable();
            jQuery("#search-results").css("height", jQuery("#search-results").outerHeight());
            $("#ajax-wrapper").addClass("preloader");
            $.post(otwarte_data.ajax_url, data, function(response) {
                if (response !== -1) {
                    $("#ajax-wrapper").html(response);
                    jQuery("#search-results").css("height", "auto");
                    if ($("#ajax-wrapper img").length > 0) {
                        $("#ajax-wrapper img").last().load(function() {
                            $("#ajax-wrapper").removeClass("preloader");
                            thumb_events();
                        });
                    } else {
                        $("#ajax-wrapper").removeClass("preloader");
                    }
                }
                paginationRefresh();
                $(document).foundation("interchange", "reflow");
            });
            scrollToElement("#search-results");
        } else {
            $("#msg-reveal p").html("W tym folderze nie ma żadnych elementów");
            $("#ajax-wrapper *").remove();
            $("#msg-reveal").foundation("reveal", "open");
            $("#search-results").addClass("closed");
        }
    };
    getUserFolderPage = function(page) {
        var post__in = $(".sf-cnt.browsed .single-folder").attr("data-post-in");
        if (post__in !== "") posts = post__in.split(","); else posts = false;
        var data = {
            action: "load_user_folder",
            posts: posts,
            paged: page
        };
        if (posts) {
            $("#ajax-wrapper").addClass("preloader");
            $.post(otwarte_data.ajax_url, data, function(response) {
                if (response !== -1) {
                    $("#ajax-wrapper").html(response);
                    if ($("#ajax-wrapper img").length > 0) {
                        $("#ajax-wrapper img").last().load(function() {
                            $("#ajax-wrapper").removeClass("preloader");
                        });
                    } else {
                        $("#ajax-wrapper").removeClass("preloader");
                    }
                }
                paginationRefresh();
                thumb_events();
                $(document).foundation("interchange", "reflow");
            });
        }
    };
    addUserFolder = function() {
        $("#add-user-folder").on({
            click: addSingleFolder
        });
        $("#add-folder").on({
            submit: function(e) {
                e.preventDefault();
            }
        });
        $("#folder-name").on({
            keypress: function(e) {
                if (e.keyCode === 13) {
                    $(this).parent().trigger("submit");
                    addSingleFolder(e);
                }
            }
        });
        $(document).foundation("abide", "events");
        $("#addfolder-reveal .large-6").on({
            click: function() {
                $(this).siblings().removeClass("cover-sel");
                $(this).addClass("cover-sel");
                $("#folder-cover").val($(this).attr("data-cover-id"));
            }
        });
    };
    addSingleFolder = function(e) {
        e.preventDefault();
        $("#folder-name").focus();
        var form = $("#add-folder");
        form.trigger("validate");
        var browsed = $(".sf-cnt.browsed .single-folder").attr("data-folder-id");
        if (form.find("[data-invalid]").length <= 0) {
            var data = {
                action: "add_user_folder",
                name: $("#folder-name").val(),
                cover: $("#folder-cover").val()
            };
            $("#addfolder-reveal").foundation("reveal", "close");
            $.post(otwarte_data.ajax_url, data, function(response) {
                $("#my-cats-cnt").html(response);
                activateUserDnD();
                addUserFolder();
                removeUserFolder();
                reColumnFolders();
                if (browsed !== undefined) {
                    $(".sf-cnt .single-folder[data-folder-id=" + browsed + "]").parent().addClass("browsed");
                }
                $(document).foundation("interchange", "reflow");
            });
        }
    };
    removeUserFolder = function() {
        $(".rem-folder.ico").on({
            click: function(e) {
                e.preventDefault();
                e.stopPropagation();
                confrimationAction($(this), "removeFolder");
            },
            removeFolder: removeSingleFolder
        });
    };
    confrimationAction = function(clicked, action) {
        $("#msg-reveal p").html('<span class="conf-msg"> Czy napewno chcesz usunąć ten folder? </span> ');
        var yes = '<span class="oz-button confirm"> Tak </span>';
        var no = '<span class="oz-button no-confirm"> Nie </span>';
        var buttons = $(yes).add($(no));
        $("#msg-reveal p").append(buttons);
        $("#msg-reveal p span.oz-button").wrapAll('<div class="button-group">');
        $("#msg-reveal").foundation("reveal", "open");
        $("#msg-reveal .confirm").on({
            click: function() {
                clicked.trigger(action);
                console.info(clicked);
                $("#msg-reveal").foundation("reveal", "close");
            }
        });
        $("#msg-reveal .no-confirm").on({
            click: function() {
                $("#msg-reveal").foundation("reveal", "close");
            }
        });
    };
    removeSingleFolder = function(e) {
        e.preventDefault();
        e.stopPropagation();
        var father = $(this).parent();
        var browsed = $(".sf-cnt.browsed .single-folder").attr("data-folder-id");
        if (father.parent().hasClass("browsed")) {
            $("#search-results").addClass("closed");
            $("#ajax-wrapper *").remove();
        }
        makeObjectAnimate(father.parent(), "fadeOutDown");
        var data = {
            action: "remove_user_folder",
            fid: parseInt(father.attr("data-folder-id"))
        };
        $.post(otwarte_data.ajax_url, data, function(response) {
            $("#my-cats-cnt").html(response);
            $("#addfolder-reveal").foundation("reveal", "close");
            activateUserDnD();
            addUserFolder();
            removeUserFolder();
            reColumnFolders();
            if (browsed !== undefined) {
                $(".sf-cnt .single-folder[data-folder-id=" + browsed + "]").parent().addClass("browsed");
            } else {
                $("#search-results").addClass("closed");
            }
            $(document).foundation("interchange", "reflow");
        });
    };
    reColumnFolders = function() {
        if ($("#my-folders-wrapper").length > 0) {
            var sep = jQuery('<div class="row">');
            var w_width = $(window).width();
            var scale = 6;
            if (w_width >= 1440 && w_width < 1920) scale = 5;
            if (w_width >= 1024 && w_width < 1440) scale = 4;
            if (w_width >= 768 && w_width < 1024) scale = 3;
            if ($("#my-favs").hasClass("bar-opened")) {
                $("#my-cats-cnt > .row").remove();
                $(".sf-cnt").each(function(index, value) {
                    if ((index + 1) % scale === 0) sep.clone().insertAfter($(this));
                });
            } else {
                $("#my-cats-cnt >.row").remove();
                $(".sf-cnt").each(function(index, value) {
                    if ((index + 1) % 6 === 0) sep.clone().insertAfter($(this));
                });
            }
        }
    };
    dragItemInsideFolder = function() {
        var draggers = $("#search-results.user-folder .single-thumb ");
        draggers.draggable({
            helper: "clone"
        });
    };
    removeSingleItemFomFolder = function(e) {
        e.stopPropagation();
        var folder = $(".sf-cnt.browsed .single-folder");
        var posts_in = folder.attr("data-post-in");
        var toRem = $(this).parents(".single-thumb").attr("data-post-id");
        if (posts_in !== "") posts_in = posts_in.split(","); else posts_in = [];
        var index = posts_in.indexOf(toRem);
        if (index > -1) {
            makeObjectAnimate($(this).parents(".large-3"), "fadeOutDown");
            posts_in.splice(index, 1);
            folder.attr("data-post-in", posts_in);
            var folder_id = parseInt(folder.attr("data-folder-id"));
            var posts = folder.attr("data-post-in");
            var data = {
                action: "save_after_change",
                folder: folder_id,
                posts: posts
            };
            $.post(otwarte_data.ajax_url, data, function(response) {
                $(".sf-cnt.browsed").trigger("click");
                makeObjectAnimate($(".sf-cnt.browsed"), "bounce");
            });
        }
    };
    makeOpenFolderDroppable = function() {
        $("#search-results").removeClass("closed");
        $("#search-results").droppable({
            hoverClass: function() {
                if ($(".ui-draggable-dragging").hasClass("single-thumb")) return "ui-infolder"; else return "drop-it";
            },
            drop: function() {
                if (!$(".ui-draggable-dragging").hasClass("single-thumb")) {
                    var dropped = $(".ui-draggable-dragging").attr("data-post-id");
                    var folder = $(".sf-cnt.browsed .single-folder");
                    var posts_in = folder.attr("data-post-in");
                    if (posts_in !== "") posts_in = posts_in.split(","); else posts_in = [];
                    if (posts_in.indexOf(dropped) === -1) {
                        posts_in.push(dropped);
                        folder.attr("data-post-in", posts_in);
                        var folder_id = parseInt(folder.attr("data-folder-id"));
                        var posts = folder.attr("data-post-in");
                        console.info(folder_id, posts);
                        var data = {
                            action: "save_after_change",
                            folder: folder_id,
                            posts: posts
                        };
                        makeObjectAnimate($(".sf-cnt.browsed"), "bounce");
                        $.post(otwarte_data.ajax_url, data, function(response) {
                            $(".sf-cnt.browsed").trigger("click");
                        });
                        if ($(this).hasClass("browsed")) $(this).trigger("click");
                    } else {
                        $("#msg-reveal p").html("Ten element znajduje się już w tym folderze!");
                        $("#msg-reveal").foundation("reveal", "open");
                        scrollToElement($("body"));
                    }
                } else {
                    console.info("alreadyinit");
                }
            }
        });
    };
    makeObjectAnimate = function(object, animation) {
        $(object).removeClass(animation + " animated").addClass(animation + " animated");
        var wait = window.setTimeout(function() {
            $(object).removeClass(animation + " animated");
        }, 1300);
    };
    scrollToElement = function(el) {
        if ($(el).length > 0) {
            var winTop = $(el).offset().top;
            $("html, body").animate({
                scrollTop: winTop
            }, 1e3, "swing");
        }
    };
    handle_button_star_click = function(event) {
        event.preventDefault();
        var idToHandle = parseInt($(this).parents(".popup-info").attr("data-post-id"));
        var post_type = $(this).parents(".single-thumb").attr("data-post-type");
        if ($(this).hasClass("alreadyfav")) {
            $(this).find("span:not(.ico)").html("Zaznacz");
            remove_fav(idToHandle, $(this));
        } else {
            add_to_fav(idToHandle, $(this));
            $(this).find("span:not(.ico)").html("Odznacz");
        }
    };
    singlePopupEvents = function() {
        $(".accordion").foundation("section", {
            multi_expand: true
        });
        $(".popup-info a.fav-cnt").on({
            click: handle_button_star_click
        });
        $(".accordion section a").on({
            click: function(e) {
                e.preventDefault();
            }
        });
        $(".accordion .title").on({
            click: function(e) {
                e.preventDefault();
                if ($(this).closest("section").hasClass("active")) {
                    $(this).closest("section").find(".content").slideToggle("slow");
                    $(this).closest("section").removeClass("active");
                } else {
                    $(this).closest("section").find(".content").slideToggle("slow");
                    $(this).closest("section").addClass("active");
                    var map = $("#monument-map").gmap3("get");
                    google.maps.event.trigger(map, "resize");
                    $("#monument-map").gmap3({
                        autofit: {},
                        map: {
                            options: {
                                zoom: 16
                            }
                        }
                    });
                }
            }
        });
        $(".popup-nav:not(.inside-nav)").on({
            click: get_single_object
        });
        $(".inside-nav").on({
            click: get_single_object_inside
        });
        $(".inside-nav").on({
            click: function() {
                var href = $("section#inside-controler").attr("data-url");
                var title;
                window.history.pushState(title, title, href);
                console.log(href);
            }
        });
        $(".single-cnt .info-button").on({
            click: function() {
                $(".popup-controls.document-controls").toggleClass("open");
                $("#detailed-info .top-section").slideToggle("slow");
                $(this).toggleClass("open");
            }
        });
        singleDocumentJcarousel();
    };
    function nav_prev(title, href_next, href_prev) {
        $("#object-next").on({
            click: function() {
                window.history.pushState(title, title, href_next);
            }
        });
        $("#object-prev").on({
            click: function() {
                window.history.pushState(title, title, href_prev);
            }
        });
    }
    function resizeImg() {
        var img = $("#document-browser img.attachment-full");
        var img_parent = img.parent();
        var w_width = $(window).width();
        var img_w_md = 650;
        var img_w_sm = 550;
        if (w_width > 1024 && w_width < 1340) {
            img_parent.css("text-align", "center");
            img.css("width", img_w_md);
            img.css("backgroundSize", img_w_md + "px ");
        }
        if (w_width >= 768 && w_width < 1024) {
            img_parent.css("text-align", "center");
            img.css("width", img_w_sm);
            img.css("backgroundSize", img_w_sm + "px ");
        }
    }
    get_single_object = function(e) {
        e.preventDefault();
        e.stopPropagation();
        var id = $(this).attr("data-post-id");
        var single;
        if ($(this).hasClass("popup-nav") || $(this).hasClass("close-popup")) {
            single = $("#search-results .single-thumb[data-post-id=" + $(this).attr("data-post-id") + "]");
            if ($("body").hasClass("home")) single = $(".single-thumb[data-post-id=" + $(this).attr("data-post-id") + "]");
        } else {
            single = $(this);
        }
        var href = $("a", this).attr("href");
        var title = single.find(".title-text").text();
        var next = single.parent().next();
        var prev = single.parent().prev();
        if (next.hasClass("row")) {
            next = next.next();
        }
        if (prev.hasClass("row")) {
            prev = prev.prev();
        }
        var href_next = next.find("a").attr("href");
        var href_prev = prev.find("a").attr("href");
        var prev_id = prev.find(".single-thumb").attr("data-post-id");
        var next_id = next.find(".single-thumb").attr("data-post-id");
        var data = {
            action: "get_single_object",
            object_id: id,
            next: next_id,
            prev: prev_id
        };
        if (!$("#object-reveal").hasClass("open")) $("#object-reveal").foundation("reveal", "open");
        $("#object-reveal .ajax-result").addClass("preloader");
        $.post(otwarte_data.ajax_url, data, function(response) {
            $("#object-reveal .ajax-result").html(response);
            scrollToElement($("#object-reveal"));
            singlePopupEvents();
            dynamicElements();
            resizeImg();
            nav_prev(title, href_next, href_prev);
            $("a.close-popup.close-reveal-modal").on({
                click: function() {
                    var data_old_url = $("#object-reveal").attr("data-old-url");
                    var title;
                    window.history.replaceState(title, title, data_old_url);
                }
            });
            window.onpopstate = function(event) {
                $("a.close-popup.close-reveal-modal").trigger("click");
            };
            $(".single-cnt img").last().load(function() {
                insidePopupThumbEvents();
                $("#object-reveal .ajax-result").removeClass("preloader");
                $("#related-docs>section>div").removeClass("preloader");
                $(".attachment-full").wheelzoom();
                $("#nav-prev-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").prev().length !== 0) $("#docs-scans li.active").prev().find("a").trigger("click");
                    }
                });
                $("#nav-next-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").next().length !== 0) $("#docs-scans li.active").next().find("a").trigger("click");
                    }
                });
                $("#zoomInButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomin");
                    }
                });
                $("#zoomOutButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomout");
                    }
                });
            });
            if ($(".single-cnt img").length === 0) {
                insidePopupThumbEvents();
                $("#object-reveal .ajax-result").removeClass("preloader");
                $("#related-docs>section>div").removeClass("preloader");
                $(".attachment-full").wheelzoom();
                $("#nav-prev-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").prev().length !== 0) $("#docs-scans li.active").prev().find("a").trigger("click");
                    }
                });
                $("#nav-next-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").next().length !== 0) $("#docs-scans li.active").next().find("a").trigger("click");
                    }
                });
                $("#zoomInButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomin");
                    }
                });
                $("#zoomOutButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomout");
                    }
                });
            }
            monument_map();
        });
    };
    get_single_object_inside = function(e) {
        e.preventDefault();
        e.stopPropagation();
        var id = $(this).attr("data-post-id");
        var single;
        var mon_docs, mon_id;
        var href;
        var title = $(".title-text", this).text();
        var href_n;
        if ($(this).hasClass("inside-nav")) {
            single = $(this).attr("data-post-id");
            mon_docs = $("#inside-controler").attr("data-documents-ids");
            mon_id = $("a.close-popup").attr("data-post-id");
        } else {
            single = $(this);
            mon_docs = $("#related-docs").attr("data-documents-ids");
            mon_id = $("#monument-controller").attr("data-monument-id");
        }
        var data = {
            action: "get_single_object",
            object_id: id,
            mon_docs: mon_docs,
            inside: true,
            mon_id: mon_id
        };
        if (!$("#object-reveal").hasClass("open")) $("#object-reveal").foundation("reveal", "open");
        $("#object-reveal .ajax-result").addClass("preloader");
        $.post(otwarte_data.ajax_url, data, function(response) {
            $("#object-reveal .ajax-result").html(response);
            scrollToElement($("#object-reveal"));
            singlePopupEvents();
            dynamicElements();
            resizeImg();
            if ($("a").hasClass("inside-nav")) {
                href = $("section#inside-controler").attr("data-url");
                var title;
                window.history.pushState(title, title, href);
            }
            $("#inside-controler a.close-popup").on({
                click: function() {
                    var title;
                    var old_doc_parent_url = $("#object-reveal").attr("data-doc-parent");
                    window.history.replaceState(title, title, old_doc_parent_url);
                }
            });
            window.onpopstate = function(event) {
                $("a.close-popup").trigger("click");
            };
            $(".single-cnt img").last().load(function() {
                insidePopupThumbEvents();
                $("#object-reveal .ajax-result").removeClass("preloader");
                $("#related-docs>section>div").removeClass("preloader");
                $(".attachment-full").wheelzoom();
                $("#zoomInButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomin");
                    }
                });
                $("#zoomOutButton").on({
                    click: function() {
                        $(".attachment-full").trigger("wheelzoom.zoomout");
                    }
                });
                $("#nav-prev-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").prev().length !== 0) {
                            $("#docs-scans li.active").prev().find("a").trigger("click");
                        }
                    }
                });
                $("#nav-next-page").on({
                    click: function(event) {
                        if ($("#docs-scans li.active").next().length !== 0) {
                            $("#docs-scans li.active").next().find("a").trigger("click");
                        }
                    }
                });
            });
        });
    };
    insidePopupThumbEvents = function() {
        $("#related-docs .single-thumb .fav-star-ico").on({
            click: handle_star_click
        });
        $("#related-docs .rem-from-fol").on({
            click: removeSingleItemFomFolder
        });
        $("#related-docs h4.label span.title-text").each(function() {
            var parent = $(this).parent("h4");
            if ($(this).height() + 16 >= parent.height()) parent.height($(this).height() + 15); else parent.css("height", "auto");
        });
        $(document).foundation("interchange", "reflow");
        $("#related-docs .single-thumb[data-post-id]").on({
            click: get_single_object_inside
        });
        $("#related-docs .single-thumb[data-post-id]").on({
            click: function() {
                var href = $("a", this).attr("href");
                var title;
                $("#object-reveal").attr("data-doc-parent", window.location.href);
                window.history.pushState(title, title, href);
            }
        });
        if (!$("#inside-controler a.close-popup").hasClass("close-reveal-modal")) {
            $("#inside-controler a.close-popup").on({
                click: get_single_object
            });
        }
    };
    singleDocumentJcarousel = function() {
        var jcarousel = $(".jcarousel");
        jcarousel.on("jcarousel:reload jcarousel:create", function() {
            var width = jcarousel.innerWidth();
            if (width >= 600) {
                width = width / 3;
            } else if (width >= 350) {
                width = width / 2;
            }
            jcarousel.jcarousel("items").css("width", 120 + "px");
        });
        jcarousel.jcarousel({
            wrap: null
        });
        $(".jcarousel-control-prev").jcarouselControl({
            target: "-=1"
        });
        $(".jcarousel-control-next").jcarouselControl({
            target: "+=1"
        });
        $("#docs-scans .jcarousel").on({
            click: function(e) {
                e.preventDefault();
                var cur = $("#docs-scans .jcarousel").find("li.active");
                cur.removeClass("active");
                var ind = $(this).parent().index() + 1;
                $(".page-start").html(ind);
                $(this).parent().addClass("active");
                $("#document-browser img").remove();
                $("#document-browser .zoom-container").html('<div class="preloader">&nbsp</div>');
                $("html, body").animate({
                    scrollTop: 0
                }, 500);
                var full_src = $(this).attr("data-full-src");
                var img = $('<img src="' + full_src + '" style="background-image: url(' + full_src + ');">').load(function() {
                    $("#document-browser .zoom-container .preloader").remove();
                    $("#document-browser .zoom-container").html(img);
                    $("#document-browser .zoom-container img").wheelzoom();
                    $("#document-browser .zoom-container img").css("background-image", "url(" + full_src + ")");
                });
            }
        }, "a");
    };
    searchFunction = function() {
        $("#keyword_search").on({
            submit: search_by_keyword
        });
        $("#keyword_search span").on({
            click: search_by_keyword
        });
        $("#document-type").select2({
            dropdownParent: ".document-types"
        });
        $("#monument-type").select2({
            dropdownParent: ".document-types"
        });
    };
    search_by_keyword = function(event) {
        event.preventDefault();
        getPageObjects(1);
    };
    mobileMenu = function() {
        var showRightPush = document.getElementById("showRightPush"), body = document.body, menuRight = document.getElementById("cbp-spmenu-s2");
        showRightPush.onclick = function() {
            classie.toggle(this, "active");
            classie.toggle(body, "cbp-spmenu-push-toleft");
            classie.toggle(menuRight, "cbp-spmenu-open");
        };
    };
})(jQuery);

jQuery(function($) {
    $(document).ready(function() {
        inits();
        $(window).on("resizeEnd", function() {
            dynamicElements();
            clearTimeout(this.resizeTO);
        });
        $(window).resize(function() {
            if (this.resizeTO) clearTimeout(this.resizeTO);
            this.resizeTO = setTimeout(function() {
                $(this).trigger("resizeEnd");
            }, 10);
        });
        $(window).scroll(function() {
            showHeaderSearch();
        });
        init_home_map();
        load_home_map();
        monument_map();
        contact_map();
        if ($("body").hasClass("single-document")) {
            $(".attachment-full").wheelzoom();
            $("#zoomInButton").on({
                click: function() {
                    $(".attachment-full").trigger("wheelzoom.zoomin");
                }
            });
            $("#zoomOutButton").on({
                click: function() {
                    $(".attachment-full").trigger("wheelzoom.zoomout");
                }
            });
            $("#nav-prev-page").on({
                click: function(event) {
                    if ($("#docs-scans li.active").prev().length !== 0) $("#docs-scans li.active").prev().find("a").trigger("click");
                }
            });
            $("#nav-next-page").on({
                click: function(event) {
                    if ($("#docs-scans li.active").next().length !== 0) $("#docs-scans li.active").next().find("a").trigger("click");
                }
            });
        }
        my_favs_bar_inside_events();
        if (window.location.hash === "#zabytki") $('a[data-type="monument"]').addClass("ajax-on");
        if (window.location.hash === "#dokumenty") {
            $('a[data-type="document"]').addClass("ajax-on");
            $("#filter-grey #recent-label .document-types").fadeIn();
        }
        ajaxFilterAction();
        paginationRefresh();
        triggerAjaxPaginationOnHash();
        activateUserDnD();
        addUserFolder();
        removeUserFolder();
        singlePopupEvents();
    });
    showLoadedInitials();
    zoomInOnPlus = function() {
        var img = $("#document-browser img.attachment-full");
        var zwidth = $("#document-browser img.attachment-full").css("background-size");
        console.info(zwidth);
    };
    searchFunction();
});